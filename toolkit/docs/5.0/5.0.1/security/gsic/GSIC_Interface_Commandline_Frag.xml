<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE reference PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">

<reference id="gsic-cmd">
 <title>GSI Commands</title>

<xi:include href="globus-update-certificate-dir-manual.xml"
        xmlns:xi="http://www.w3.org/2001/XInclude"/>

<xi:include href="grid_cert_diagnostics-manual.xml"
        xmlns:xi="http://www.w3.org/2001/XInclude"/>

<refentry id="grid-cert-info" xreflabel="grid-cert-info">
  <refmeta>
    <refentrytitle>grid-cert-info</refentrytitle>
    <manvolnum>1</manvolnum>
  </refmeta>
  <refnamediv>
    <refname>grid-cert-info</refname>
    <refpurpose>Display certificate information</refpurpose>
  </refnamediv>
  <refsynopsisdiv>
    <cmdsynopsis>
      <command>grid-cert-info</command>
      <arg>-help</arg>
      <arg>-version</arg>
      <sbr/>
      <arg>-file <replaceable>CERTIFICATE-FILENAME</replaceable></arg>
      <sbr/>
      <arg>-all</arg>
      <arg>-subject</arg>
      <arg>-issuer</arg>
      <arg>-issuerhash</arg>
      <arg>-startdate</arg>
      <arg>-enddate</arg>
    </cmdsynopsis>
  </refsynopsisdiv>

  <refsect1>
    <title>Description</title>
    <para>The <command>grid-cert-info</command> displays information from a
    user's credential, or from any X.509 certificate if the <option>-file
    CERTIFICATE-FILENAME</option> is used. By default, a text
    representation of the entire certificate is displayed. If more than one
    display option is present on the command line, the output is generated
    in the order the options occur on the command line.
    </para>

    <para>The following search order is used to locate the default certificate:

    <itemizedlist>
        <listitem><simpara><filename>$<envar>X509_USER_CERT</envar></filename></simpara></listitem>
        <listitem><simpara><filename>$<envar>HOME</envar>/.globus/usercert.pem</filename></simpara></listitem>
        <listitem><simpara><filename>$<envar>HOME</envar>/.globus/usercred.p12</filename></simpara></listitem>
    </itemizedlist>

    If the certificate is encoded in pkcs12, <command>grid-cert-info</command>
    will prompt for the password used to protect the <filename>.p12</filename>
    file.
    </para>

    <para>The full set of command-line options to
    <command>grid-cert-info</command> is:

    <informaltable colsep="0" rowsep="0">
        <tgroup cols="2">
            <tbody>
                <row>
                    <entry><option>-help</option></entry>
                    <entry>Print help information and exit</entry>
                </row>
                <row>
                    <entry><option>-version</option></entry>
                    <entry>Print version information and exit</entry>
                </row>
                <row>
                    <entry><option>-file
                    <replaceable>CERTIFICATE-FILENAME</replaceable></option></entry>
                    <entry>Read credential from
                    <replaceable>CERTIFICATE-FILENAME</replaceable> instead of
                    the default location. The file must have a
                    <filename>.pem</filename> or <filename>.p12</filename>
                    extension.</entry>
                </row>
                <row>
                    <entry><option>-all</option></entry>
                    <entry>Print all information from the certificate. This is
                    the default unless any of the following options are
                    given.</entry>
                </row>
                <row>
                    <entry><option>-subject</option></entry>
                    <entry>Print the subject name of the certificate.</entry>
                </row>
                <row>
                    <entry><option>-issuer</option></entry>
                    <entry>Print the subject name of the issuer of the
                    certificate. This is the subject name of the
                    <glossterm>Certificate Authority</glossterm> which signed
                    the certificate.</entry>
                </row>
                <row>
                    <entry><option>-issuerhash</option></entry>
                    <entry>Print the hash of the name of the issuer of the
                    certificate. This is the hash of the Certificate Authority
                    which signed the certificate.
                    </entry>
                </row>
                <row>
                    <entry><option>-startdate</option></entry>
                    <entry>Print the date and time from which the certificate
                    is valid</entry>
                </row>
                <row>
                    <entry><option>-enddate</option></entry>
                    <entry>Print the date and time when the certificate
                    expires.</entry>
                </row>
            </tbody>
        </tgroup>
    </informaltable>
  </para>
  </refsect1>

  <refsect1>
    <title>Examples</title>

    <para>
        Print out the date range when a certificate is valid:

        <screen>
<prompt>% </prompt><command>grid-cert-info</command> <option>-startdate</option> <option>-enddate</option>
<computeroutput>
Oct 29 13:09:42 2007 GMT
Oct 28 13:09:42 2008 GMT
</computeroutput>
        </screen>
    Note that in this example, the start date is printed first, based on the
    order of the command-line options.
    </para>
  </refsect1>

  <refsect1>
    <title>Limitations</title>
    <para>The <option>-issuerhash</option> fails with some versions of
    OpenSSL.</para>
  </refsect1>
</refentry>

<refentry id="grid-cert-request" xreflabel="grid-cert-request">
  <refmeta>
    <refentrytitle>grid-cert-request</refentrytitle>
    <manvolnum>1</manvolnum>
  </refmeta>
  <refnamediv>
    <refname>grid-cert-request</refname>
    <refpurpose>Create a certificate request</refpurpose>
  </refnamediv>
  <refsynopsisdiv>
    <cmdsynopsis>
      <command>grid-cert-request</command>
      <arg>-help</arg>
      <arg>-version</arg>
      <arg>-verbose</arg>
      <arg>-force</arg>
      <sbr/>
      <arg>-commonname <replaceable>NAME</replaceable></arg>
      <arg>-service <replaceable>SERVICE</replaceable></arg>
      <arg>-host <replaceable>FQDN</replaceable></arg>
      <arg>-dns <replaceable>FQDN,...</replaceable></arg>
      <arg>-ip <replaceable>IP-ADDRESS, ...</replaceable></arg>
      <arg>-interactive</arg>
      <sbr/>
      <arg>-dir <replaceable>DIRECTORY</replaceable></arg>
      <arg>-prefix <replaceable>PREFIX</replaceable></arg>
      <arg>-ca <arg><replaceable>HASH</replaceable></arg></arg>
      <arg>-nopw</arg>
    </cmdsynopsis>
  </refsynopsisdiv>

  <refsect1>
    <title>Description</title>
    <para><command>grid-cert-request</command> generates a public/private key
    pair an X.509 certificate request containing the public key and a 
    subject name.  By default, it generates a request for a user certificate
    for the invoking user. <command>grid-cert-request</command> can also be
    used to create host or service certificates based on command-line options.
    At least one <glossterm>Certificate Authority</glossterm> must be
    configured to use with the Globus Toolkit in order for this command to
    succeed.
    </para>

    <para>Complete set of options to <command>grid-cert-request</command> is:

    <informaltable colsep="0" rowsep="0">
        <tgroup cols="2">
            <tbody>
                <row>
                    <entry><option>-help</option></entry>
                    <entry>Print help information and exit</entry>
                </row>
                <row>
                    <entry><option>-version</option></entry>
                    <entry>Print version information and exit</entry>
                </row>
                <row>
                    <entry><option>-verbose</option></entry>
                    <entry>Don't clear screen after running OpenSSL</entry>
                </row>
                <row>
                    <entry><option>-force</option></entry>
                    <entry>Overwrite an existing certificate request if
                    present.</entry>
                </row>
                <row>
                    <entry><option>-commonname <replaceable>NAME</replaceable></option></entry>
                    <entry>Construct a subject name with
                    <replaceable>NAME</replaceable> as the final name
                    component. By default, the subject name is inferred from
                    the output of the <command>finger</command> program. If that
                    fails, <command>grid-cert-request</command> will prompt
                    of a name.</entry>
                </row>
                <row>
                    <entry><option>-service <replaceable>SERVICE</replaceable></option></entry>
                    <entry>Construct a subject name with the common name
                    constructed from the <replaceable>SERVICE</replaceable> 
                    name and the hostname joined by the <literal>/</literal>
                    character. The <option>-service</option> requires that the
                    <option>-host</option> option also be used. The private
                    key created for a service certificate request is not
                    encrypted.</entry>
                </row>
                <row>
                    <entry><option>-host <replaceable>FQDN</replaceable></option></entry>
                    <entry>Construct a subject name with
                    <replaceable>FQDN</replaceable> as the name of the host.
                    This must be a fully-qualified name in dotted string
                    notation (e.g. <literal>grid.example.org</literal>). If
                    no service is specified by the <option>-service</option>
                    option, the subject name will be
                    <literal>host/</literal><replaceable>FQDN</replaceable>.The
                    private key created for a host certificate request is not
                    encrypted. By default the host certificate request and key
                    are created in <filename>/etc/grid-security</filename>.
                    </entry>
                </row>
                <row>
                    <entry><option>-dns <replaceable>FQDN,...</replaceable></option></entry>
                    <entry>Add a subjectAltName extension to the certificate
                    request containing one or more DNS names separated by the
                    comma (<emphasis>,</emphasis>) character. These names may
                    contain the wildcard character (<emphasis>*</emphasis>).
                    Globus Toolkit 4.2.1 and later will process the
                    subjectAltName extension if present when performing mutual
                    authentication with a service.
                    </entry>
                </row>
                <row>
                    <entry><option>-ip <replaceable>IP-ADDRESS,...</replaceable></option></entry>
                    <entry>Add a subjectAltName extension to the certificate
                    request containing one or more IP address values separated
                    by the comma (<emphasis>,</emphasis>) character.
                    Globus Toolkit 4.2.1 and later will process the
                    subjectAltName extension if present when performing mutual
                    authentication with a service when the client is presented
                    with an IP address as input.
                    </entry>
                </row>
                <row>
                    <entry><option>-interactive</option></entry>
                    <entry>Interactively prompt for the components of the 
                    certificate subject name.</entry>
                </row>
                <row>
                    <entry><option>-dir <replaceable>DIRECTORY</replaceable></option></entry>
                    <entry>Write the certificate request and key to 
                    <replaceable>DIRECTORY</replaceable>, creating it if the
                    directory does not exist. By default, the certificate
                    request and key are placed in <filename><envar>$HOME</envar>/.globus</filename></entry>
                </row>
                <row>
                    <entry><option>-prefix <replaceable>PREFIX</replaceable></option></entry>
                    <entry>Prepend the string <replaceable>PREFIX</replaceable>
                    to the certificate, key, and request filenames. The default
                    prefix is <literal>user</literal> for user certificates and 
                    <literal>host</literal> for host certificates.</entry>
                </row>
                <row>
                    <entry><option>-ca <replaceable>HASH</replaceable></option></entry>
                    <entry>Choose a non-default Certificate Authority
                    configuration to construct the certificate request. If
                    <replaceable>HASH</replaceable> is present on the command
                    line, then <command>grid-cert-request</command> will use
                    that certificate authority's configuration. Otherwise, it
                    will prompt the user for a CA to choose from the list of
                    configured CAs.</entry>
                </row>
                <row>
                    <entry><option>-nopw</option></entry>
                    <entry>Create a private key without a password. This may
                    be a security risk if the file permissions of the private
                    key are not carefully maintained.</entry>
                </row>
            </tbody>
        </tgroup>
    </informaltable>
    </para>
  </refsect1>

  <refsect1>
    <title>Examples</title>
    <para>
        Request a user certificate:

        <screen>
<prompt>% </prompt><command>grid-cert-request</command>
<computeroutput>
A certificate request and private key is being created.
You will be asked to enter a PEM pass phrase.
This pass phrase is akin to your account password, 
and is used to protect your key file.
If you forget your pass phrase, you will need to
obtain a new certificate.

Generating a 1024 bit RSA private key
.....................++++++
........++++++
writing new private key to '/home/juser/.globus/userkey.pem'
Enter PEM pass phrase:

A private key and a certificate request has been generated with the subject:

/O=Grid/OU=Example/OU=User/CN=Joe User

If the CN=Joe User is not appropriate, rerun this
script with the -force -cn "Common Name" options.

Your private key is stored in /home/juser/.globus/userkey.pem
Your request is stored in /home/juser/.globus/usercert_request.pem

Please e-mail the request to the Globus Certificate Service ca@grid.example.org
You may use a command similar to the following:

  cat /home/juser/.globus/usercert_request.pem | mail ca@grid.example.org

Only use the above if this machine can send AND receive e-mail. if not, please
mail using some other method.

Your certificate will be mailed to you within two working days.
If you receive no response, contact Globus Certificate Service at ca@grid.example.org
</computeroutput>
</screen>
    </para>

    <para>
        Request a host certificate, putting the request and key files in the
        <filename><envar>$HOME</envar>/.globus/host</filename> directory.

        <screen>
<prompt>% </prompt><command>grid-cert-request</command> <option>-host grid.example.org</option> <option>-dir $HOME/.globus/host</option>

<computeroutput>
A private host key and a certificate request has been generated
with the subject:

/O=Grid/OU=Example/OU=User/CN=host/grid.example.org

----------------------------------------------------------

The private key is stored in /tmp/examplegrid/hostkey.pem
The request is stored in /tmp/examplegrid/hostcert_request.pem

Please e-mail the request to the Globus Certificate Service ca@grid.example.org
You may use a command similar to the following:

 cat /tmp/examplegrid/hostcert_request.pem | mail ca@grid.example.org

Only use the above if this machine can send AND receive e-mail. if not, please
mail using some other method.

Your certificate will be mailed to you within two working days.
If you receive no response, contact Globus Certificate Service at ca@grid.example.org
</computeroutput>

</screen>
</para>
    <para>
        Request a host certificate with subjectAltName extensions. This
        certificate is valid for hosts with DNS names
        <emphasis>execution.example.org</emphasis> and
        <emphasis>transfer.example.org</emphasis>.

        <screen>
<prompt>% </prompt><command>grid-cert-request</command> <option>-host grid.example.org</option> <option>-dns execution.example.org,transfer.example.org</option> <option>$HOME/.globus/host</option>

<computeroutput>
A private host key and a certificate request has been generated
with the subject:

/O=Grid/OU=Example/OU=User/CN=host/grid.example.org

----------------------------------------------------------

The private key is stored in /tmp/examplegrid/hostkey.pem
The request is stored in /tmp/examplegrid/hostcert_request.pem

Please e-mail the request to the Globus Certificate Service ca@grid.example.org
You may use a command similar to the following:

 cat /tmp/examplegrid/hostcert_request.pem | mail ca@grid.example.org

Only use the above if this machine can send AND receive e-mail. if not, please
mail using some other method.

Your certificate will be mailed to you within two working days.
If you receive no response, contact Globus Certificate Service at ca@grid.example.org
</computeroutput>

</screen>
</para>
  </refsect1>

  <refsect1>
    <title>Limitations</title>
    <para>Only supports PEM-encoded keys, certificates and certificate requests.
  </para>
  </refsect1>

</refentry>
<refentry id="grid-default-ca" xreflabel="grid-default-ca">
  <refmeta>
    <refentrytitle>grid-default-ca</refentrytitle>
    <manvolnum>1</manvolnum>
  </refmeta>
  <refnamediv>
    <refname>grid-default-ca</refname>
    <refpurpose>Set the default CA to use for certificate requests</refpurpose>
  </refnamediv>
  <refsynopsisdiv>
    <cmdsynopsis>
      <command>grid-default-ca</command>
      <arg choice="opt">-help</arg>
      <arg choice="opt">-list</arg>
      <arg choice="opt">-ca <replaceable>CA-HASH</replaceable></arg>
      <arg choice="opt">-dir <replaceable>SECURITY-DIRECTORY</replaceable></arg>
    </cmdsynopsis>
  </refsynopsisdiv>
  <refsect1>
    <title>Description</title>
    <para>
        The <command>grid-default-ca</command> program sets the default CA used
        by <command>grid-cert-request</command>. Based on the default CA
        choice, <command>grid-cert-request</command> will create a certificate
        request that matches the CA's naming policies.
    </para>

    <para>
        If the <option>-ca</option> option is not provided on the command-line,
        <command>grid-default-ca</command> will display a list of available
        Certificate Authorities and prompt the user to choose one.
    </para>

    <para>
        The full set of command-line options to
        <command>grid-default-ca</command> are:

        <informaltable colsep="0" rowsep="0">
            <tgroup cols="2">
                <tbody>
                    <row>
                        <entry>-help</entry>
                        <entry>Display a help message and exit</entry>
                    </row>
                    <row>
                        <entry>-list</entry>
                        <entry>List the available CAs but do not alter the
                        default</entry>
                    </row>
                    <row>
                        <entry>-ca <replaceable>CA-HASH</replaceable></entry>
                        <entry>Select the default CA whose subject name hash
                        matches <replaceable>CA-HASH</replaceable>.
                        </entry>
                    </row>
                    <row>
                        <entry>-dir <replaceable>SECURITY-DIRECTORY</replaceable></entry>
                        <entry>Search
                        <replaceable>SECURITY-DIRECTORY</replaceable> for
                        additional CA certificates.</entry>
                    </row>
                </tbody>
            </tgroup>
        </informaltable>
    </para>
  </refsect1>
  <refsect1>
    <title>Examples</title>
    <para>
        Show what certificate authorities are in the trusted cert directory:

        <screen>
<prompt>% </prompt> <command>grid-default-ca</command> <option>-list</option>
<computeroutput>
The available CA configurations installed on this host are:

Directory: /etc/grid-security/certificates

1) 1c3f2ca8 -  /DC=org/DC=DOEGrids/OU=Certificate Authorities/CN=DOEGrids CA 1
2) 3d8e6ce8 -  /O=Grid/CN=Example CA
3) 6349a761 -  /O=DOE Science Grid/OU=Certificate Authorities/CN=Certificate Manager
4) b38b4d8c -  /C=US/O=Globus Alliance/CN=Globus Certificate Service


The default CA is: /C=US/O=Globus Alliance/CN=Globus Certificate Service
         Location: /etc/grid-security/certificates/b38b4d8c.0
</computeroutput>
        </screen>
  </para>

  <para>
      Change the default CA to be <emphasis>DOEGrids CA 1</emphasis>:

        <screen>
<prompt>% </prompt> <command>grid-default-ca</command>
<computeroutput>
The available CA configurations installed on this host are:

Directory: /etc/grid-security/certificates

1) 1c3f2ca8 -  /DC=org/DC=DOEGrids/OU=Certificate Authorities/CN=DOEGrids CA 1
2) 3d8e6ce8 -  /O=Grid/CN=Example CA
3) 6349a761 -  /O=DOE Science Grid/OU=Certificate Authorities/CN=Certificate Manager
4) b38b4d8c -  /C=US/O=Globus Alliance/CN=Globus Certificate Service


The default CA is: /C=US/O=Globus Alliance/CN=Globus Certificate Service
         Location: /etc/grid-security/certificates/b38b4d8c.0

</computeroutput>
<prompt>Enter the index number of the CA to set as the default [q to quit]:</prompt> <userinput>1</userinput>
<computeroutput>
setting the default CA to: /DC=org/DC=DOEGrids/OU=Certificate Authorities/CN=DOEGrids CA 1

linking /etc/grid-security/certificates/grid-security.conf.1c3f2ca8 to
        /etc/grid-security/grid-security.conf

linking /etc/grid-security/certificates/globus-host-ssl.conf.1c3f2ca8 to
        /etc/grid-security/globus-host-ssl.conf

linking /etc/grid-security/certificates/globus-user-ssl.conf.1c3f2ca8 to
        /etc/grid-security/globus-user-ssl.conf


...done.
</computeroutput>
        </screen>
    </para>
  </refsect1>
  <refsect1>
    <title>Limitations</title>
    <para>Displays all CAs in the output, even those where the
    globus-user-ssl.conf and globus-host-ssl.conf files are not installed in
    the trusted certificate directory. If one of those is chosen,
    <command>grid-default-ca</command> displays an error and exits.
    </para>
  </refsect1>
</refentry>
<refentry id="grid-change-pass-phrase" xreflabel="grid-change-pass-phrase">
  <refmeta>
    <refentrytitle>grid-change-pass-phrase</refentrytitle>
    <manvolnum>1</manvolnum>
  </refmeta>
  <refnamediv>
    <refname>grid-change-pass-phrase</refname>
    <refpurpose>Change the pass phrase on a private key</refpurpose>
  </refnamediv>
  <refsynopsisdiv>
    <cmdsynopsis>
      <command>grid-change-pass-phrase</command>
    </cmdsynopsis>
  </refsynopsisdiv>
  <refsect1>
    <title>Tool description</title>
    <para><command>grid-change-pass-phrase</command> allows one to change the passphrase that
   protects the private key.</para>
  </refsect1>
  <refsect1>
    <title>Command syntax</title>
    <screen>grid-change-pass-phrase [-help] [-version] [-file private_key_file]</screen>
    <para> Changes the passphrase that protects the private key. Note
   that  this command will work even if the original key is not
   password protected. If the -file argument is not given, the default
   location of the file containing the private key is assumed:</para>
    <itemizedlist>
      <listitem>
        <simpara> The location pointed to by X509_USER_KEY</simpara>
      </listitem>
      <listitem>
        <simpara> If X509_USER_KEY not set, $HOME/.globus/userkey.pem</simpara>
      </listitem>
    </itemizedlist>
  </refsect1>
  <refsect1>
    <title>Options</title>
    <table>
      <title>Command line options</title>
      <tgroup cols="2">
        <tbody>
          <row>
            <entry>help, -usage</entry>
            <entry>Displays usage.</entry>
          </row>
          <row>
            <entry> -version</entry>
            <entry> Displays version.</entry>
          </row>
          <row>
            <entry> -file location</entry>
            <entry>Changes the passphrase on the key stored in the file at the non-standard location &apos;location&apos;.</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </refsect1>
  <refsect1>
    <title>Limitations</title>
    <para>Nothing applicable
  </para>
  </refsect1>
</refentry>

<xi:include href="grid_proxy_init-manual.xml"
        xmlns:xi="http://www.w3.org/2001/XInclude"/>

<xi:include href="grid_proxy_destroy-manual.xml"
        xmlns:xi="http://www.w3.org/2001/XInclude"/>

<xi:include href="grid_proxy_info-manual.xml"
        xmlns:xi="http://www.w3.org/2001/XInclude"/>

<xi:include href="grid-mapfile-add-entry-manual.xml"
        xmlns:xi="http://www.w3.org/2001/XInclude"/>

<xi:include href="grid-mapfile-check-consistency-manual.xml"
        xmlns:xi="http://www.w3.org/2001/XInclude"/>

<xi:include href="grid-mapfile-delete-entry-manual.xml"
        xmlns:xi="http://www.w3.org/2001/XInclude"/>

</reference>
