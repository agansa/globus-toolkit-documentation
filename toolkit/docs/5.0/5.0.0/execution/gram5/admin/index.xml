<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd"
[

<!ENTITY % xinclude SYSTEM "../../../xinclude.mod" >
%xinclude;

]>
<book id="gram5Admin">
<title>GT <replaceable role="entity">version</replaceable> GRAM5 : System Administrator's Guide</title>
<titleabbrev> System Administrator's Guide</titleabbrev>
 
<bookinfo><abstract><title>Introduction</title>

<para>This guide contains advanced configuration information
  for system administrators working with GRAM5. It provides references to
  information on procedures typically performed by system administrators,
  including installation, configuring, deploying, and testing the
  installation. It also describes additional prerequisites and host settings
  necessary for GRAM5 operation. Readers should be familiar with the
  <olink targetdoc="executionKey">Key Concepts</olink> and
  <olink targetdoc="executionKey" targetptr="execution-approach">Implementation
  Approach</olink>
  for GRAM5 to understand the motivation for and interaction between the
  various deployed components.
</para>


<para>  <important>
    <simpara> The information in this GRAM5 Admin Guide is in addition to the basic Globus Toolkit prerequisite, 
   overview, installation, security configuration instructions in the <olink targetdoc="gtadmin" />.  
    Read through this guide before continuing!</simpara>  
  </important></para>
</abstract></bookinfo>
<!--  will add back when the output is more useful - i lost the indexterms i'd added, need to add them again
<index type="gram5-howto">
    <title>Admin How-tos Index</title>
</index>
-->
<!-- introduction -->

<chapter id="gram5-admin-installing"><title>Building and Installing</title>
  <para>GRAM5 is built and installed as part of
    a default GT <replaceable role="entity">version</replaceable> installation. For basic installation instructions, see   <olink targetdoc="gtadmin"/>.</para>
  
<!-- local scheduler -->
<section id="gram5-admin-lrm"><title>Local Resource Manager</title>
  <indexterm type="gram5"><primary>installing</primary><secondary>prerequisites</secondary><tertiary>local scheduler</tertiary></indexterm>
    <indexterm type="gram5-howto"><primary>installing</primary><secondary>prerequisites</secondary><tertiary>local scheduler</tertiary></indexterm>
<para> 
  GRAM5 depends on a local mechanism for starting and controlling jobs.
  GRAM5 includes a fork <glossterm>local resource
  manager</glossterm> which requires no special software to execute
  jobs on the local host. GRAM5 can also be configured to use additional
  batch facilities and schedulers such as condor, torque, or LSF. Install
  and configure any local resource managers you intend to use prior to
  configuring GRAM5.
</para>
</section>

<!-- lrm adapters -->
<section id="gram5-admin-lrmAdapters"><title>LRM Adapters</title>
  <indexterm type="gram5"><primary>installing</primary><secondary>prerequisites</secondary><tertiary>lrm adapter</tertiary></indexterm>
    <indexterm type="gram5-howto"><primary>installing</primary><secondary>prerequisites</secondary><tertiary>lrm adapter</tertiary></indexterm>
  <para>
  GRAM5 depends on LRM adapters to execute jobs described by GRAM5 <glossterm>
  RSL</glossterm> documents on a resource managed by a LRM.
  </para>
  <para>
      LRM adapters included in the GT <replaceable role="entity">version</replaceable> release are:
  <table>
    <title>Supported LRM Adapters</title>
    <tgroup cols="2">
      <thead>
        <row>
          <entry>LRM Adapter Name</entry>
          <entry>LRM Supported</entry>
        </row>
      </thead>
      <tbody>
        <row>
          <entry>fork</entry>
          <entry>Unscheduled local execution</entry>
        </row>
        <row>
          <entry>pbs</entry>
          <entry><ulink url="http://www.clusterresources.com/products/torque-resource-manager.php">Torque</ulink></entry>
        </row>
        <row>
          <entry>condor</entry>
          <entry><ulink url="http://www.cs.wisc.edu/condor/">Condor</ulink></entry>
        </row>
        <row>
          <entry>lsf</entry>
          <entry><ulink url="http://www.platform.com/Products/Platform.LSF.Family/Platform.LSF/">LSF</ulink></entry>
        </row>
       </tbody>
      </tgroup>
    </table>
    <note><simpara>The <literal>pbs</literal> LRM adapter may work with other systems
    that implement POSIX batch environment services.</simpara></note>
  </para>

  <para>
      A third-party LRM adapter is available for GT <replaceable role="entity">version</replaceable> are: <ulink url="http://www.lesc.ic.ac.uk/projects/SGE-GT4.html">Sun Grid Engine</ulink>
  </para>

  <para>
      For configuration details, see "Configuring LRM adapters" in the
  <olink targetptr="gram5-configuring">Configuring</olink> section.
  </para>

</section>

</chapter>

  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
    href="../GRAM5_Interface_Config_Frag.xml"/>

<chapter id="gram5-admin-deploying"><title>Deploying </title>
  <indexterm type="gram5"><primary>deploying</primary></indexterm>
    <indexterm type="gram5-howto"><primary>deploying</primary></indexterm>
  <para>GRAM5 is installed as part of a standard toolkit installation. By
  default the <literal>fork</literal> LRM interface is installed and configured
  to use the poll interface.
  </para>
  
  <para>In order to run the service, the
  <command>globus-gatekeeper</command> program must be started on a service
  node. This may be done in two supported ways, either via a super-server such
  as <application>inetd</application> or <application>xinetd</application>, or
  as a stand-alone daemon process.
  </para>

  <section id="gram5-admin-deploying-servicesconf"><title>Deploying GRAM5 via inetd or xinetd</title>

  <para>To deploy GRAM5 to be started by <application>inetd</application>,
  define a service entry for the gsigatekeeper service in
  <filename>/etc/services</filename> file if it is not already present. The
  ICANN-assigned port number for the service is 2119, so add an entry like:

  <programlisting>gsigatekeeper   2119/tcp</programlisting>
  </para>
  
      <section id="gram5-admin-deploying-inetdconf">
        <title>Deploying GRAM5 via inetd</title>

        <para>To deploy GRAM5 to be started via
        <application>inetd</application>, modify
        <filename>/etc/inetd.conf</filename> (or your operating-system specific
        path to this file) by adding the following entry (on one line):

        <programlisting>gsigatekeeper stream tcp nowait root /usr/bin/env env LD_LIBRARY_PATH=<replaceable>GLOBUS_LOCATION</replaceable>/lib <replaceable>GLOBUS_LOCATION</replaceable>/sbin/globus-gatekeeper -conf <replaceable>GLOBUS_LOCATION</replaceable>/etc/globus-gatekeeper.conf</programlisting>

            After doing so, run the operating-system specific command to 
            have <application>inetd</application> reload its configuration.
        </para>

        <important>
        <para>This example assumes that the <envar>LD_LIBRARY_PATH</envar>
        environment variable is needed to be able to run the GRAM5 programs and
        scripts. This is operating-system specific and may need to be changed.
        Consult the documentation for the operating system's runtime linker in
        the case of runtime problems.</para>
        
        <para>The <replaceable>GLOBUS_LOCATION</replaceable> string in the
        above example must be replaced with the actual path where GT
        has been installed.
        </para></important>

        <note>
        <para>
        When deploying GRAM5 via xinetd, be sure to include the command-line
        option <option>-inetd</option> in the gatekeeper configuration file;
        otherwise, the gatekeeper will log a warning each time it is started.
        </para>
        </note>
      </section>

      <section id="gram5-admin-deploying-xinetdconf">
        <title>Deploying GRAM5 via xinetd</title>
            <para>To deploy GRAM5 to be started via
            <application>xinetd</application>, create a file in the
            <filename>/etc/xinetd.d/</filename> directory (or the
            operating-system specific path to xinetd configuration files) called
            <filename>gsigatekeeper</filename>  with the following contents:

            <programlisting>service gsigatekeeper
{
    socket_type = stream
    protocol = tcp
    wait = no
    user = root
    env = LD_LIBRARY_PATH=<replaceable>GLOBUS_LOCATION</replaceable>/lib
    server = <replaceable>GLOBUS_LOCATION</replaceable>/sbin/globus-gatekeeper
    server_args = -conf <replaceable>GLOBUS_LOCATION</replaceable>/etc/globus-gatekeeper.conf
    disable = no
}</programlisting>

            After doing so, run the operating-system specific command to 
            have <application>xinetd</application> reload its configuration.
            </para>

        <important>
        <para>This example assumes that the <envar>LD_LIBRARY_PATH</envar>
        environment variable is needed to be able to run the GRAM5 programs and
        scripts. This is operating-system specific and may need to be changed.
        Consult the documentation for the operating system's runtime linker in
        the case of runtime problems.</para>
        
        <para>The <replaceable>GLOBUS_LOCATION</replaceable> string in the
        above example must be replaced with the actual path where GT
        has been installed.
        </para></important>

        <note>
        <para>
        When deploying GRAM5 via xinetd, be sure to include the command-line
        option <option>-inetd</option> in the gatekeeper configuration file;
        otherwise, the gatekeeper will log a warning each time it is started.
        </para>
        </note>
      </section>
  </section>

  <section id="gram5-admin-deploying-daemon"><title>Deploying GRAM5 as a daemon</title>
  <para>
    To deploy GRAM5 to be started as a daemon, run the
    <command>globus-gatekeeper</command> at boot time. This may be done in
    an init script, via cron, or other system-specific methods. The typical
    command-line to run is
    <programlisting><command>globus-gatekeeper <option>-conf <envar>$GLOBUS_LOCATION</envar>/etc/globus-gatekeeper.conf</option></command></programlisting>

  </para>

  <note>
    <para>
        When deploying GRAM5 as a daemon, be sure to include the command-line
        option <option>-f</option> in the gatekeeper configuration file;
        otherwise, the gatekeeper will log a warning each time it is started.
    </para>
  </note>
  </section>
</chapter>

<chapter id="gram5-admin-running-seg"><title>Running the SEG </title>
  <indexterm type="gram5"><primary>SEG</primary></indexterm>

  <section>
    <title>Starting the SEG</title>
   
      <para>
      GRAM5 can be configured to use the
      <command>globus-job-manager-event-generator</command> program to
      monitor job state changes. This is often more efficient than using
      a LRM adapter's <methodname>poll</methodname> method. This program
      is configured when the LRM-specific bundle is installed. However, by
      default, the job manager does not use the SEG. It must be explicitly
      enabled by adding the <option>-seg-module
      <replaceable>LRM</replaceable></option> option to the job manager
      configuration.
      </para>

      <para>
      To start the <command>globus-job-manager-event-generator</command>
      program, add the following command to your system init scripts or
      crontab to be run at boot time:

      <programlisting><command><envar>$GLOBUS_LOCATION</envar>/sbin/globus-job-manager-event-generator</command> <option>-scheduler</option> <replaceable>LRM</replaceable> <option>-background</option> <option>-pidfile</option> <replaceable>PIDFILE</replaceable></programlisting>
      </para>

      <para>
      This will start the <command>globus-job-manager-event-generator</command>
      to monitor jobs for the resource named by <replaceable>LRM</replaceable>
      in the background. The process id of the command will be written to the
      file named by <replaceable>PIDFILE</replaceable>, so that processes can
      check if it is running and kill it if necessary.
      </para>

      <para>
          <important>
              <para>
              If the job manager is configured to use a SEG module but the
              <command>globus-job-manager-event-generator</command> is not
              running for that LRM, jobs will appear to hang. It is 
              important that the program be running whenever GRAM5 jobs might
              be run.
              </para>
          </important>
      </para>
  </section>
  <section>
    <title>Stopping the SEG</title>

    <para>
    To stop the SEG, kill the
    <command>globus-job-manager-event-generator</command> process. The
    <option>-pidfile</option> option makes it easy to know which process to
    kill. When the SEG terminates, it will remove that file.
    </para>

    <example>
        <title>Starting and Stopping the SEG</title>

        <para>
        This example shows how to start and stop the SEG using the command-line
        options described above.
        </para>

        <screen><prompt>% </prompt><command>globus-job-manager-event-generator</command> <option>-scheduler pbs</option> <option>-background</option> <option>-pidfile</option> <filename><envar>$GLOBUS_LOCATION</envar>/var/globus-job-manager-seg-pbs.pid</filename>
<computeroutput>Running in background (78258)</computeroutput>
<prompt>% </prompt><command>kill</command> `<command>cat</command> <option><filename><envar>$GLOBUS_LOCATION</envar>/var/globus-job-manager-seg-pbs.pid</filename></option>`</screen>
    </example>
    </section>
</chapter>

  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
  href="../GRAM5_Performance_Guide.xml"/>
  
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
  href="../GRAM5_Audit_Logging.xml"/>
  
  <!--
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
  href="../GRAM5_SoftEnv_Support.xml"/>
  -->

<chapter id="gram5-admin-testing"><title>Testing</title>
	<para>See the user guide for information about submitting a test job.</para>
</chapter>

<chapter id="gram5-admin-security_considerations"><title>Security Considerations </title>
  <para>No special security considerations exist at this time.</para>
</chapter>

<chapter id="gram5-admin-debugging">
  <title>Admin Debugging</title>
  <para>By default, GRAM5 logs errors to
  <filename><envar>$HOME</envar>/gram_<replaceable>YYYYMMDD</replaceable>.log</filename>
  where <replaceable>YYYYMMDD</replaceable> is the time of the log event in
  GMT. The log file format conforms to <ulink url="http://www.cedps.net/index.php/LoggingBestPractices">CEDPS Logging Best Practices</ulink>. GRAM5 log files are governed by the log levels defined in the job manager configuration file. The log levels available are defined below:
  <table id="gram5-log-levels">
      <title>GRAM5 Log Levels</title>
      <tgroup cols='3' align='left' colsep='1' rowsep='1'>
        <colspec colname='gram5-log-level-name'/>
        <colspec colname='gram5-log-level-meaning'/>
        <colspec colname='gram5-log-level-default'/>
        <thead>
          <row>
            <entry>Level</entry>
            <entry>Meaning</entry>
            <entry>Default Behavior</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>FATAL</literal></entry>
            <entry>Problems which cause the job manager to terminate prematurely</entry>
            <entry>Enabled</entry>
          </row>
          <row>
            <entry><literal>ERROR</literal></entry>
            <entry>Problems which cause a job or operation to fail</entry>
            <entry>Enabled</entry>
          </row>
          <row>
            <entry><literal>WARN</literal></entry>
            <entry>Problems which cause minor problems with job execution or monitoring</entry>
            <entry>Disabled</entry>
          </row>
          <row>
            <entry><literal>INFO</literal></entry>
            <entry>Major events in the lifetime of the job manager and its jobs</entry>
            <entry>Disabled</entry>
          </row>
          <row>
            <entry><literal>DEBUG</literal></entry>
            <entry>Minor events in the lifetime of jobs</entry>
            <entry>Disabled</entry>
          </row>
          <row>
            <entry><literal>TRACE</literal></entry>
            <entry>Job processing details</entry>
            <entry>Disabled</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </para>

</chapter>

<!--
    This is the subset of the command-line interface that is configured by
    the admin
-->
<chapter id="gram5-admin-programs">
  <title>GRAM5 Admin Programs</title>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
    href="../globus-gram-audit-manual.xml"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
    href="../globus-job-manager-event-generator-manual.xml"/>
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
    href="../globus-job-manager-manual.xml"/>
</chapter>
    
  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
    href="../GRAM5_Troubleshooting_Frag.xml"/>

  <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
    href="../GRAM5_Usage_Statistics_Frag.xml"/>

<!--  LocalWords:  NOPASSWD
 -->
  <glossary role="auto" id="glossary-gram5Admin">
    <!-- 
    <remark>some terms not in the docs but wanted in glossary: 
    <glossterm>scheduler</glossterm>
    </remark>
    -->
    <glossdiv><title>A</title>
      <glossentry>
        <glossterm>Dummy term</glossterm>
        <glossdef>
          <para>This is a dummy entry for the automatic glossary database. Do not edit.</para>
        </glossdef>
      </glossentry>
    </glossdiv>
  </glossary>
  <index type="gram5">
    <title>Index</title>
</index>
</book>
