<title>Security Descriptors</title>
<section id="s-authzframe-secdesc-introduction"><title>Introduction</title> 

<para>Security descriptors contain various security properties like credentials,
  gridmap, required authentication and authorization mechanisms and so on. There are three
  kinds of security descriptors in the code base for setting container, service
  and resource security properties, respectively:</para> 
<itemizedlist> 
  <listitem><simpara>the service security descriptor</simpara></listitem> 
  <listitem><simpara>the container security descriptor</simpara></listitem> 
  <listitem><simpara>the resource security descriptor</simpara></listitem> 
</itemizedlist> 

<para>Each of these is represented as a object in the code base and can
  be altered programmatically. Service and container security
  descriptors can be configured as an XML file in the deployment
  descriptor as shown below.  Resource security descriptors can only
  be created dynamically either programmatically or from a descriptor
  file. If the security descriptor file is altered at runtime, it
  will <emphasis>not</emphasis> be reloaded</para>
</section>
<section id="s-authzframe-secdesc-configDesc"><title>Configuring security descriptors </title>
<para>The following shows how the service and container security descriptor files
are configured:</para>
<screen> &lt;globalConfiguration&gt;
...
&lt;parameter name="containerSecDesc" value="etc/container-security-config.xml"&gt;
 ...
&lt;globalConfiguration&gt;
...
&lt;service name="MyDummyService" provider="Handler" style="document"&gt;
 ...
&lt;parameter name="securityDescriptor" 
    value="org/globus/wsrf/impl/security/descriptor/security-config.xml"/&gt;
 ...
&lt;/service&gt;</screen> 

<para>If the security descriptor is configured to be read from a file, it is loaded as follows:
<orderedlist>
<listitem><simpara> As a file if absolute file path is specified</simpara></listitem>
<listitem><simpara> As a resource (can be included as part of jar file)</simpara></listitem>
<listitem><simpara> As a file, using the specified path to be relative to the
installation root, typically pointed to by environment variable
<envar>GLOBUS_LOCATION</envar></simpara></listitem>
</orderedlist>
</para>

<para> The security descriptor files need to comply with the <ulink
    url="service_security_descriptor.xsd">service security descriptor
    schema</ulink> or <ulink
    url="container_security_descriptor.xsd">container security
    descriptor schema</ulink> as appropriate. The resource security
    descriptor file uses the same schema as the service security
    descriptor. In all cases, the security descriptor is contained
    within the <constant>&lt;securityConfig 
    xmlns="http://www.globus.org"&gt;</constant> element.</para>

 </section>
<section id="s-authzframe-secdesc-descFile"><title>Writing security descriptor files </title> 

  <para> The next few sections deal with writing security descriptor
  files to set various properties. Please note that not all parameters
  are applicable for all three types of descriptors and are
  appropriately noted in the relevant sections. The few parameters
  relevant only for container security descriptor are described in <ulink
  url="#container">Section 5</ulink>.</para>

<section id="s-authzframe-secdesc-configCred"><title>Configuring credentials</title> 

  <para>The container and each service can also be configured with a
    separate set of credentials. The credentials can be set using
    either the a) path to a proxy file or b) path to a certificate and
    key file. If the configured credential file is modified/updated at
    runtime, the credentials will be automatically reloaded. This is
    done by adding the following block to the container or service
    security descriptor. </para>
 
  <para>Example for option (a):
<screen>&lt;securityConfig xmlns="http://www.globus.org"&gt;
&hellip;
&lt;credential&gt;
&lt;key-file value="keyFile"/&gt;
 &lt;cert-file value="certFile"/&gt;
&lt;/credential&gt;
&hellip;
&lt;/securityConfig&gt;</screen>
</para>

<para>
Example for option (b):

<screen>&lt;securityConfig xmlns="http://www.globus.org"&gt;
...
&lt;proxy-file value="proxyFile"/&gt;
...&lt;/securityConfig&gt;</screen> 
</para>

<para>The service will look for credentials in this order:
  <orderedlist> 
    <listitem><simpara> Resource credentials </simpara></listitem> 
    <listitem><simpara> Service credentials </simpara></listitem> 
    <listitem><simpara> Container credentials </simpara></listitem> 
    <listitem><simpara> Default credentials (uses the underlying security library to acquire
      the credentials, which will be the proxy certificate of the user that is
      running the container) </simpara></listitem> 
  </orderedlist> 
</para> 

</section>
<section id="s-authzframe-secdesc-configGridmap"><title>Configuring gridmap</title> 

  <para>The container and each service can be configured with a separate
    gridmap in its security descriptor as shown below:</para>

  <screen> &lt;securityConfig xmlns="http://www.globus.org"&gt;
...
&lt;gridmap value="gridMapFile"/&gt;
...
&lt;/securityConfig&gt;</screen> 

  <para>The service will look for gridmap configured first in resource,
    then service and then container. For services configured to perform
    gridmap file authorization, the gridmap file can be updated
    dynamically using the SecurityManager API. Also, if the gridmap
    file changes at runtime it will be automatically reloaded.</para>

</section>
<section id="s-authzframe-secdesc-configAuth"><title>Configuring Authentication Methods</title> 

  <para><emphasis>This can only be done at service or resource level.</emphasis> </para> 

  <para>The authentication methods a service requires are specified using
    the <constant>&lt;auth-method&gt;</constant> element.  The authentication
    methods can also be configured on a per method basis.  This is
    done by specifying the <constant>&lt;auth-method&gt;</constant> element
    within a <constant>&lt;method name="qname"&gt;</constant> element. The
    <emphasis>name</emphasis> attribute of the element can just be the operation
    name (preferred) or the operation name with a given namespace.</para>

  <para>Currently, the following authentication methods are supported:</para> 
  <table><title>TITLE</title>
<tgroup cols="2"><tbody> 
    <row> 
      <entry><constant>&lt;none/&gt;</constant></entry> 
      <entry><para>Indicates that no authentication is required.</para> 
        <para> This method <emphasis>cannot</emphasis> be specified with any
          other authentication method.</para></entry>
    </row> 
    <row> 
      <entry><constant>&lt;GSISecureMessage/&gt;</constant></entry> 
      <entry><para>Indicates the GSI Secure
            Message authentication method.</para>
        <para>The <constant>&lt;protection-level&gt; </constant>sub element can
          be used to specify a protection level that must be
          applied to the message:</para></entry>
    </row> 
    <row> 
      <entry><constant>&lt;integrity/&gt;</constant></entry> 
      <entry>Indicates that the message must be integrity protected
    (signed)</entry> </row>
    <row> 
      <entry><constant>&lt;privacy/&gt;</constant></entry> 
      <entry>Indicates that the message must be privacy protected
      (encrypted &amp; signed) </entry>
    </row> 
    <row> 
      <entry><constant>&lt;GSISecureConversation/&gt;</constant></entry>
      <entry><para>Indicates the GSI Secure
            Conversation authentication method (with integrity or
            privacy protection)</para>
        <para>The <constant>&lt;protection-level&gt;</constant> sub element can be used
          to indicate a specific protection level that must be applied to the
          message:</para></entry> 
    </row> 
    <row> 
      <entry><constant>&lt;integrity/&gt;</constant></entry> 
      <entry>Indicates that the message must be integrity protected (signed)</entry> 
    </row> 
    <row> 
      <entry><constant>&lt;privacy/&gt;</constant></entry> 
      <entry>Indicates that the message must be privacy protected (signed &amp; encrypted)</entry> 
    </row>
    <row> 
      <entry><constant>&lt;GSITransport/&gt;</constant></entry> 
      <entry><para>Indicates the GSI
            Secure Transport authentication method </para>
        <para>The <constant>&lt;protection-level&gt; </constant>sub element can be used
          to specify a specific protection level that must be applied to the
          message:</para></entry> 
    </row> 
    <row> 
      <entry><constant>&lt;integrity/&gt;</constant></entry> 
      <entry>Indicates that the message must be integrity protected
      (signed) This is always true in this mechanism</entry>
    </row> 
    <row> 
      <entry><constant>&lt;privacy/&gt;</constant></entry> 
      <entry>Indicates that the message must be privacy protected
      (encrypted &amp; signed) </entry>
    </row> 
  </tbody></tgroup>
</table> 

  <para><emphasis>Notes:</emphasis></para> 
  <itemizedlist> 

    <listitem><simpara>Multiple authentication methods can be specified under the
      <constant>&lt;auth-method&gt;</constant> element (expect for the
      <constant>&lt;none/&gt;</constant> method, see above) As long as one of
      the authentication methods is performed, the access to the
      service is allowed. </simpara></listitem>

    <listitem><simpara>If <emphasis>no</emphasis> <constant>&lt;protection-level&gt;</constant>
      sub element is specified, then all protection levels are
      available to clients. However, if the
      <constant>&lt;protection-level&gt;</constant> sub element
      <emphasis>is</emphasis> specified, then the service will only accept
      the protection levels listed under said element. </simpara></listitem>

    <listitem><simpara>The
      <constant>org.globus.wsrf.impl.security.authentication.SecurityPolicyHandler</constant>
      handler <emphasis>must</emphasis> be installed properly in order for
      this to work. This handler is installed by default.  </simpara></listitem>

    <listitem><simpara>If a security descriptor is <emphasis>not</emphasis> specified,
      authentication method enforcement is <emphasis>not</emphasis>
      performed.</simpara></listitem> </itemizedlist>

  <para><emphasis>Example:</emphasis></para> 

  <screen>&lt;securityConfig xmlns="http://www.globus.org"&gt;
&lt;method name="findServiceData"&gt;
&lt;auth-method&gt;
&lt;none/&gt;
&lt;/auth-method&gt;
&lt;/method&gt;
&lt;method name="destroy"&gt;
&lt;auth-method&gt;
&lt;GSISecureMessage/&gt;
&lt;GSISecureConversation&gt;
&lt;protection-level&gt;
&lt;integrity/&gt;
&lt;/protection-level&gt;
&lt;/GSISecureConversation&gt;
&lt;/auth-method&gt;
&lt;/method&gt;
&lt;!-- default auth-method for any other method --&gt;
&lt;auth-method&gt;
&lt;GSISecureConversation/&gt;
&lt;/auth-method&gt;
&lt;/securityConfig&gt;</screen> 

  <para>In the above example:</para> 
  <itemizedlist> 

	  <listitem><simpara> the <function>findServiceData()</function> operation does not require
    any authentication  </simpara></listitem>

    <listitem><simpara> the <function>destroy()</function> operation requires either <emphasis>GSI
        Secure Message</emphasis> authentication with either level of
        protection or <emphasis>GSI Secure Conversation</emphasis> authentication
        with integrity protection.  </simpara></listitem>

    <listitem><simpara>all other operations must be authenticated with <emphasis>GSI Secure
      Conversation</emphasis> with either level of protection.</simpara></listitem>

  </itemizedlist> 

 </section>
<section id="s-authzframe-secdesc-configRunas"><title>Configuring run-as mode</title> 

	<para>The <constant>&lt;run-as&gt;</constant> element is used to configure the
    JAAS run-as identity under which the service method will be
    executed. The run-as identity can be configured on a per method
    basis. Currently, the following run-as identities are
    supported:</para>

  <table><title>TITLE</title>
<tgroup cols="2"><tbody> 
    <row> 
	    <entry><constant>&lt;caller-identity/&gt;</constant></entry> 
      <entry><para>The service method will be run with the security identity
          of the client. The caller Subject will contain the following:</para> 
        <itemizedlist> 

          <listitem><simpara>If using <emphasis>GSI Secure Message</emphasis>: a GlobusPrincipal
            (the identity of the signer) is added to the principal set
            of the caller-identity Subject. Also, the signer's
            certificate chain is added to the public credentials set
            of the Subject object. </simpara></listitem>

          <listitem><para>If using <emphasis>GSI Secure Conversation</emphasis>: a
            GlobusPrincipal (the identity of the initiator) is added
            to the principal set of the Subject.  <itemizedlist>

              <listitem><simpara>If client authentication was performed, the client's
                certificate chain will be added to the public
                credentials set of the Subject object.  </simpara></listitem>

              <listitem><simpara>Also, if delegation was performed, the delegated
                credential is added to the private credential set of
                the Subject object. </simpara></listitem> 
            </itemizedlist> 
          </para></listitem> 
          <listitem><simpara>If gridmap file authorization was performed, a UserNamePrincipal
            is added to the principal set of the Subject object</simpara></listitem> 
        </itemizedlist></entry> 
    </row> 
    <row> 
	    <entry><constant>&lt;system-identity/&gt;</constant></entry> 
      <entry> The service method will be run with the security identity of the container.</entry> 
    </row> 
    <row> 
	    <entry><constant>&lt;service-identity/&gt;</constant></entry> 
      <entry>The service method will be run with the security identity of the service
        itself (if the service has one, otherwise the container identity will
        be used).</entry> 
    </row> 
    <row> 
	    <entry><constant>&lt;resource-identity/&gt;</constant></entry> 
      <entry>The service method will be run with the security identity of
      the resource. If no resource is specified or it does not have a
      configured subject, credential in this order of occurrence will
      be used: service credential, container credential.</entry>
    </row>
  </tbody></tgroup>
</table> 

  <para><emphasis>Notes:</emphasis> </para> 
  <itemizedlist> 
    <listitem><simpara> <emphasis>resource-identity</emphasis> is the default setting.
    </simpara></listitem>
    <listitem><simpara>The
		    <constant>org.globus.wsrf.impl.security.authentication.SecurityPolicyHandler</constant>
      handler <emphasis>must</emphasis> be installed properly in order for
      this to work.  </simpara></listitem>

    <listitem><simpara> If the security descriptor is <emphasis>not</emphasis> specified,
      then the run-as identity is not set and there will be no JAAS
      subject associated with the execution of the operation. This
      means that any method calls that require credentials and that
      are invoked by the service method itself will fail.</simpara></listitem>
  </itemizedlist> 

  <para><emphasis>Example:</emphasis></para> 
  <screen>&lt;securityConfig xmlns="http://www.globus.org"&gt;
&lt;method name="add"&gt;
&lt;run-as&gt;     &lt;caller-identity/&gt;   &lt;/run-as&gt;
&lt;/method&gt; &lt;method name="subtract"&gt;
&lt;run-as&gt;     &lt;system-identity/&gt;   &lt;/run-as&gt;
&lt;/method&gt; &lt;!-- default run-as for any other method --&gt;
&lt;run-as&gt; &lt;service-identity/&gt;&lt;/run-as&gt;&lt;/securityConfig&gt;</screen> 
  <para>In the above example:</para> 
  <itemizedlist> 
    <listitem><simpara> the <function>add()</function>operation will be run with the caller's identity  
    </simpara></listitem> 
    <listitem><simpara> the <function>subtract()</function>call will be run with the system identity 
    </simpara></listitem> 
    <listitem><simpara>all other operations will be run with the service identity (if the service
      has one set)</simpara></listitem> 
  </itemizedlist> 


 </section>
<section id="s-authzframe-secdesc-configAuthz"><title>Configuring authorization mechanism</title> 

  <para> The container and each service can be configured with a chain of
  authorization mechanisms (also known as Policy Decision Points (PDPs)),
  using the <emphasis>authz</emphasis> element. Each PDP name is scoped and the
  format is <emphasis>prefix:FQDN of the PDP</emphasis>. For example,
  <emphasis>self:org.globus.wsrf.impl.security.authorization.SelfAuthorization</emphasis>. The
  authorization is deemed to be a permit if each of the authorization
  mechanisms in the chain returns a permit.</para>

  <para><emphasis>Example:</emphasis></para> 
  <screen>&lt;securityConfig xmlns="http://www.globus.org"&gt;
...
&lt;authz value=&quot;foo1:org.foo.authzMechanism, bar1:org.bar.barMechanism&quot;/&gt;
 ...
&lt;securityConfig/&gt;</screen>

<para><emphasis>FIXME</emphasis>: detailed explanation may not be required here
</para>

<para> Each PDP is instantiated with some configuration information that
is used to get any further information that the PDP may need to make
authorization decisions. If the authorization chain is configured at the
container level, then the parameters are picked up from the global configuration
section of the container deployment descriptor. If the authorization chain is
configured at the service level, the PDPs will pick up parameters from the relevant
  service section of the deployment descriptor. Resource level configuration
  has to be done programmatically and is described <ulink url="#resDesc">here</ulink>.
  In all three cases, the prefix specified in the authorization chain configuration
  is used to get the right property. For example, all properties for
<emphasis><emphasis>foo1:org.foo.authzMechanism</emphasis></emphasis> are picked up from properties
that have been scoped with the prefix <emphasis><emphasis>foo1-</emphasis></emphasis></para>

<para> The following PDPs are a part of the toolkit and are configured as shown. The framework maps and plugs in the scoped name of the PDP at the time of authorization.
</para>
<table><title>TITLE</title>
<tgroup cols="2"><tbody> 
    <row> 
      <entry><constant>none</constant></entry> 
      <entry> No authorization is performed. </entry> 
    </row> 
    <row> 
      <entry><constant>self</constant></entry> 
      <entry><itemizedlist>

          <listitem><simpara> PDP Name:
          <constant>selfAuthz:org.globus.wsrf.impl.security.authorization.SelfAuthorization</constant></simpara></listitem>
          <listitem><simpara> This scheme does not require any additional configuration information.</simpara></listitem>
          <listitem><para>Only clients that present the same identity as the identity
          in the current JAAS subject associated with the service are
          allowed to access the service. </para>
        <para>The current JAAS subject is determined by the value of
          the run-as element in the service security descriptor (see <ulink url="#configRunas">Configuring run-as mode</ulink>)</para></listitem>
          </itemizedlist>
      </entry> 
    </row> 
    <row> 
      <entry><constant>gridmap</constant></entry> 
      <entry><itemizedlist>
          <listitem><simpara> PDP Name:
          <constant>grimapAuthz:org.globus.wsrf.impl.security.authorization.GridMapAuthorization</constant>
          </simpara></listitem>
	  <listitem><simpara>A gridmap file must be configured as described in <ulink
      url="#configGridmap">Section 2.1.2</ulink>.
          </simpara></listitem>
      <listitem><simpara>Gridmap file authorization is performed, i.e. a mapping must
      exist for the client identity in the configured grid map file.
          </simpara></listitem>
      </itemizedlist>        
      </entry>
    </row> 
    <row> 
      <entry><constant>identity</constant></entry> 
      <entry><itemizedlist>
          <listitem><simpara> PDP Name:
          <constant>idenAuthz:org.globus.wsrf.impl.security.authorization.IdentityAuthorization</constant></simpara></listitem>
      <listitem><simpara> The property, <constant>idenAuthz-identity</constant> set to the expected
      identity must be configured in the service or container
      deployment descriptor in the case of service level or container
      level authorization respectively.</simpara></listitem>
      <listitem><simpara> The client identity must match the value of this property.</simpara></listitem>
      </itemizedlist>        
      </entry>
    </row>
    <row> 
      <entry><constant>host</constant></entry> 
      <entry><para><itemizedlist>
          <listitem><simpara> PDP Name:
          <constant>hostAuthz:org.globus.wsrf.impl.security.authorization.HostAuthorization</constant></simpara></listitem>
      <listitem><simpara> The property, <constant>hostAuthz-url</constant> set to the expected host
      name must be configured in the service or container deployment
      descriptor in the case of service level or container level
      authorization respectively.</simpara></listitem>
      <listitem><simpara> Host based authorization is done and should match the
      expected host set in the property.</simpara></listitem>
      </itemizedlist>       </para> 
      </entry>
    </row>
    <row> 
      <entry><constant>samlCallout</constant></entry> 
      <entry><para><itemizedlist>
          <listitem><simpara> PDP Name:
          <constant>samlAuthz:org.globus.wsrf.impl.security.authorization.SAMLAuthorizationCallout</constant></simpara></listitem>
      <listitem><simpara> This scheme calls out to a configured <emphasis>LINKME</emphasis>
      OGSA-AuthZ compliant authorization service.</simpara></listitem>
      <listitem><simpara>The authorization service should be configured as a part of the
      service deployment descriptor using the property</simpara></listitem>
      <listitem><simpara><constant>authzService</constant>. The property should be set to the EPR of
      the authorization service to contact.</simpara></listitem>
      <listitem><simpara> The callout by default requests for simple decision from
      the authorization service <emphasis>LINK ME to OGSA-AuthZ stuff about
      this</emphasis>. This property can be changed by setting a container
      level property <constant>samlAuthzSimpleDecision</constant> to true or false.</simpara></listitem>
      <listitem><simpara> The callout by default does not sign the query request to 
      the authorization service <emphasis>LINK ME to OGSA-AuthZ stuff about
      this</emphasis>. This property can be changed by setting a container
      level property <constant>samlAuthzReqSigned</constant> to true or false</simpara></listitem>
      </itemizedlist>       </para> 
      </entry>
    </row>
    <row> 
      <entry><constant>userName</constant></entry> 
      <entry><itemizedlist>
          <listitem><simpara> PDP Name:
          <constant>userNameAuthz:org.globus.wsrf.impl.security.authorization.UsernameAuthorization</constant></simpara></listitem>
          <listitem><simpara> This scheme does not require any additional
          configuration information.</simpara></listitem>
      <listitem><simpara> This uses the configured <emphasis>LINKME</emphasis> JAAS Login Module to
      authorize the user based on username and password. The PDP uses
      <constant>NameCallback</constant> and <constant>PasswordCallback</constant> to send user
      name and password information to the Login module.</simpara></listitem>
      </itemizedlist>        
      </entry>
    </row>
</tbody></tgroup>
</table> 

<para>Other than these, any custom authorization scheme could be
	configured with its own configuration information. Refer to the <ulink
url="#customAuthz">next section</ulink> for details on writing a custom
authorization mechanism</para>

</section>
<section id="s-authzframe-secdesc-customAuthz"><title>Writing a custom authorization mechanism</title> 
  <para> The authorization handler can be configured to call out to a custom authorization
    class. The class must implement the interface <constant>org.globus.wsrf.impl.security.PDP</constant>. </para> 
  <para>If the authorization fails, then a <constant>org.globus.wsrf.impl.security.authorization.AuthorizationException</constant> should
    be thrown.</para> 
  <para><emphasis> Example: </emphasis> 
  </para> 
  <screen>  public class FooAuthorization implements PDP {
public void authorize(Subject peerSubject, ServiceProperties service,
	  MessageContext context) 
	throws AuthorizationException {
	// Evaluate and throw exception if not authorized.
      }
  }
</screen> 


  <para><emphasis>Example:</emphasis></para> 
  <screen>&lt;securityConfig xmlns="http://www.globus.org"&gt;
&lt;method name="findServiceData"&gt;
&lt;run-as&gt;
&lt;caller-identity/&gt;
&lt;/run-as&gt;
&lt;/method&gt;
&lt;method name="destroy"&gt;
&lt;run-as&gt;
&lt;system-identity/&gt;
&lt;/run-as&gt;
&lt;/method&gt;
&lt;!-- default run-as for any other method --&gt;
&lt;run-as&gt;
&lt;service-identity/&gt;
&lt;/run-as&gt;
&lt;context-lifetime value="100"/&gt;
&lt;/securityConfig&gt;</screen> 

  <para>In the above example, if the service is accessed using a limited
    proxy, an error is reported. Also, the contexts created at the
    server end are set to have a lifetime of 100 seconds. </para>

</section>
</section>
<section id="s-authzfram-secdesc-descProgram"><title>Programmatic altering of security descriptor </title> 

  <para>The security descriptor (container, security and resource) can be
    created and altered programmatically (as opposed to writing a
    security descriptor file) For the service and container
    descriptor, we recommend writing a security descriptor file so
    that the security properties are initialized at start up.</para>

  <table><title>TITLE</title>
<tgroup cols="2"><tbody> 
    <row> 
	    <entry>Container Security Descriptor</entry> 
	    <entry><para>This is represented by <constant>org.globus.wsrf.impl.security.descriptor.ContainerSecurityDescriptor</constant>. </para> 
        <para>If a container security descriptor file is configured as
          described in <ulink url="#configDesc">Section 2</ulink>, then an
          object is created and stored. To alter the values, use the
          API provided in
          <constant>org.globus.wsrf.impl.security.descriptor.ContainerSecurityConfig</constant>.</para></entry>
    </row> 

    <row> 
      <entry>Service Security Descriptor</entry> 
      <entry><para>This is represented by
      <constant>org.globus.wsrf.impl.security.descriptor.ServiceSecurityDescriptor</constant>. </para>
        <para>If a service security descriptor file is configured as
            described in <ulink url="#configDesc">Section 2</ulink>, then an
            object is created and stored. To alter the values, use the
            API provided in
            <constant>org.globus.wsrf.impl.security.descriptor.ServiceSecurityConfig</constant>.</para></entry>
    </row> 
    <row> 
      <entry>Resource Security Descriptor</entry> 
      <entry><para>This is represented by <constant>org.globus.wsrf.impl.security.descriptor.ResourceSecurityDescriptor</constant>. </para> 
        <para>To initialize the descriptor, i.e. load credentials and gridmap, use
          the API in <constant>org.globus.wsrf.impl.security.descriptor.ResourceSecurityDescriptor</constant> .
          Refer to the description of resource security descriptor in <ulink url="#resDesc">Section
          4.1</ulink> for more details.</para></entry> 
    </row> 
  </tbody></tgroup>
</table> 
</section>
<section id="s-authzframe-secdesc-resDesc"><title>Resource Security Descriptor</title> 

<para> Resource level security can be set using a resource security
descriptor, which overrides any service or container level
security. To make a resource secure, it needs to implement
<constant>org.globus.wsrf.impl.security.SecureResource</constant>.  This
interface has a method that returns an instance of
<constant>org.globus.wsrf.impl.security.descriptor.ResourceSecurityDescriptor</constant>. If
<constant>null</constant> is returned, it is assumed that no security is set
on the resource. </para>

  <para>The resource security descriptor is identical to the service
    security descriptor and contains API to set and get all properties
    that are described in <ulink url="#descFile">Section 2</ulink>. A
    descriptor file can also be used to create this object. The file
    needs to be written as described in <ulink url="#descFile">Section
    2</ulink>.</para>

  <para><emphasis>Examples: </emphasis> 
  </para>
  <para>The following code snippet creates a resource descriptor object directly: 
  </para>

  <screen>ResourceSecurityDescriptor desc = new ResourceSecurityDescriptor();
desc.setRejectLimitedProxy("true");</screen> 

  <para>The following code snippet creates a resource descriptor object
  from a file: </para>

  <screen>  ResourceSecurityConfig config = new ResourceSecurityConfig("resDescFileName");
config.init();
ResourceSecurityDescriptor desc = config.getSecurityDescriptor();</screen> 

  <para>
  There are two attributes of the security descriptor,
  <emphasis>credentials</emphasis> and <emphasis>gridmap</emphasis>, that can
  be specified as objects (<constant>javax.security.auth.Subject</constant> and
  <constant>org.globus.security.gridmap.GridMap</constant> respectively) or as paths to
  credentials and the gridmap file. Similarly, the <emphasis>service
  authorization chain</emphasis> object or a comma separated list of PDP
  names can be specified. In each of these cases, if the properties are
  configured as filenames or PDP names as the case may be, the helper API in
  <constant>org.globus.wsrf.impl.security.descriptor.ResourceSecurityConfig</constant>
  can be used to load the classes.  The credentials, gridmap and PDP
  specified in the authorization chain are loaded if the property
  <constant>initialized</constant> in the descriptor is set to
  <constant>false</constant>.
  </para>

  <para>For example, the code snippet below is a descriptor that has a
    gridmap file and specifies authorization chain. When
    <function>config.init()</function> is called, gridmap is loaded and an
    instance service authorization chain class is created. The
    configuration information for the service
    authorization chain is by default picked up from global deployment
    descriptor. To provide for other PDP configuration, it needs to be
    set programmatically, as shown <ulink url="#programPDPConfig">here</ulink>.</para>
  
  <screen>ResourceSecurityDescriptor desc = new ResourceSecurityDescriptor();
desc.setGridMapFile("foo/bar/gridmap");
desc.setAuthz("customAuthz:org.globus.some.customAuthz, foo1:org.foo.barAuthz");
ResourceSecurityConfig config = new ResourceSecurityConfig(desc);
config.init();</screen> 

  <para> If the descriptor property changes, a reload can be forced by setting <constant>setInitialized</constant> to <constant>false</constant>:</para> 

  <screen> desc.setInitialized(false); desc.setGridMapFile("foo/bar/newGridMap"); config.init();</screen>

  <para> GridMap and Subject object can also be set directly,
    i.e. without configuring files to be read:</para>


  <screen>desc.setInitialized(false);
GridMap map = new GridMap();
map.map("Some user DN", "userid");
desc.setGridMap(map);</screen> 

  <para id="programPDPConfig">Service Authorization can also be set directly
    by creating an object of <constant>org.globus.wsrf.impl.security.authorization.ServiceAuthorizationChain</constant>.
    The chain needs to be initialized with an object implementing the <constant>org.globus.wsrf.security.authorization.PDPConfig</constant> interface.
    The <constant>org.globus.wsrf.impl.security.descriptor.ResourceSecurityDescriptor</constant> class
    has API to initialize a PDP using a said PDPConfig class. The distribution
    has a few sample classes that implement <constant>org.globus.wsrf.security.authorization.PDPConfig</constant> interface
    and are described below: 
  <itemizedlist>

<listitem><simpara><constant>org.globus.wsrf.impl.security.authorization.ContainerPDPConfig</constant>:
Reads configuration information off the global deployment descriptor.
</simpara></listitem>

<listitem><simpara><constant>org.globus.wsrf.impl.security.authorization.ServicePropertiesPDPConfig</constant>:
Reads configuration information off a said service's deployment
descriptor.
</simpara></listitem>

<listitem><simpara><constant>org.globus.wsrf.impl.security.authorization.ResourcePDPConfig</constant>:
Reads configuration information off of a hashmap stored in memory.
</simpara></listitem>
</itemizedlist>
</para>

<para>Examples</para>

<para> This sample creates a authorization chain to be set on the
resource security descriptor programmatically:</para>

<screen>// Create a resource security descriptorResourceSecurityDescriptor
desc = new ResourceSecurityDescriptor();
// Configure a chain of PDPsString
authzChain = "identityAuthz, custom:org.something.CustomAuthz";
// Create configuration object that implements PDPConfig
interfacePDPConfig config = new ResourcePDPConfig();
// Set properties that are required by the PDPs on the configuration object.
// Property used by Identity authorization: scope, property name, property
valueconfig.setProperty("idenAuthz", "identity", "O=this, OU=is expected, CN=identity");
// Property used by CustomAuthz: scope, property name, property
valueconfig.setProperty("custom", "someProp", "foo");
desc.setAuthzChain(authzChain, config, "Name of Chain", "Some id");</screen>

</section>
<section id="s-authzframe-secdesc-container"><title>Container-only Security Configuration</title> 
	<para> Other than the security properties that have been described in <ulink
url="#Descriptor">Security Descriptor</ulink>, two more properties are exclusive
  to the container security descriptor.
</para>
<itemizedlist> 
  <listitem><para> When <emphasis>GSI Secure Conversation</emphasis> is used, a security context is established.
    A sweeper task is run every 10 minutes to delete all expired contexts. This
    interval can be set (in milliseconds) in the container security descriptor
    as shown below:
    <screen>&lt;securityConfig xmlns="http://www.globus.org"&gt;
 ... 
&lt;context-lifetime value="10000"/&gt;
 ... 
&lt;/securityConfig&gt;</screen> 
  </para></listitem> 
  <listitem><para> For message level security one may also set the amount of time for which to track received messages for the purpose of preventing replay attacks. Messages outside of this window will be reject automatically, whereis messages in this window are checked against recently received messages through the use of the message UUID. This window can be configured (in milliseconds) as shown below:
  <screen>&lt;securityConfig xmlns="http://www.globus.org"&gt;
 ... 
&lt;replay-attack-interval value="100"/&gt;
 ... 
&lt;/securityConfig&gt;</screen> </para></listitem>
</itemizedlist> 

  </section>
<section id="s-authzframe-secdesc-configOthers"><title>Other Configuration</title> 
  <para><emphasis>FIXME</emphasis> Configuring container security descriptor at command line?</para>
</section>
