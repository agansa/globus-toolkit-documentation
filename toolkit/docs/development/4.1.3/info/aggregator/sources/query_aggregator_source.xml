<title>Query Aggregator Sources in MDS4</title>
<titleabbrev>Query Aggregator Sources</titleabbrev>

<section id="aggregator-query_aggregator_source-intro"><title>Introduction</title>
    <para>The ExecutionAggregatorSource gathers arbitrary XML information
        about a registered resource by executing an external script and
        passing registration as parameters. </para>
</section>

<section id="aggregator-query_aggregator_source-config-registration"><title>Configuration file: general parameters</title>
    &aggregator_sources_general_config;
</section>

<section id="aggregator-query_aggregator_source-config-QueryAggregatorSource"><title>Configuration file: parameters for the query aggregator source</title>
<para>The QueryAggregatorSource can use one of the following three
    configuration blocks in the <constant>Content</constant> block: GetResourcePropertyPollType, GetMultipleResourcePropertiesPollType and QueryResourcePropertiesPollType.</para>

    <section id="aggregator-query_aggregator_source-config-GetResourcePropertyPollType"><title>
GetResourcePropertyPollType</title>
<para>
If a <constant>GetResourcePropertyPollType</constant> block is used, QueryAggregatorSource will request a single resource property. The block has this form:
<screen>
&lt;Content xsi:type="agg:AggregatorContent"
  xmlns:agg="http://mds.globus.org/aggregator/types"&gt;
  &lt;agg:AggregatorConfig xsi:type="agg:AggregatorConfig"&gt;
    &lt;agg:GetResourcePropertyPollType&gt;
      &lt;agg:<emphasis>PollIntervalMillis</emphasis>&gt;<emphasis>interval_in_ms</emphasis>&lt;/agg:<emphasis>PollIntervalMillis</emphasis>&gt;
      &lt;agg:<emphasis>ResourcePropertyName</emphasis>&gt;<emphasis>rp_namespace</emphasis>:<emphasis>rp_localname</emphasis>&lt;/agg:<emphasis>ResourcePropertyName</emphasis>&gt;
    &lt;/agg:GetResourcePropertyPollType&gt;
  &lt;/agg:AggregatorConfig&gt;
  &lt;agg:AggregatorData/&gt;
&lt;/Content&gt;
</screen>
</para>
    
    <para>where:</para>
    <variablelist>  
        <varlistentry>
            <term><constant>PollIntervalMillis</constant></term>
            <listitem><para> This parameter is the poll refresh period in milliseconds; the <constant>ResourcePropertyName</constant>
                parameter is the QName of the resource property to poll for.</para></listitem>
        </varlistentry>
    </variablelist>
</section>
    
    <section id="aggregator-query_aggregator_source-config-GetMultipleResourcePropertiesPollType"><title>GetMultipleResourcePropertiesPollType</title>
<para>If a <constant>GetMultipleResourcePropertiesPollType</constant> block is
used, <constant>QueryAggregatorSource</constant> will request one or more
resource properties. The block has this form:
<screen>
&lt;Content
    xmlns:agg="http://mds.globus.org/aggregator/types"
    xsi:type="agg:AggregatorContent"&gt;
  &lt;agg:AggregatorConfig xsi:type="agg:AggregatorConfig"&gt;
    &lt;agg:GetMultipleResourcePropertiesPollType&gt;
      &lt;agg:<emphasis>PollIntervalMillis</emphasis>&gt;<emphasis>interval_in_ms</emphasis>&lt;/agg:<emphasis>PollIntervalMillis</emphasis>&gt;
      &lt;agg:<emphasis>ResourcePropertyNames</emphasis>&gt;<emphasis>rp1_namespace</emphasis>:<emphasis>rp1_localname</emphasis>&lt;/agg:<emphasis>ResourcePropertyNames</emphasis>&gt;
      &lt;agg:<emphasis>ResourcePropertyNames</emphasis>&gt;<emphasis>rp2_namespace</emphasis>:<emphasis>rp3_localname</emphasis>&lt;/agg:<emphasis>ResourcePropertyNames</emphasis>&gt;
      &lt;agg:<emphasis>ResourcePropertyNames</emphasis>&gt;<emphasis>rp3_namespace</emphasis>:<emphasis>rp3_localname</emphasis>&lt;/agg:<emphasis>ResourcePropertyNames</emphasis>&gt;
    &lt;/agg:GetMultipleResourcePropertiesPollType&gt;
  &lt;/agg:AggregatorConfig&gt;
  &lt;agg:AggregatorData/&gt;
&lt;/Content&gt;
</screen>
</para>
    
    <para>where:</para>
    <variablelist>  
        <varlistentry>
            <term><constant>PollIntervalMillis</constant></term>
            <listitem><para> This parameter is the poll refresh period in milliseconds; the <constant>ResourcePropertyNames</constant> 
                parameters are the QNames of the resource properties to poll for. There is no limit on the number of
                <constant>ResourcePropertyNames</constant> that may be specified.</para></listitem>
        </varlistentry>
    </variablelist>
</section>
    
    <section id="aggregator-query_aggregator_source-config-QueryResourcePropertiesPollType"><title>QueryResourcePropertiesPollType</title>
    <para>If a <constant>QueryResourcePropertiesPollType</constant> block is used,
        QueryAggregatorSource will request that a query be executed against
        the Resource Property Set of the remote resource. In the GT4
        implementation of WSRF Core, the only query language that is
        supported is XPath. The block has this form:
        <screen>
            &lt;Content
            xmlns:agg="http://mds.globus.org/aggregator/types"
            xsi:type="agg:AggregatorContent"&gt;
            &lt;agg:AggregatorConfig xsi:type="agg:AggregatorConfig"&gt;
            &lt;agg:QueryResourcePropertiesPollType&gt;
            &lt;agg:<emphasis>PollIntervalMillis</emphasis>&gt;<emphasis>interval_in_ms</emphasis>&lt;/agg:<emphasis>PollIntervalMillis</emphasis>&gt;
            &lt;agg:<emphasis>QueryExpression</emphasis> Dialect="<emphasis>dialect</emphasis>"&gt;
            <emphasis>Query Expression</emphasis>
            &lt;/agg:<emphasis>QueryExpression</emphasis>&gt;
            &lt;/agg:QueryResourcePropertiesPollType&gt;
            &lt;/agg:AggregatorConfig&gt;
            &lt;agg:AggregatorData/&gt;
            &lt;/Content&gt;
        </screen>
    </para>
    
    <para>where:</para>
    <variablelist>  
        <varlistentry>
            <term><constant>PollIntervalMillis</constant></term>
            <listitem><para> This parameter is the poll refresh period in milliseconds. The <constant>QueryExpression</constant> is an 
                <constant>xsd:any</constant> element; the <constant>Dialect</constant> attribute specifies the dialect of the query expression.</para></listitem>
        </varlistentry>
    </variablelist>
    </section>
    </section>