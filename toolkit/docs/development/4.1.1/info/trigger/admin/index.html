<?php 
$title="GT 4.0 WS MDS Trigger Service: System Administrator's Guide";
include_once( "/mcs/www-unix.globus.org/include/globus_header.inc" ); ?>

<?php
include_once( "http://www-unix.globus.org/toolkit/docs/development/4.0-drafts/draft.inc" );
?>

<h1><?php echo $title; ?></h1>
<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li> <a href="#installing">Building and Installing</a></li>
  <li><a href="#configuring">Configuring</a></li>
  <li><a href="#deploying">Deploying</a></li>
  <li><a href="#testing">Testing</a></li>
  <li><a href="#security_considerations">Security Considerations </a></li>
  <li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
<h2><a name="introduction" id="introduction"></a>Introduction</h2>
<p>
   This guide contains advanced configuration information for system administrators
  working with the WS MDS Trigger Service. It provides references to information
     on procedures typically performed by system administrators, including installation,
     configuring, deploying, and testing the installation.</p>

<P>This information is in addition to the basic installation instructions in
  the <a href="../../../admin/docbook/">GT 4.0 System Administrator's Guide</a>.</P>
<h2><a name="installing" id="installing"></a>Building and Installing</h2>
<p>The Trigger service is installed as part of the standard Globus
Toolkit installation.</p>
<h2><a name="configuring" id="configuring"></a>Configuring </h2>
<?php
include_once( "./../WS_MDS_Trigger_Interface_Config_Frag.html" );
?>
<h2><a name="deploying" id="deploying"></a>Deploying</h2>
<p>This component is deployed as part of the standard toolkit installation. By
  default, there are no trigger actions set to fire on container startup, as
  these must be configured and registered manually. To manually register the
  example described in [Configuring], do the following:</p>
<table width="500" border="1" cellspacing="0" cellpadding="3">
  <tr>
    <td valign="top">1</td>
    <td><p>Configure your environment with either Ganglia or Hawkeye as described
        in the <a href="../../key/gluerp.html">GLUE
RP documentation</a>. This is necessary because the trigger service
relies on polling the GLUE RP which is provided by either one of them.
        </p>
      <p>Note: Even without configuring Ganglia or Hawkeye,
          the GLUE RP is emitted by the scheduler configured for your environment,
    so this step is not strictly necessary.</p></td>
  </tr>
  <tr>
    <td valign="top">2</td>
    <td><p>Now you can start your container as you normally do by running:</p>
      <pre>$GLOBUS_LOCATION/bin/globus-start-container</pre></td>
  </tr>
  <tr>
    <td valign="top">3</td>
    <td><p>At this point, we're ready to make a registration with the <code>DefaultTriggerService</code>        by running a command similar to the following:</p>
<pre>$GLOBUS_LOCATION/bin/mds-servicegroup-add -s https://127.0.0.1:8443/wsrf/services/DefaultTriggerService \        
     $GLOBUS_LOCATION/etc/globus_wsrf_mds_trigger/trigger-aggregator-registration.xml</pre>
      <p>You should see output similar to the following if your environment has
        been configured properly:</p>
      <pre>Processing configuration file...
Processed 1 registration entries
Successfully registered
https://127.0.0.1:8443/wsrf/services/ManagedJobFactoryService to servicegroup at 
https://127.0.0.1:8443/wsrf/services/DefaultTriggerService
     </pre></td>
  </tr>
</table>
<p>&nbsp;</p>
<h2><a name="testing" id="testing"></a>Testing</h2>
<p>To determine if the registration was made properly, you can query the <code>DefaultTriggerService</code>  using a tool like <code>$GLOBUS_LOCATION/bin/wsrf-query</code> and visually inspect the
output. </p>
<p>For example, running:</p>
<pre>$GLOBUS_LOCATION/bin/wsrf-query -s \
     https://127.0.0.1:8443/wsrf/services/DefaultTriggerService &quot;/*&quot;</pre>
<p> should
yield output similar to the following for the example above:</p>
<pre>...
  &lt;ns1:Content xsi:type="ns11:AggregatorContent"
  xmlns:ns11="http://mds.globus.org/aggregator/types"&gt;
   &lt;ns11:AggregatorConfig&gt;
    &lt;ns11:GetResourcePropertyPollType&gt;
                &lt;ns11:PollIntervalMillis&gt;600000&lt;/ns11:PollIntervalMillis&gt;
                &lt;ns11:ResourcePropertyName&gt;glue:GLUECE&lt;/ns11:ResourcePropertyName&gt;
         &lt;/ns11:GetResourcePropertyPollType&gt;
    &lt;ns3:TriggerRuleType
    xmlns:ns3="http://mds.globus.org/2004/08/trigger/types"&gt;
                &lt;ns3:matchingRule&gt;//*[local-name()='GLUECE']&lt;/ns3:matchingRule&gt;
                &lt;ns3:actionScript&gt;glue-trigger-action.sh&lt;/ns3:actionScript&gt;
                &lt;ns3:minimumFiringInterval&gt;600&lt;/ns3:minimumFiringInterval&gt;
         &lt;/ns3:TriggerRuleType&gt;
   &lt;/ns11:AggregatorConfig&gt;
   &lt;ns11:AggregatorData&gt;
    &lt;ns12:TriggerStatus&gt;
     &lt;ns12:conditionTrueSince&gt;2005-04-11T16:31:00.501Z&lt;/ns12:conditionTrueSince&gt;
     &lt;ns12:actionFiredAt&gt;2005-04-11T16:31:00.656Z&lt;/ns12:actionFiredAt&gt;
     &lt;ns12:ruleLastCheckedAt&gt;2005-04-11T16:31:00.493Z&lt;/ns12:ruleLastCheckedAt&gt;
     &lt;ns12:actionOutput&gt;
      &lt;exampleGLUETriggerActionScriptOutput xmlns=""&gt;
        &lt;glueDataDetected&gt;true&lt;/glueDataDetected&gt;
      &lt;/exampleGLUETriggerActionScriptOutput&gt;
     &lt;/ns12:actionOutput&gt;
    &lt;/ns12:TriggerStatus&gt;
   &lt;/ns11:AggregatorData&gt;
  &lt;/ns1:Content&gt;
...</pre>
<p>The included sample trigger script not only emits some XML data as seen above
  in the <code>actionOutput</code> node, but it also attempts to append
  some data to a file each time it is fired. Thus, to be sure it is working properly,
  you can inspect the file <code>/tmp/glue_detected</code> by running a
command like</p>
<pre>cat /tmp/glue_detected</pre>
<p>which should yield output
  similar to this:</p>
<pre>GLUECE RP was detected in the output at Mon Apr 11 11:01:01 CDT 2005 
GLUECE RP was detected in the output at Mon Apr 11 11:11:00 CDT 2005 
GLUECE RP was detected in the output at Mon Apr 11 11:21:00 CDT 2005 
GLUECE RP was detected in the output at Mon Apr 11 11:31:00 CDT 2005 
GLUECE RP was detected in the output at Mon Apr 11 11:41:00 CDT 2005</pre>
<h2><a name="security_considerations"></a>Security Considerations </h2>
<?php
include_once( "./../WS_MDS_Trigger_Security_Considerations_Frag.html" );
?>
<h2><a name="troubleshooting" id="troubleshooting"></a>Troubleshooting</h2>
<p>If you're sure that the registration was made properly, but the trigger script
  never fires, please verify that you've properly configured the GLUE RP output
  via Ganglia or Hawkeye. Even a properly made trigger registration will never
fire if the GLUE RP cannot be produced.</p>
<?php include("/mcs/www-unix.globus.org/include/globus_footer.inc"); ?>
