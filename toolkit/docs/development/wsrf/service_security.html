<?php

$title = "GT 3.9.0 Java WSRF Core Preview: Service-side Message Level Security;

include_once( "/mcs/www-unix.globus.org/include/globus_header.inc" ); 
?>

  <link href="file:///C|/Documents%20and%20Settings/cristina/My%20Documents/staging/documentation/web/style.css" rel="stylesheet" type="text/css">

  <style type="text/css">
<!--
.style1 {color: #FF00FF}
-->
  </style>
<p class="small"><a href="http://www.globus.org">Globus</a> &gt; <a href="http://www-unix.globus.org/toolkit/">Toolkit</a> &gt; <a href="http://www-unix.globus.org/toolkit/docs/">Documents</a> &gt; <a href="http://www-unix.globus.org/toolkit/docs/development/index.html">Development</a> &gt; <a href="http://www-unix.globus.org/toolkit/docs/development/wsrf/index.html">WSRF</a> &lt; </p>

<h1>GT 3.9.0 Java WSRF Core Preview: Service-side Message Level Security</h1>

<p>Please report any errors or suggestions to our <a
href="http://bugzilla.globus.org/bugzilla/enter_bug.cgi?product=Documentation">Bugzilla
system</a>.</p>

<ol>
  <li><a href="#Introduction">Introduction</a></li>
  <li><a href="#WSDL">WSDL</a></li>
  <li><a href="#Descriptor">Security Descriptor</a>
    <ul>
      <li><a href="#descFile">Writing security descriptor file</a></li>
      <li><a href="#descProgram">Programatic altering of security descripors</a></li>
    </ul>
  </li>
  <li><a href="#resource">Secure Resources</a></li>
  <li><a href="#securityAPI">Useful Security API</a></li>
  <li><a href="#limitations">Limitations</a></li>
  <li><a href="#otherFeatures">Other Features</a>
    <ul>
      <li><a href="#replayAttack">Replay Attack Prevention</a></li>
      <li><a href="#customAuthz">Writing custom authorization</a></li>
    </ul>
  </li>
  <li><a href="#container">Container-only Security Configuration</a></li>
  <li><a href="#Errors">Errors</a></li>
</ol>

<h3><a name="Introduction"></a>1. Introduction</h3>

<p> Security can be set at container level, service level or resource
level, using a security descriptor to specify the desired security
properties. Not all properties can be set at each level, but
typically, the security property value is obtained by looking for
property presence in this order: resource level proeprty, service
level proeprty and then container level property. If not set, defaults
are used in some cases and in some others error is reported.</p>

<p> For container and service level security, no code modifications are necessary in general, and can be set using a security descriptor. That being
said, minor code modifications might be needed for specialized
purposes such as setting the service owner with the caller's delegated
credential (e.g. in cases where a service is supposed to be accessed
only by a specific user -- the user that created it)</p>

<p> For secure resources, code modifications need to be done as
described in <a href="#resource">Section 4</a>.</p>

<h3><a name="#WSDL"></a>2. WSDL</h3>

<p>No WSDL changes are necessary.</p>

<h3><a name="Descriptor"></a>3. Security Descriptor</h3>

<p>There are three kinds of security descriptor in the code base for setting
  container, service and resource security properties respectively:</p>
<ul>
  <li>service security descriptor</li>
  <li>container security descriptor</li>
  <li>resource security descriptor</li>
</ul>
<p>Each of these are
  represented as objects in the code base and can be altered
  programatically. Service and container security descriptors can be
  configured in as a XML file in the deployment descriptor
  (server-config.wsdd) as shown below. Resource security descriptors can
  only be created programatically and have been described in <a href="#resource">Secure
  Resource</a>.</p>
<pre class="command"> &lt;globalConfiguration&gt;<br> ...<br>  &lt;parameter name="containerSecDesc" value="org/wsrf/inpl/security/container-security-config.xml"&gt;<br> ...<br> &lt;globalConfiguration&gt;<br> ...<br> &lt;service name="my/dummy/service" provider="Handler" style="wrapped"&gt;<br>  ...<br>  &lt;parameter name="securityDescriptor" value=<span
 style="font-weight: bold;"></span>"org/globus/ogsa/impl/security/descriptor/security-config.xml"/&gt;<br>  ...<br> &lt;/service&gt;</pre>
<p>It is loaded in the same way as any other resource data, i.e. from
the class path. This allows the security descriptor to be included in
the same .jar file as rest of the service code.The security deployment
descriptor will not be reloaded if it is changed at runtime.</p>

<p> The security descriptor files need to comply with the <a href="service_security_descriptor.xsd">service security descriptor schema</a> or <a href="container_security_descriptor.xsd">container security descriptor schema</a> as the case maybe. 
  The security deployment descriptor is contained within the <code>&lt;securityConfig
 xmlns="http://www.globus.org"&gt;</code> element.</p>

<blockquote>
  <h4><a name="#descFile"></a> 3.1 Writing security descriptor file </h4>
  <h5><a name="configCred"></a>3.1.1 Configuring Credentials</h5>
    <p>The container and each service can also be configured with a separate set
    of credentials. Either a) path to a proxy file or b) path to a
    certficate and key file can be used to set the credentials. This is
    done by adding the following block to the container or service
    security descriptor.
    
  </p>
  <pre class="command"> &lt;securityConfig xmlns="http://www.globus.org"&gt;<br> ...<br> &ltcredential&gt;<br>  &lt;key-file value="keyFile"/&gt;<br>  &lt;cert-file value="certFile"/&gt;<br> &lt;/credential&gt<br> ...<br> &lt;/securityConfig&gt;

&lt;securityConfig xmlns="http://www.globus.org"&gt;<br> ...<br> &lt;proxy-file value="proxyFile"/&gt;<br> ...<br> &lt;/securityConfig&gt;</pre>
    <p>The service will look for credentials in this order:</p>
    <ol>
      <li> Resource credentials </li>
      <li> Service credentials </li>
      <li> Container credentials </li>
      <li> Default credentials (uses the underlaying security library to
       acquire the credentials, which will be the proxy certificate of the
       user that is running the container) </li>
    </ol>
    <p> Should the configured credentials files change while the container
    is running, they will be automatically reloaded.</p>
  <h5><a name="configGridmap"></a>3.1.2 Configuring Gridmap</h5>
    <p>The container and each service can be configured with a separate Gridmap in its
    security descriptor.
    </p>
  <pre class="command"> &lt;securityConfig xmlns="http://www.globus.org"&gt;<br> ...<br> &lt;gridmap value="gridMapFile"/&gt;<br> ...<br> &lt;/securityConfig&gt;</pre>
    <p>The service will look for gridmap configured in resource, then
    service and then in container.</p>
    <p>For services configured to perform gridmap file authorization, the
    gridmap file can be updated dynamically using the SecurityManager
    API. Also, if the gridmap file changes at runtime it will be
    automatically reloaded.</p>
  <h5><a name="configAuth"></a>3.1.3 Configuring Authentication Methods</h5>
    <p><b>This can be done only at service or resource level.</b>
    
</p>

    <p>The authentication methods a service requires are specified
    using the <code>&lt;auth-method&gt;</code> element.  The
    authentication methods can also be configured on a per method
    basis. This is done by specifying <code>&lt;auth-method&gt;</code> element
    within the <code>&lt;method name="qname"&gt;</code> elements. The
    <i>name</i> attribute of the method can just be the operation name
    (preferred) or the operation name with a given namespace.</p>

Currently,
    the following authentication methods are supported:</p>

<table width="650" border="1" cellpadding="5">
  <tr>
    <td valign="top"><code>&lt;none/&gt;</code></td>
    <td colspan="2"><p>Indicates that no authentication is required.</p>
    <p> This method <strong>cannot</strong> be specified with any other authentication method.</p></td>
  </tr>
  <tr>
    <td rowspan="3" valign="top"><code>&lt;GSISecureMessage/&gt;</code></td>
    <td colspan="2"><p>Indicates the GSI Secure Message authentication method
        (<code>&lt;pkey&gt;</code> may
    also be used.)</p>
    <p>The <code>&lt;protection-level&gt; </code>sub element can be used to specify
    a specific protection level that must be applied to the message:</p></td>
  </tr>
  <tr>
    <td><code>&lt;integrity/&gt;</code></td>
    <td>Indicates that the message must be integrity protected (signed.)</td>
  </tr>
  <tr>
    <td><code>&lt;privacy/&gt;</code></td>
    <td>Indicates that the message must be privacy protected (encrypted &amp; signed.) </td>
  </tr>
  <tr>
    <td rowspan="3" valign="top"><code>&lt;GSISecureConversation/&gt;</code></td>
    <td colspan="2"><p>Indicates the GSI Secure Conversation authentication method
    (with integrity or privacy protection) (<code>&lt;gsi&gt;</code> may also
    be used.)</p>
    <p>The <code>&lt;protection-level&gt;</code> sub element can be used to specify
    a specific protection level that must be applied to the message:</p></td>
  </tr>
  <tr>
    <td><code>&lt;integrity/&gt;</code></td>
    <td>Indicates that the message must be integrity protected (signed.)</td>
  </tr>
  <tr>
    <td><code>&lt;privacy/&gt;</code></td>
    <td>Indicates that the message must be privacy protected (signed &amp; encrypted.)</td>
  </tr>
</table>

  <p><strong>Notes:</strong></p>
  <ul>
    <li>Multiple authentication methods can be specified under the
      <code>&lt;auth-method&gt;</code> element (expect for the <code>&lt;none/&gt;</code> method,
      see above.) As long as one of the
          authentication methods is performed, the access to the service is
          allowed.<br>
    </li>
    <li>If <strong>no</strong> <code>&lt;protection-level&gt;</code> sub element
          is specified, then all protection levels are available to clients. If on
        the other hand the <code>&lt;protection-level&gt;</code> sub element <strong>is</strong> specified,
        then the service will only accept the protection levels listed under said
          element.<br>
    </li>
    <li>The <code>org.globus.ogsa.impl.security.authentication.SecurityPolicyHandler</code> handler
      <strong>must</strong> be installed properly in order for this to work. This
        handler is installed by default. <br>
    </li>
    <li>If security deployment descriptor is <strong>not</strong> specified, authentication
          method enforcement is <strong>not</strong> performed.</li>
  </ul>
  <p><strong>Example:</strong></p>
  <pre class="command">&lt;securityConfig xmlns="http://www.globus.org"&gt;<br><br> &lt;method name="findServiceData"&gt;<br>   &lt;auth-method&gt;<br>     &lt;none/&gt;<br>   &lt;/auth-method&gt;<br> &lt;/method&gt;<br><br> <br> &lt;method name="destroy"&gt;<br>   &lt;auth-method&gt;<br>     &lt;GSISecureMessage/&gt;<br>     &lt;GSISecureConversation&gt;<br>       &lt;protection-level&gt;<br>          &lt;integrity/&gt;<br>       &lt;/protection-level&gt;<br>     &lt;/GSISecureConversation&gt;<br>   &lt;/auth-method&gt;<br> &lt;/method&gt;<br><br><br> &lt;!-- default auth-method for any other method --&gt;<br>&nbsp;&lt;auth-method&gt;<br>&nbsp; &lt;GSISecureConversation/&gt;<br>&nbsp;&lt;/auth-method&gt;<br><br>&lt;/securityConfig&gt;</pre>
  <p><span style="font-family: monospace;"></span>In the above
    example, the <code>findServiceData()</code> operation does not require any
    authentication while the <code>destroy()</code> operation requires either
    GSI Message Security authentication (either level of protection) or
    GSI Secure Conversation with integrity protection authentication. Any
    other operation must be authenticated with GSI Secure Conversation
    with either privacy or integrity protection.</p>
  <h5><a name="configRunas"></a>3.1.4 Configuring Run-As Mode</h5>
  <p>The <code>&lt;run-as&gt;</code> element is used to configure the JAAS
    run-as identity under which the service method will be executed. The
    run-as identity can be configured on per-method basis. Currently, the
  following run-as identities are supported:</p>
<table width="650" border="1" cellpadding="5">
  <tr>
    <td width="120" valign="top"><code>&lt;caller-identity/&gt;</code></td>
    <td width="498"><p>The service method will be run with the security identity of the client.
    The caller Subject will contain the following:</p>  <ul>
        <li>If using <i>GSI Secure Message</i>: a GlobusPrincipal (the
          identity of the signer) is added to the principal set of the caller-identity
          Subject. Also, the signer's certificate chain is added to the public
          credentials set of the Subject object.<br>
        </li>
        <li>If using <i>GSI Secure Conversation</i>: a GlobusPrincipal (the
          identity of the initiator) is added to the principal set of the Subject.
          <br>          
          <ul>
            <li>If client authentication was performed, client's certificate
              chain will be added to the public credentials set of the Subject
              object. <br>
            </li>
            <li>Also, if delegation was performed, the delegated credential is
              added to the private credential set of the Subject object.<br>
            </li>
          </ul>
        </li>
        <li>If gridmap file authorization was performed, a UserNamePrincipal
          is added to the principal set of the Subject object</li>
    </ul>    </td>
  </tr>
  <tr>
    <td valign="top"><code>&lt;system-identity/&gt;</code></td>
    <td> The service method will be run with security identity of the container.</td>
  </tr>
  <tr>
    <td valign="top"><code>&lt;service-identity/&gt;</code></td>
    <td>The service method will be run with the security identity of the service
      itself (if the service has one, otherwise the container identity will be
    used.) This is the default.</td>
  </tr>
</table>

  <p><b>Notes:</b> </p>
  <ul>
    <li>The <code>org.globus.ogsa.impl.security.authentication.SecurityPolicyHandler</code>
      handler <strong>must</strong> be installed properly in order for this to
        work. <br>
    </li>
    <li> If the security deployment descriptor is <strong>not</strong> specified,
          then the run-as identity is not set and there will be no JAAS subject associated
          with the execution of the operation. This means that any method calls that
          require credentials and that are invoked by the service method itself will
          fail.</li>
  </ul>
  <p><strong>Example:</strong></p>
  <pre class="command">&lt;securityConfig xmlns="http://www.globus.org"&gt;<br><br> &lt;method name="counter:add" xmlns:counter="http://www.globus.org/samples/counter"&gt;<br>   &lt;run-as&gt;<br>     &lt;caller-identity/&gt;<br>   &lt;/run-as&gt;<br> &lt;/method&gt;<br><br> &lt;method name="counter:subtract" xmlns:ogsi="http://www.globus.org/samples/counter"&gt;<br>   &lt;run-as&gt;<br>     &lt;system-identity/&gt;<br>   &lt;/run-as&gt;<br> &lt;/method&gt;<br><br> &lt;!-- default run-as for any other method --&gt;<br>&nbsp;&lt;run-as&gt;<br>&nbsp; &lt;service-identity/&gt;<br>&nbsp;&lt;/run-as&gt;<br><br>&lt;/securityConfig&gt;<br>
</pre>
  <p>In the above example, the <code>add() </code>operation will be executed
    with caller's identity while the <code>subtract() </code>call will be run
    with system identity. Any other operation will be run with the service
    identity (if the service has one set.)</p>
  <h5><a name="configAuthz"></a>3.1.5 Configuring Authorization Mechanism</h5>
  <p>The container and each service can be configured with a separate
    authorization mechanism using the element <code>&lt;authz
    value=&quot;someMethod&quot;&gt;</code>. Currently the following
    authorization mechanisms are supported:</p>
<table width="650" border="1" cellpadding="5">
  <tr>
    <td valign="top"><code>none</code></td>
    <td> No authorization is performed. </td>
  </tr>
  <tr>
    <td valign="top"><code>self</code></td>
    <td>Only the clients with the same identity as the identity in the current
      JAAS subject associated with the service are allowed to access the service.
      The identity in the JAAS subject is determined through the value in the
    runas element in the service security deployment descriptor (see <a
href="#configRunas">Configuring Run-As Mode</a>.)</td>
  </tr>
  <tr>
    <td valign="top"><code>gridmap</code></td>
    <td>Gridmap file authorization is performed. A gridmap file must be configured
    as described in <a href="#descProgram">section 3.2</a>.</td>
  </tr>
  <tr>
    <td valign="top"><code>custom</code></td>
    <td><p>A custom authorization mechanism is configured using
          the element:</p>
      <p> <code>&lt;authzClass
            value=&quot;customAuthzClassname&quot;/&gt;</code> </p>      
      <p>where <code>value</code> equals the fully qualified name of the
      custom authorization class that needs to be used.</p>
      <p>Refer to <a href="**">section **</a> for details on writing
    a custom authorization mechanism</p></td>
  </tr>
</table>


  <h5><a name="configOthers"></a>3.1.6 Other Configuration</h5>
  <p>Some other security properties that can be configured as a part of
    the container or service descriptor are described below:</p>
<table width="768" border="1" cellpadding="5">
  <tr>
    <td width="142" valign="top"><code>&lt;context-lifetime value="lifetime in seconds"/&gt;</code></td>
    <td width="594"><p>This sets the lifetime of the context that is created at the server end.
        </p>
      <p>If this option is <strong>not</strong> specified, by default, the lifetime of the credential
      used is set as the lifetime of the context. </p>
      <p>Relevant for all operations
    requiring <em>GSI Secure Conversation</em> authentication.</p></td>
  </tr>
  <tr>
    <td valign="top"><code>&lt;reject-limited-proxy/&gt;</code></td>
    <td><p>This requires that the credential presented by the client is not a limited
        proxy. </p>
      <p>Relevant for all operations requiring <em>GSI Secure
          Conversation</em> or
    <em>GSI Secure Message</em> authentication.</p></td>
  </tr>
</table>

  <p><strong>Example:</strong></p>
  <pre class="command"><br>&lt;securityConfig xmlns="http://www.globus.org"&gt;<br><br> &lt;method name="ogsi:findServiceData" xmlns:ogsi="http://www.gridforum.org/namespaces/2003/03/OGSI"&gt;<br>   &lt;run-as&gt;<br>     &lt;caller-identity/&gt;<br>   &lt;/run-as&gt;<br> &lt;/method&gt;<br><br> &lt;method name="ogsi:destroy" xmlns:ogsi="http://www.gridforum.org/namespaces/2003/03/OGSI"&gt;<br>   &lt;run-as&gt;<br>     &lt;system-identity/&gt;<br>   &lt;/run-as&gt;<br> &lt;/method&gt;<br><br> &lt;!-- default run-as for any other method --&gt;<br>&nbsp;&lt;run-as&gt;<br>&nbsp; &lt;service-identity/&gt;<br>&nbsp;&lt;/run-as&gt;<br>&nbsp;&lt;context-lifetime value="100"/&gt;<br>&nbsp;&lt;reject-limited-proxy/&gt;<br><br>&lt;/securityConfig&gt;<br>
</pre>
  <p>In the above example, if the service is accessed using limited
    proxy, an error is reported. </p>
  <p>Also, the contexts created at the server
      end are set to have a lifetime of 100 seconds. </p>
  <h4><a name="#descProgram"></a> 3.2 Programatic altering of security descriptor </h4>
  <p>The security descriptor (container, security and resource) can be
    created and altered programatically (as opposed to writing a security
    descriptor file.) For the service and container descriptor, we recommend taking
      the security descriptor file approach so that the security
      properties are initialized at start up.</p>
  <p><b> FILLME - talk about *SecurityConfig helper classes to initialize and set
    them, esp. Resource stuff.</b>
    

  </p>
</blockquote>
<h3><a name="#resource"></a>4. Secure Resources</h3>

<p> Resource level security can be set, which overrides any service or
container level security. </p>
<p>To make a resource secure, it needs to
  implement <code>org.globus.wsrf.impl.security.SecureResource</code>. This
  interface has a method that returns an instance of <code>org.globus.wsrf.impl.security.descriptor.ResourceSecurityDescriptor</code>.
  If <code>null</code> is returned, it is assumed that no security is set on the
  resource.</p>
<p>The <code>ResourceSecurityDescriptor</code> has get/set methods for all
the relevant configuration properties described in <a
href="#descFile">Section 3.1</a> and can be created as described in <a
href="#descProgram">Section 3.2</a>.<h3><a name="#securityAPI"></a>5. Useful Security API</h3>

<blockquote>
  <h4>5.1 Setting service owner with caller's delegated credential</h4>
  <p>To associate credentials that a method invoker has delegated with a service
    instance, use:</p>
  <pre class="command">import org.globus.wsrf.impl.security.SecurityManager;<br> ...<br> public void serviceMethod(...) {<br>   ...<br>   SecurityManager.getManager().setServiceOwnerFromContext(servicePath);<br> }<br> ...</pre>
  <p> In the above code, <strong><code>servicePath</code></strong> is the service
    path specified in the deployment descriptor.</p>
  <p>The <code>SecurityManager.setServiceOwnerFromContext()</code> operation
    requires a <code>Subject</code> object to be associated with the current thread of
    execution. That <code>Subject</code> object must also contain some private
    credentials.</p>
  <h4>5.2 Getting caller's identity</h4>
  <p>To get the current caller's (client's) identity, use:</p>
  <pre class="command">import org.globus.wsrf.impl.security.SecurityManager;<br> ...<br> public void serviceMethod() {<br>    String identity = SecurityManager.getManager().getCaller();<br> }<br> ...</pre>
  <h4>5.3 Getting the current JAAS Subject</h4>
  <p>A JAAS Subject object contains authentication and authorization
    artifacts (such as principals), and public and private credentials (such
    as client's certificates), the delegated proxy credentials, etc. </p>
  <p>GT4
    allows a service operation to be invoked using one of the following:</p>
  <ul>
    <li> a null subject</li>
    <li> the system/container subject</li>
    <li> the service subject</li>
    <li>the caller's
                subject. </li>
  </ul>
  <p>For more information on these JAAS subjects, see <a
href="#configRunas">Configuring Run-As Mode</a>. </p>
  <p>To get the current
        JAAS Subject, use:</p>
  <pre class="command">import javax.security.auth.Subject;<br> import org.globus.gsi.jaas.JaasSubject;<br> ...<br> public void serviceMethod() {<br>   Subject subject = JaasSubject.getCurrentSubject();<br> }<br> ...<br>
</pre>
  <p>The current <code>Subject</code> depends on the run-as policy specified in the
    security descriptor (again, see <a
href="#configRunas">Configuring Run-As Mode</a>). If <strong>no</strong> security
    descriptor is set for the service, the current <code>Subject</code> will be
    null.</p>
  <h4>5.4 Performing work as a particular JAAS Subject</h4>
  <p>A piece of code can also be executed with a particular JAAS Subject
    object. For example, to execute a piece of code with a given Subject
    object do the following:</p>

  <pre class="command">import javax.security.auth.Subject;<br> import org.globus.gsi.jaas.JaasSubject;<br> ...<br> public void serviceMethod() {<br>   Subject subject = JaasSubject.getCurrentSubject();<br> }<br> ...<br>
</pre>
  <p>The current <code>Subject</code> depends on the run-as policy specified
    in the security descriptor (again, see <a
 href="#configRunAs">Configuring Run-As</a>). If <strong>no</strong> security descriptor is
  set for the service, the current <code>Subject</code> will be null.</p>
  <h4>5.5 Performing work as a particular JAAS Subject</h4>
  <p>A piece of code can also be executed with a particular JAAS Subject
    object. For example, to execute a piece of code with a given Subject
    object do the following:
    </p>
  <pre class="command">import javax.security.auth.Subject;<br> import java.security.PrivilegedAction;<br> import org.globus.gsi.jaas.JaasSubject;<br> ...<br> public void method() {<br>   // create a new subject or obtain it from somewhere<br>   Subject subject = ...;<br>   JaasSubject.doAs(subject, new PrivilegedAction() {<br>		               public Object run() {<br>                                 // do work here<br>		                 return null;<br>		               }<br>	            });<br> }<br> ...</pre>
</blockquote>
<h3><a name="#limitations"></a>6. Limitations</h3>

<blockquote>
  <h4>6.1 Persistent Services Activation Run-As Identity</h4>
  <p>The activation of persistent services is not executed under any run-as
    identity. Wrong credentials might be used if the service is making an
    outbound connection during the activation. JAAS API might be used to
    set the right identity for the outbound connection.
  </p>
  <h4>6.2 Security Descriptor Requires Credentials</h4>
  <p>The presence of a security descriptor for a specific service triggers
    credential acquisition. This causes the service to require
    credentials, even if the security descriptor only specifies the <code>&lt;none/&gt;</code> authentication
    method. </p>
  <p>As a workaround we recommend that you remove the security-descriptor.&nbsp; Secure
      invocation on a service without a security descriptor will still work (given
      that the service has credentials available.)</p>
</blockquote>
<h3><a name="otherFeatures"></a>7. Other Features</h3>

<blockquote>
  <h4><a name="#replayAttack"> </a>7.1 Replay Attack Prevention </h4>
  <p>If <em>GSI Secure Message</em> is the security
    mechanism, a replay attack filter can be configured on the server
    side. If activated, the filter can be configured with a time window,
    and only non-duplicate messages received within the window are
    accepted. The message received is expected to have a timestamp header
    as  part of the security headers. </p>
  <p>To facilitate this, relevant
    message details are persisted at the server end and a sweeper task is
    run periodically to delete expired messages. </p>
  <p> The following paramaters may be used to configure this feature:
  </p>
  <ul>
    <li> By default, a timestamp header is required as a part of any
      request using <em>GSI Secure Message</em> as security mechanism. <br>
      <br>
      This
      requirement can be disabled by setting a property <code>replayAttackFilter</code> to <code>false</code>.
      This can be set either in the container or security descriptor (the latter
      overrides the former.) The following turns off the replay attack filter.
      <pre class="command"> &lt;securityConfig xmlns="http://www.globus.org"&gt;<br>  ...<br>  &lt;replay-attack-filter value="false"/&gt;<br>  ...<br> &lt;/securityConfig&gt;</pre>
    </li>
    <li> By default, a time window of 5 minutes is used for the replay
      attack filter. <br>
      <br>
      This window value can be set in minutes using the
      element <code>replayAttackWindow</code> in either the container
      security descriptor or the service security descriptor (latter
      overrides the former.) If the value set is not an integer or cannot be
      parsed for any reason, the default value of 5 minutes is used. The
      following example sets the window to be 10 minutes.
      <pre class="command"> &lt;securityConfig xmlns="http://www.globus.org"&gt;<br>  ...<br>  &lt;replay-attack-window value="10"/&gt;<br>  ...<br> &lt;/securityConfig&gt;</pre>
    </li>
  </ul>
</blockquote>
<b> FIXME: does not intend like 7.1</b>
<h4><a name="#customAuthz"></a>7.2 Writing custom service authorization mechanism</h4>

<p> The authorization handler can be configured to call out to a
custum authorization class. The class must implement the interface
<code>org.globus.wsrf.impl.security.authorization.ServiceAuthorization</code>. </p>
<p>If
  the authorization fails, then a <code>org.globus.wsrf.impl.security.authorization.AuthorizationException</code> should
  be thrown.</p>
<p><strong>  Example: </strong><br> 
  
</p>
<pre class="command">  public class FooAuthorization implements ServiceAuthorization {<br>      public void authorize(Subject peerSubject, ServiceProperties service,
			  MessageContext context) 
	throws AuthorizationException {
	// Evaluate and throw exception if not authorized.
      }
  }
</pre>
<h3><a name="container"></a>8. Container-only Security Configuration</h3>

<p> Other than the security properties that have been described in <a
href="#Descriptor">Security Descriptor</a>, two more properties are
exclusive to the container security descriptor.
<ul>

<li> As a part of the support for <a href="#replayAttack">Replay
Attack Prevention</a>, a sweeper task is used to delete expired
message values. This is run every 7 minutes by default. This interval
can be set in milliseconds in the container security descriptor as
shown below:
<pre class="command"> &lt;securityConfig xmlns="http://www.globus.org"&gt;<br>  ...<br>  &lt;replay-attack-interval value="10000"/&gt;<br>  ...<br> &lt;/securityConfig&gt;</pre></li>

<li> When GSI Secure Conversation is used a security context is established. A aweeper task is run every 10 minutes to delete all expired contexts. This interval can be set in milliseconds in the container security descriptor as shown below:
shown below:
  <pre class="command"> &lt;securityConfig xmlns="http://www.globus.org"&gt;<br>  ...<br>  &lt;replay-attack-interval value="10000"/&gt;<br>  ...<br> &lt;/securityConfig&gt;</pre></li>
</ul>

<h3><a name="Errors"></a>9. Errors</h3>

<blockquote>
  <h4>9.1 '[SEC05] Invocation subject not set'</h4>
  <p> The service' method is calling
    <code>SecurityManager.setOwnerFromContext()</code> but the run-as identity
  of the method is not set. </p>
  <p>The service is probably missing a security
    deployment descriptor.</p>
  <h4>9.2 '[SEC06] Invocation subject does not contain private credentials'</h4>
  <p> The service method is calling
    <code>SecurityManager.setOwnerFromContext()</code> but the run-as identity
  of the method does not contain private credentials. </p>
  <p>If the method is
    run under the <code>callers-identity</code>, make sure the client calling the
    service uses <em>GSI Secure Conversation</em> and enables delegation for the
  call.</p>
</blockquote>
<?php include("http://www-unix.globus.org/include/globus_footer.inc"); ?>
