<title>GT 4.0 OGSA-DAI (Tech Preview): System Administrator's Guide</title>
<titleabbrev> System Administrator's Guide</titleabbrev>
<section id="s-ogsadai-admin-introduction"><title>Introduction</title>
    <para>This guide contains
        installation and configuration information for system administrators installing
        OGSA-DAI. It explains how to install, configure and test the installation. </para>
</section>
<section id="s-ogsadai-admin-installing"><title>Building and installing</title>  
    <para>OGSA-DAI is not built and installed as part of the standard Globus Toolkit installation. 
    You will find the installation bundle in the contributions directory. You will need to install 
    the Java WS-Core from the Globus distribution.</para>
<section id="s-ogsadai-admin-prereq">    
<title>Prerequisites</title>
    
   <para> The deployment and use of the OGSA-DAI WSRF distribution will be easier if you are 
    already familiar with:</para>
    
 <itemizedlist>
      <listitem>OGSA-DAI concepts and terms: Reading the user's guide included in the 
          OGSA-DAI distribution should provide you with this information.</listitem>
     <listitem>WS-Addressing concepts and terms: an introduction to WS-Addressing is available at <ulink url="http://www-106.ibm.com/developerworks/library/specification/ws-add">http://www-106.ibm.com/developerworks/library/specification/ws-add</ulink>.</listitem>
     <listitem> Web Services Resource Framework (WSRF) concepts and terms: the WSRF specifications can be found at <ulink url="http://www.globus.org/wsrf">http://www.globus.org/wsrf</ulink>.</listitem></itemizedlist>
    
<section id="s-ogsadai-admin-prereq-software">    
<title>Prerequisite Software</title>
    
    <para>To use OGSA-DAI WSRF you will need the following software:</para>
<itemizedlist>    
    <listitem>Java 1.4.0: OGSA-DAI WSRF has been tested on this version of Java though may work with other Java 1.4.x flavours.</listitem>
    <listitem>Jakarta ANT 1.5: see <ulink url="http://ant.apache.org">http://ant.apache.org</ulink>.</listitem>
   <listitem> Globus Toolkit Java WS Core
<itemizedlist>       
    <listitem>This provides a Java-based implementation of WSRF and is available at: <ulink url="http://www-unix.globus.org/toolkit/downloads/development">http://www-unix.globus.org/toolkit/downloads/development</ulink>.</listitem>
   <listitem> Information on Globus Toolkit 4.0 can also be found at:
       <ulink url="http://www-unix.globus.org/toolkit/docs/development/4.0-drafts/GT4Facts">http://www-unix.globus.org/toolkit/docs/development/4.0-drafts/GT4Facts</ulink>.</listitem>
   </itemizedlist>
   </listitem>
    </itemizedlist>
</section>
    <section id="s-ogsadai-admin-prereq-jars">    
    <title>Prerequisite JARs</title>
    
  <para>  You will need the following JARS to be able to compile OGSA-DAI:</para>
        <table><title>Prerequisite JARs</title>
            <tgroup cols="4">
                <thead>
                <row>
                    <entry><command>OGSA-DAI Functionality</command></entry>
                    <entry><para>JAR</para></entry>
                    <entry><para>Package Name</para></entry>
                    <entry><para>URL</para></entry>
                </row></thead>
                <tbody>
                <row>
                    <entry><command>File-related activities</command></entry>
                    <entry><para>jakarta-oro-2.0.7.jar</para></entry>
                    <entry><para>Jakarta Oro 2.0.7 (Note that 2.0.8 has not been tested with OGSA-DAI)</para></entry>
                    <entry><para><ulink url="http://jakarta.apache.org/oro">http://jakarta.apache.org/oro</ulink></para></entry>
                </row>
                <row>
                    <entry><command>XML database-related activities </command></entry>
                    <entry><para>xmldb.jar </para></entry>
                    <entry><para>Initial Public Release </para></entry>
                    <entry><para>Available in Xindice - <ulink url="http://xml.apache.org/xindice">http://xml.apache.org/xindice</ulink></para></entry>
                </row>
                <row>
                    <entry><command> Indexed file-related activities</command></entry>
                    <entry><para>lucene-1.4-final.jar </para></entry>
                    <entry><para>Lucene 1.4</para></entry>
                    <entry><para><ulink url="http://jakarta.apache.org/lucene">http://jakarta.apache.org/lucene</ulink></para></entry>
                </row>
            </tbody>
                </tgroup>
        </table>
    </section>
    <section id="s-ogsadai-admin-prereq-drivers"> 
   <title> Data Resource Drivers</title>
    
   <para> You will also need to download the corresponding database drivers for any data 
       resources you wish to expose using the OGSA-DAI WSRF distribution. Data resources and 
       drivers that have been tested against OGSA-DAI are:</para>
<itemizedlist>    
    <listitem> MySQL
        <itemizedlist>
            <listitem>MySQL Connector J/2. Available from: http://www.mysql.com. Note that if you use version 4.1.x of MySQL you will need version 3.1 of the driver.</listitem>
            <listitem>Required JAR: mysql-connector-java-XXX.jar where XXX is the version of the driver.</listitem>
        </itemizedlist></listitem>
    <listitem>DB2
        <itemizedlist>        
            <listitem>DB2 JDBC Driver. Available from http://www.ibm.com/software/data/db2.</listitem>
            <listitem>Required JARs: db2jcc.jar, db2jcc_licence_cu.jar.</listitem>
        </itemizedlist></listitem>
    <listitem>Oracle
   <itemizedlist>     
       <listitem>Oracle JDBC Drivers for Java 1.2+. Available from <ulink url="http://www.oracle.com">http://www.oracle.com</ulink>.</listitem>
        <listitem>Required JAR:classes12.zip - rename as classes12.jar.</listitem>
        </itemizedlist></listitem>
    <listitem> Xindice 1.0
        <itemizedlist>
         <listitem>Xindice 1.0. Available from http://xml.apache.org/xindice.</listitem>
        <listitem>Required JARs: xindice.jar, xmldb-xupdate.jar, openorb-1.2.0.jar.</listitem>
        </itemizedlist></listitem>
    <listitem>Microsoft SQL Server
        <itemizedlist>
            <listitem>MS SQL Server JDBC driver. Available from http://www.microsoft.com.</listitem>
            <listitem>Required JARs: mssqlserver.jar, msbase.jar, msutil.jar.</listitem>
        </itemizedlist></listitem>
    <listitem>Postgres
        <itemizedlist>
    <listitem>Postgres JDBC driver. Available from http://www.postgresql.org.</listitem>
    <listitem>Required JAR: pgXXXX.jar where XXXX is the version of the driver.</listitem>
        </itemizedlist></listitem>
    <listitem>Derby
  <itemizedlist>      
    <listitem>Apache Derby driver. Available from http://incubator.apache.org/derby/.</listitem>
    <listitem>Required JAR: derby.jar.</listitem>
        </itemizedlist></listitem>
    <listitem>HSQL
    <itemizedlist>    
    <listitem>HSQL 1.7.x driver. Available from http://hsqldb.sourceforge.net </listitem>
        <listitem>Required JAR: hsql.jar.</listitem>
    </itemizedlist></listitem>
        
    <listitem>Exist
<itemizedlist>        
    <listitem>Exist 1.0 Beta 2 driver. Available from http://exist.sourceforge.net/</listitem>
    <listitem>Required JARs: exist.jar, xmlrpc-1.2-patched.jar.</listitem>
</itemizedlist></listitem>
        
        </itemizedlist>
    </section>
</section>
    <section id="s-ogsadai-admin-building">    
<title>    Building OGSA-DAI WSRF</title>
    
    <para>This section describes how to build OGSA-DAI WSRF.</para>
        <section id="s-ogsadai-admin-building-insertjar">  
    <title>Insert the Prerequisite JAR Files</title>
    
 <para>   First, download the prerequisite JAR files (listed above):</para>
   <itemizedlist> 
    <listitem> jakarta-oro-2.0.7.jar</listitem>
    <listitem>lucene-1.4-final.jar</listitem>
    <listitem> xmldb.jar</listitem>
   </itemizedlist> 
    <para>and put these into the OGSA-DAI distribution's lib directory.</para>
        
        </section>       
        
        <section  id="s-ogsadai-admin-download">     
   <title> Download and Compile GT4</title>
    
    <para>Now, you need to download and compile Globus Toolkit 4 Web Services Core. 
        The GT4 instructions tell you how to do this.</para>
    
        </section>
        <section id="s-ogsadai-admin-build-wsrf">
       <title> Build OGSA-DAI WSRF</title>
    
   <para> To build OGSA-DAI WSRF:</para>
    <itemizedlist>
  <listitem>Set a GLOBUS_LOCATION environment variable to point to the location of your GT4 distribution. For example, under UNIX, enter:
    
    <screen>$ export GLOBUS_LOCATION=/path/to/Globus/directory</screen></listitem>
    
    <listitem>Run the following from within the OGSA-DAI distribution directory:
    
    <screen>$ ant makeGar</screen>
        </listitem>
    </itemizedlist>
    <para>OGSA-DAI WSRF will then be built. Note that before you can use OGSA-DAI you must configure it. This is covered in the deployment section. </para>
    </section>
    </section>  
</section>
<section id="s-ogsadai-admin-configuring"><title>Configuring </title>
    <para>Please consult <xref linkend="s-ogsadai-admin-deploying" /> for information on configuring OGSA-DAI services.</para>
    
</section>
<section id="s-ogsadai-admin-deploying"><title>Deploying</title>
    <para>This section assumes that you have built the WSRF version of OGSA-DAI from source.</para>
<section>    
   <title> Installing OGSA-DAI WSRF</title>
    
    <para>This section describes how to install OGSA-DAI WSRF onto the GT4 container or Apache Tomcat.</para>
   <section> 
    <title>Deploying OGSA-DAI WSRF onto GT4</title>
    
   <para> If you wish to deploy OGSA-DAI WSRF onto the GT4 Web services container then keep reading. 
       If however you want to deploy OGSA-DAI WSRF onto Apache Tomcat then skip to [the next section].</para>
    
   <para> To deploy OGSA-DAI WSRF onto GT4:</para>
    <itemizedlist>
    <listitem>Set a GLOBUS_LOCATION environment variable to point to the location of your GT4 distribution. 
        For example, under UNIX (for the bash or Bourne shell - with csh you will have to use the corresponding syntax for setenv, similarly for the examples quoted below), enter:
    <screen>$ export GLOBUS_LOCATION=/path/to/Globus/directory</screen>
    </listitem>
    <listitem>Run the following from within the OGSA-DAI WSRF distribution directory:
    <screen>$ ant deployGTContainer</screen></listitem>
    </itemizedlist>
    <para>OGSA-DAI WSRF will then be deployed.</para>
    </section>
   <section><title> Deploying OGSA-DAI WSRF onto Tomcat</title>
    
    <para>Before you can deploy OGSA-DAI WSRF onto Tomcat you will need to deploy GT4 onto Tomcat. You can do this as follows, if you have not already done so:</para>
<itemizedlist>    
    <listitem>Set a GLOBUS_LOCATION environment variable to point to the location of your GT4 distribution. For example, under UNIX, enter:
    
    <screen>$ export GLOBUS_LOCATION=/path/to/Globus/directory</screen></listitem>
<listitem>    
    Set a CATALINA_HOME environment variable to point to the location of Tomcat. For example, under UNIX, enter:
    
   <screen> $ export CATALINA_HOME=/path/to/Tomcat/directory</screen>
    </listitem>
<listitem>    * Run the following from within the GT4 distribution directory:
    <screen>$ cd $GLOBUS_LOCATION
    $ ant -f share/globus_wsrf_common/tomcat/tomcat.xml deployTomcat 
    -Dtomcat.dir=$CATALINA_HOME</screen>
    </listitem>
    <listitem>For more information see the <ulink url="../../admin/docbook/">GT4 installation instructions</ulink>.</listitem>
    </itemizedlist>
   <para> Now, to deploy OGSA-DAI WSRF onto Tomcat, run the following from within the OGSA-DAI distribution directory:</para>
    
    <screen>$ ant deployTomcat</screen>
    
    <para>OGSA-DAI WSRF will then be deployed to Tomcat.</para>
    
   <note> <simpara>As an alternative to setting CATALINA_HOME you can specify the Tomcat location at the command-line as follows:</simpara>
    
    <screen>$ ant deployTomcat -Dtomcat.dir=/path/to/Tomcat/directory</screen>
   </note>
   </section>
    </section>
<section>    <title>Exposing Data Resources using OGSA-DAI WSRF</title>
    
<para>    To expose a data resource via an OGSA-DAI WSRF data service is a three-step process:</para>
    <orderedlist>
    <listitem>Deploy an OGSA-DAI data service. This data service initially exposes 0 data service resources.</listitem>
    <listitem>Deploy a data service resource. The data service resource contains information about a data resource and the activities clients can perform on that data resource via a data service.</listitem>
    <listitem>Add a data service resource to a data service. This instructs the data service to expose the data service resource and so allows clients to interact with the data service resource - thereby interacting with a data resource.</listitem>
    </orderedlist>
    <para>The deployment approach is flexible to support a wide variety of scenarios. 
    For example multiple data services can expose the same data service resource or one data service can expose multiple data service resources.</para>
    <section>
    <title>Deploying an OGSA-DAI Data Service</title>
    
<para>    This section describes how to deploy an OGSA-DAI data service which initially will expose 0 data service resources.</para>
    
<para>    To deploy a data service under Tomcat:</para>
<itemizedlist>
    <listitem>    
    Run the following command from within the OGSA-DAI WSRF distribution directory:
    
    <screen>$ ant deployDataServiceTomcat -Dtomcat.dir=/path/to/Tomcat/directory
    -Ddai.service.path=service/path</screen>
    <itemizedlist>
   <listitem><command> -Dtomcat.dir=</command> : 
    specifies the location of Tomcat. If this argument is omitted then the Tomcat location specified within CATALINA_HOME is used.</listitem>
    <listitem>
    <command>-Ddai.service.path=</command>
    specifies the local URL of the service. For example -Ddai.service.path=ogsadai/DataService specifies a data service whose URL will be 
        http://HOST:PORT/wsrf/services/ogsadai/DataService.</listitem>
    </itemizedlist>
    </listitem>
    <listitem>The data service will be deployed onto Tomcat.</listitem>
    </itemizedlist>
   <para> To deploy a data service under GT4 requires execution of the deployDataServiceGT4 target. This takes the same arguments as deployDataServiceTomcat. 
        The exception is the -Dtomcat.dir argument - this target instead accepts -Dgt.dir= which specifies the location of GT4. 
        If this argument is omitted then the GT4 location specified within GLOBUS_LOCATION is used.</para>
    </section>
    <section>
    <title>Checking the OGSA-DAI Data Service Deployment</title>
    
    <para>To test that a service has deployed under GT4:</para>
    <itemizedlist>
  <listitem>  Start the GT4 container:
    
    <screen>$ cd $GLOBUS_LOCATION
    $ ./bin/globus-start-container -nosec</screen>
    </listitem>
   <listitem>Eventually a list of service URLs will be displayed. You should see one corresponding to your service. For example:
    
    <screen>[22]: http://129.215.56.6:8080/wsrf/services/ogsadai/DataService</screen></listitem>
   </itemizedlist>
        
    <para>To test that a service has deployed under Tomcat:</para>
   <itemizedlist> 
    <listitem>Restart Tomcat.</listitem>
<listitem>    Using a Web browser, visit the following URL:
    
    <screen>http://TOMCAT.HOST:TOMCAT.PORT/wsrf/services</screen>
    
    Eventually a list of service URLs will be displayed. You should see one corresponding to your service. For example:
    
    <screen>ogsadai/DataService (wsdl) </screen>
    </listitem>
     <listitem>Click on the (wsdl) link and the WSDL describing the service should appear. For example:
    
   <screen> &lt;?xml version="1.0" encoding="UTF-8" ?&gt;
    &lt;wsdl:definitions name="DataService" 
        ...</screen></listitem>
    </itemizedlist>    
       <para> An alternative is to test the service using the OGSA-DAI WSRF listResourcesClient client. We describe how to do this below.</para>
    </section>  
    <section>
        <title>Deploying Data Service Resources</title>
        
        <para>This section describes how to deploy a data service resource. Once deployed the data service resource can then be added to the set of those exposed by a 
        data service as described in the next section.</para>
        
        <para>A data service resource file is used specify the properties of your data service resource. 
        This is a simple ANT properties file consisting of argument=value values. 
        You can reuse the same file to deploy the same data service resource under different names or to customise a specific configuration in small or major ways. 
        Alternatively you can just write a new file each time.
        </para>
        <para>Within the OGSA-DAI WSRF distribution directory we provide an example - data.service.resource.properties. The file is fully commented.</para>
        
        <para>The properties are as follows:</para>
    <itemizedlist>    
        <listitem>dai.resource.id=...- name for the data service resource.</listitem>
        <listitem>dai.data.resource.type=[Relational | XML | Files] - the type of data resource to which the data service resource provides access.</listitem>
        <listitem>dai.product.name= ... - data resource product name (optional).</listitem>
        <listitem>dai.product.vendor= ... - data resource product vendor (optional).</listitem>
        <listitem>dai.product.version= ... - data resource product version (optional).</listitem>
        <listitem>dai.data.resource.uri= ... - data resource URI. This must be compatible with the driver class specified next.</listitem>
        <listitem>dai.driver.class= ... - data resource driver class name. This is optional only if dai.data.resource.type=Files.</listitem>
        <listitem>dai.credential= ... - Grid certificate credentials of a user permitted to access the data resource. If omitted then any user will be allowed access.</listitem>
        <listitem>dai.user.name= ... - data resource user name. Optional only if there is no user name required for a database.</listitem>
        <listitem>dai.password=... - corresponding data resource password. Optional if there is no user name required, or if the password is null.</listitem>
    </itemizedlist>
        
        <para>To deploy a data service resource under Tomcat:</para>
        <itemizedlist>
       <listitem>Take a copy of data.service.resource.properties within the OGSA-DAI WSRF distribution directory.</listitem>
       <listitem>Load the file into an editor and provide values specifying your data service resource - the comments in the file should help you.</listitem>
        <listitem>When done, save the file.</listitem>
        <listitem>Put all the JARs implementing the data resource driver within the drivers directory within the OGSA-DAI WSRF distribution directory.</listitem>
        <listitem>Run the following command from within the OGSA-DAI WSRF distribution directory:
        <screen>$ ant deployResourceTomcat -Dtomcat.dir=/path/to/Tomcat/directory
        -Ddai.service.resource.file=DAI-SERVICE-RESOURCE-FILE</screen>
       <itemizedlist> 
        <listitem><command>-Dtomcat.dir=</command> specifies the location of Tomcat. If this argument is omitted then the Tomcat location specified within CATALINA_HOME is used.</listitem>
        <listitem><command>-Ddai.service.resource.file=</command> specifies the location of a data service resource properties file. If no argument is given then a default location of data.service.resource.properties (within the OGSA-DAI WSRF distribution directory) is assumed.</listitem>
        </itemizedlist>
        </listitem>
            <listitem>The data service resource will be deployed. For example:
        
        <screen>$ ant deployResourceTomcat -Ddai.service.resource.file=my.config
        ...
        [echo] Reading properties file my.config
        [echo] Data service resource ID: MySQLResource
        [echo] Data resource type: Relational
        [echo] Data resource product: MySQL
        [echo] Data resource vendor: MySQL
        [echo] Data resource version: 1.0
        [echo] Data resource URI: jdbc:mysql://amethyst.epcc.ed.ac.uk:3306/ogsadai/DATABASE
        [echo] Data resource credential: 
        [echo] Data resource user name: ogsadai
        [echo] Data resource password: ogsadai
        [echo] Data driver class: org.gjt.mm.mysql.Driver
        [echo] Deploying data service resource MySQLResource...
        ...
        [echo] Data service resource deployed!</screen>
        </listitem>
            <listitem> Values in the same data service resource file can be overriden at the command line via the use of -Dproperty=value flags. 
                For example to deploy another data service resource with the same configuration as held within my.config you can execute:
        
       <screen> $ ant deployResourceTomcat -Ddai.service.resource.file=my.config
        -Ddata.resource.id=AnotherResource</screen>
        
        As another example, consider deploying a data service resource with the same configuration but with a different location:
        
        <screen>$ ant deployResourceTomcat -Ddai.service.resource.file=my.config
        -Ddata.resource.id=YetAnotherResource
        -Ddai.data.resource.uri=jdbc:mysql://myhost:8080/some/other/DB</screen>
        
        Alternatively, you can just edit your data service resource file.</listitem>
        </itemizedlist>
        <para>To deploy data service resources under GT4 requires execution of the deployResourceGT4 target. 
        This takes the same arguments as deployResourceTomcat. The exception is the -Dtomcat.dir argument. 
        This target instead accepts -Dgt.dir= which specifies the location of GT4. 
        If this argument is omitted then the GT4 location specified within GLOBUS_LOCATION is used.</para>
    </section>    
<section>    
    <title>Adding a Data Service Resource to a Data Service</title>
        
        <para>This section describes how to add a data service resource to a data service, thereby allowing clients to access and interact with the data service resource.</para>
        
        <para>To add data service resources to data services under Tomcat:</para>
    <itemizedlist>    
       <listitem>Run the following command from within the OGSA-DAI WSRF distribution directory:
        
        <screen>$ ant addResourceTomcat -Dtomcat.dir=/path/to/Tomcat/directory
        -Ddai.service.path=service/path -Ddai.resource.id=ResourceID</screen>
  <itemizedlist>      
        <listitem><command>-Dtomcat.dir=</command> specifies the location of Tomcat. If this argument is omitted then the Tomcat location specified within CATALINA_HOME is used.</listitem>
        <listitem><command>-Ddai.service.path=</command> specifies the local URL of the service. For example -Ddai.service.path=ogsadai/DataService specifies a data service whose URL will be http://HOST:PORT/wsrf/services/ogsadai/DataService.</listitem>
        <listitem><command>-Ddai.resource.id=</command> is the ID of the data service resource that the data service is to expose. 
           This must be the name of a data service resource which you have already deployed as described earlier in the section on 
           Deploying Data Service Resources. For example:
            <command>-Ddai.service.resource=MySQLResource</command></listitem>
           </itemizedlist>
        </listitem>
        You will need to shutdown and restart Tomcat before clients are able to access the new data service resource.
        </itemizedlist>
        <para>To add data service resources under GT4 requires execution of the addResourceGT4 target. 
    This takes the same arguments as addResourceTomcat. The exception is the -Dtomcat.dir= argument. 
    This target instead accepts -Dgt.dir= which specifies the location of GT4. If this argument is omitted then the GT4 location 
    specified within GLOBUS_LOCATION is used.</para>
  <para>      
        It is also possible to remove data service resources from a data service, if for example clients are to no longer be allowed to access a 
    data service resource via a particular service. This is described in the section on Removing a Data Service Resource from a Data Service below.
        </para>
       <para> After restarting your service, you can test whether the new data service resource was successfully added using the 
    OGSA-DAI WSRF listResourcesClient client. We describe how to do this below.</para>
        </section>
</section>    
 <section>   
    <title>Listing Data Service Resources</title>
        
        <para>To list the data service resources exposed by a data service:</para>
   <itemizedlist>     
        <listitem>Ensure that your Web services container is running.</listitem>
        <listitem>Ensure that either CATALINA_HOME or GLOBUS_LOCATION environment variables are set.</listitem>
        <listitem>Run the following command from within the OGSA-DAI WSRF distribution directory:
        
        <screen>$ ant listResourcesClient -Ddai.url=SERVICE-URL</screen>
        
        where <command>-Ddai.url=</command> specifies the URL of the data service. If omitted then a default URL of <filename>http://localhost:8080/wsrf/services/ogsadai/DataService</filename> is used.

       For example:
        
        <screen>$ ant listResourcesClient 
        -Ddai.url=http://e3000.epcc.ed.ac.uk:8080/wsrf/services/ogsadai/MyDataService</screen>
        
        The data service resources exposed by your service will be displayed. For example:
        
        <screen>[java] Contacting ... http://localhost:8080/wsrf/services/ogsadai/DataService
        [java] Service version: WSRF 4.0
        [java] Number of resources: 0</screen>
        
        For example:
        
        <screen>[java] Contacting ... http://localhost:8080/wsrf/services/ogsadai/DataService
        [java] Service version: WSRF 4.0
        [java] Number of resources: 2
        [java] Resource: MySQLResource
        [java] Resource: AnotherResource</screen>
       </listitem>
        </itemizedlist>
        <note><simpara>As an alternative to setting CATALINA_HOME or GLOBUS_LOCATION you can specify the Tomcat or 
            GT4 locations using the <command>-Dtomcat.dir=/path/to/Tomcat/directory</command> or <command>-Dgt.dir=/path/to/Globus/directory</command> flags respectively.</simpara></note>
 </section>
  <section>  
    <title>Querying Data Service Resource Properties</title>
        
        <para>To query the properties of a data service resource exposed by a data service:</para>
        <itemizedlist>
        <listitem>Ensure that your Web services container is running.</listitem>
        <listitem>Ensure that the GLOBUS_LOCATION environment variable points to your GT4 distribution.</listitem>
        <listitem>Invoke the Globus GetProperty Client:
        
        <screen>$ cd $GLOBUS_LOCATION
        $ ./bin/wsrf-get-property -s DATA-SERVICE-URI 
        -k {http://ogsadai.org.uk}DataServiceResourceKey DATA-RESOURCE-NAME 
        PROPERTY-NAME
        
        For example:
        
        $ cd $GLOBUS_LOCATION
        $ ./bin/wsrf-get-property 
        -s http://localhost:8080/wsrf/services/ogsadai/DataService 
        -k {http://ogsadai.org.uk}DataServiceResourceKey MySQLResource
            {http://ogsadai.org.uk/namespaces/2004/05/gdsf}databaseSchema</screen>
            The value of the property will then be displayed.
        </listitem>
        <listitem>Properties can include:
  <itemizedlist>          
        <listitem>{http://ogsadai.org.uk/namespaces/2004/05/gdsf/config}productInfo - information on a data resource, including name, vendor and version.</listitem>
        <listitem>For relational data resources: {http://ogsadai.org.uk/namespaces/2004/05/gdsf}databaseSchema - data resource schema.</listitem>
        <listitem>For XML data resources: {http://ogsadai.org.uk/namespaces/2004/05/gdsf}collectionSchema - data resource collection schema.</listitem>
        <listitem>{http://ogsadai.org.uk/namespaces/2004/05/gdsf}activityType - activities the data service resource can be requested to perform on the data resource - the legal activities in Perform documents that can be sent to the data service resource via the data service.</listitem>
        <listitem>{http://ogsadai.org.uk/namespaces/2004/05/gds_perform}performDocumentSchema - XML Schema specifying the legal structure of Perform documents that can be sent to the data service resource via the data service.</listitem>
        <listitem>{http://ogsadai.org.uk/namespaces/2004/05/gds_perform}requestStatus - status of execution of the current or more recent Perform document sent to the data service resource.</listitem>
        </itemizedlist>
        </listitem>
        </itemizedlist>
  </section>
    <section>
        <title>Submitting Perform Documents</title>
        
        <para>To submit a Perform document to a data service resource exposed by a data service and so perform some data resource-related activites (e.g. query a database):</para>
      <itemizedlist>  
        <listitem>Ensure that your Web services container is running.</listitem>
        <listitem>Ensure that either CATALINA_HOME or GLOBUS_LOCATION environment variables are set.</listitem>
        <listitem>Run the following command from within the OGSA-DAI WSRF distribution directory:
        
        <screen>$ ant dataServiceClient -Ddai.url=SERVICE-URL
        -Ddai.resource.id=RESOURCE-ID
        -Ddai.action=PERFORM-DOC-LOCATION</screen>
       
        where:
            <itemizedlist>
        <listitem>-Ddai.url= specifies the URL of the data service. If omitted then a default URL of http://localhost:8080/wsrf/services/ogsadai/DataService is used.</listitem>
        <listitem>-Ddai.resource.id= specifies the data service resource at which the Perform document is targeted.</listitem>
        <listitem>-Ddai.action= specifies the location of an OGSA-DAI Perform document.</listitem></itemizedlist>
  
        For example:
        
        <screen>$ ant dataServiceClient 
        -Ddai.url=http://localhost:8080/wsrf/services/ogsadai/MyDataService
        -Ddai.resource.id=MySQLResource
        -Ddai.action=examples/GDSPerform/JDBC/query/select1Row.xml </screen>
        </listitem>
          
       <listitem>The Perform document will be forwarded to the data service and executed by the specified data service resource. For example:
        
        <screen>[echo] Executing Perform document on resource One...
        [java] Contacting ... http://localhost:8080/wsrf/services/ogsadai/MyDataService
        [java] Service version: WSRF 4.0
        [java] Number of resources: 2
        [java] Resource: MySQLResource
        [java] Resource: AnotherResource
        [java] Data Resource: MySQLResource
        [java] About to invoke Perform...
        [java] Perform completed!
        [java] Response: 
        [java] &lt;?xml version="1.0" encoding="UTF-8"?&gt;
            [java] &lt;ns1:response xmlns:ns1="http://ogsadai.org.uk/namespaces/2004/09/service/types"&gt;
            [java] &lt;request status="COMPLETED"
            xmlns="http://ogsadai.org.uk/namespaces/2004/09/service/types"/&gt;
            ...</screen>
            </listitem>
      </itemizedlist>
            <note><simpara>As an alternative to setting CATALINA_HOME or GLOBUS_LOCATION you can specify the 
                Tomcat or GT4 locations using the <command>-Dtomcat.dir=/path/to/Tomcat/directory</command> or <command>-Dgt.dir=/path/to/Globus/directory</command> flags respectively.</simpara></note>
            
          <para>  If you have a previous OGSA-DAI release (version 4.0 or higher) then the OGSA-DAI test database tables are suitable for use with these example 
        Perform documents.</para>
    </section>       
   <section> 
    <title>Removing a Data Service Resource from a Data Service</title>
            
            <para>This section describes how to remove a data service resource from a data service - the data service will no longer expose the data service resource.</para>
            
           <para> To remove data service resources from data services under Tomcat:</para>
            <itemizedlist>
            <listitem>Run the following command from within the OGSA-DAI WSRF distribution directory:
            
            <screen>$ ant removeResourceTomcat -Dtomcat.dir=/path/to/Tomcat/directory
            -Ddai.service.path=service/path -Ddai.resource.id=ResourceID</screen>
            where:<itemizedlist>
            <listitem>-Dtomcat.dir= specifies the location of Tomcat. If this argument is omitted then the Tomcat location specified within CATALINA_HOME is used.</listitem>
            <listitem>-Ddai.service.path= specifies the local URL of the service. For example -Ddai.service.path=ogsadai/DataService specifies a data service whose URL will be http://HOST:PORT/wsrf/services/ogsadai/DataService.</listitem>
            <listitem>-Ddai.resource.id= is the ID of the data service resource that the data service is no longer to expose. For example -Ddai.service.resource=MySQLResource</listitem></itemizedlist>
       </listitem>
            <listitem>You will need to shutdown and restart Tomcat before the changes take effect.</listitem>
            </itemizedlist>
       
            <para>To remove data service resources from data services under GT4 requires execution of the removeResourceGT4 target. 
                This takes the same arguments as removeResourceTomcat. The exception is the -Dtomcat.dir= argument - this target instead accepts -Dgt.dir= which specifies the location of GT4. If this argument is omitted then the GT4 location specified within GLOBUS_LOCATION is used.</para>
   </section> 
<section>    
       <title>Undeploying OGSA-DAI WSRF</title>
            
            <para>This section describes how to remove OGSA-DAI WSRF from the GT4 Web services container or Tomcat.</para>
            
            <para>Undeployment erases all OGSA-DAI XML Schema, OGSA-DAI-specific JAR files and configuration files from the destination.</para>
    <section>
            <title>Undeploying OGSA-DAI WSRF from GT4</title>
            
            <para>To undeploy OGSA-DAI WSRF from GT4:</para>
            <itemizedlist>
            <listitem>Set a GLOBUS_LOCATION environment variable to point to the location of your GT4 distribution. For example, under UNIX, enter:
            
            <screen>$ export GLOBUS_LOCATION=/path/to/Globus/directory</screen>
            </listitem>
            <listitem>Run the following from within the OGSA-DAI distribution directory:
            
           <screen> $ ant undeployGTContainer</screen></listitem>
            </itemizedlist>
            <para>OGSA-DAI WSRF will then be undeployed.</para>
    </section>
<section>    
    <title>Undeploying OGSA-DAI WSRF from Tomcat</title>
            
            <para>To undeploy OGSA-DAI WSRF from Tomcat:</para>
        <itemizedlist>    
            <listitem>Set a CATALINA_HOME environment variable to point to the location of Tomcat. For example, under UNIX, enter:
            
            <screen>$ export CATALINA_HOME=/path/to/Tomcat/directory</screen></listitem>
            <listitem>Run the following from within the OGSA-DAI distribution directory:
            
            <screen>$ ant undeployTomcat</screen></listitem>
            
            <listitem>OGSA-DAI WSRF will then be undeployed from Tomcat.</listitem>
        </itemizedlist>
 <note>  <simpara> 
     As an alternative to setting CATALINA_HOME you can specify the Tomcat location at the command-line as follows: </simpara>  
            
            <screen>$ ant undeployTomcat -Dtomcat.dir=/path/to/Tomcat/directory</screen>
</note>
    </section>
            </section>
    <section>
    <title>Where Does Stuff Go?</title>
            
            <para>This section describes the locations of OGSA-DAI related files after deployment on Tomcat or GT4.</para>
            
            <para>Under GT4, OGSA-DAI resides in the following places:</para>
            <itemizedlist>
            <listitem>share/schema/ogsadai/ - OGSA-DAI XML Schema and WSDL.</listitem>
            <listitem>lib/ - OGSA-DAI JAR files.</listitem>
            <listitem>etc/ogsadai_wsrf/ - OGSA-DAI configuration files - see below.</listitem>
            </itemizedlist>
            <para>Under Tomcat, OGSA-DAI resides in the following places:</para>
            <itemizedlist>
            <listitem>webapps/wsrf/share/schema/ogsadai/ - OGSA-DAI XML Schema and WSDL.</listitem>
            <listitem>webapps/wsrf/WEB-INF/lib/ - OGSA-DAI JAR files.</listitem>
            <listitem>webapps/wsrf/WEB-INF/etc/ogsadai_wsrf/ - OGSA-DAI configuration files - see below.</listitem>
            </itemizedlist>
        
            <para>The OGSA-DAI WSRF configuration files residing in the etc/ogsadai_wsrf directories are as follows:</para>
      <itemizedlist>      
            <listitem>server-config.wsdd - deployment descriptors for the current OGSA-DAI services.</listitem>
            <listitem>jndi-config.xml - JNDI deployment descriptors for the current OGSA-DAI services (see the GT4 documentation for more information).</listitem>
            <listitem>Data service resource files for each current data service. There will be one of these XML files for each current OGSA-DAI service. These files maintain a list of the current data service resources for each data service. The file name is derived from the service path e.g. a service with relative service path ogsadai/DataService has a file _ogsadai_DataService.dsr.xml.</listitem>
            <listitem>Data service resource directories. There is one such directory for each deployed data service resource - the directory shares the name of the data service resource e.g. MyRelationalResource Each directory contains:
            <itemizedlist>
            <listitem>dataResourceConfig.xml - data resource configuration file for the data service resource.</listitem>
            <listitem>activityConfig.xml - activity configuration file for the data service resource.</listitem>
            <listitem>DatabaseRoles.xml - roleMaps file for the data service resource.</listitem>
            </itemizedlist>
            </listitem>
            </itemizedlist>
           <para> To convert existing OGSA-DAI Perform documents to be compatible with OGSA-DAI WSRF see the next section.</para>
    </section>
    <section>
            <title>Converting OGSA-DAI Perform Documents</title>
            
           <para> In previous releases of OGSA-DAI, Perform documents were specified in a gds related namespace. 
        In OGSA-DAI WSRF we have removed from Perform document namespaces information related to the specification (OGSI, WSI, WSRF) 
        implemented at the service level.</para>
            
            <para>To convert Perform documents provided in the main OGSA-DAI distribution (for example OGSA-DAI release 5), within examples, or your own existing Perform documents, into this generic format:</para>
            <itemizedlist>
             <listitem>   
            Execute the ConvertPerform target within the OGSA-DAI WSRF ANT script:
            
            <screen>$ cd $DAI_WSRF
            $ ant ConvertPerform -Dperform.dir=PATH-TO-PERFORM-DIRECTORY</screen>
            
            where PATH-TO-PERFORM-DIRECTORY contains files, all of which are assumed to be Perform documents. For example:
            
            <screen>$ cd $DAI_WSRF
            $ ant ConvertPerform -Dperform.dir=examples/GDSPerform/JDBC/query</screen>
                 
            </listitem>
            <listitem>Do not worry if you make a mistake, the ANT target will make backups (with extension .bak) prior to converting the documents.</listitem>
            </itemizedlist>
    </section>
</section>
<section id="s-ogsadai-admin-testing"><title>Testing</title>
    <para>Please see <xref linkend="s-ogsadai-admin-deploying" /> for information on testing and configuring OGSA-DAI.</para>
</section>

<section id="s-ogsadai-admin-security_considerations"><title>Security considerations</title>
    &OGSA-DAI_Security_Considerations_Frag;
</section>

<section id="s-ogsadai-admin-troubleshooting"><title>Troubleshooting</title>
    <section><title>Cannot connect to MySQL server on localhost:3306 exception</title>
    <para>I am using MySQL and keep on getting a java.sql.SQLException: Cannot connect to MySQL server on 
        localhost:3306 exception - what is the problem? </para>
    
     <para>The MySQL JDBC driver recommended in the OGSA-DAI documentation is not compatible with the latest versions of MySQL. 
    This is the case for MySQL 4.1.6 and 4.1.7 and may be the case for other versions. This problem usually causes the following error message to be logged:</para>
    
    <screen>java.sql.SQLException: Cannot connect to MySQL server on localhost:3306.
        Is there a MySQL server running on the machine/port you are trying to connect to? (java.lang.NumberFormatException)</screen>
    
    <para>To address this problem all you need to do is use a newer version of the MySQL JDBC driver JAR which can be downloaded from:</para>
    
    <para><ulink url="http://www.mysql.com/products/connector/j/">http://www.mysql.com/products/connector/j/</ulink></para>
    
<para>If you have already deployed services using the incompatible JAR, follow these steps:</para>
    <itemizedlist>
    <listitem>Stop your container.</listitem>
    <listitem>Replace the JAR file in the lib directory in the container. See Where Does Stuff Go? above.</listitem>
    <listitem>Restart the container.</listitem>
    </itemizedlist>
    </section>
    <section><title>Illegal access error</title>
   <para> Why do I get Exception in thread "main" java.lang.IllegalAccessError: tried to access field...?</para>
  <para>  
    This error can arise due to clashes of Xalan shipped with certain versions of Java and that shipped with the Globus Toolkit. 
      Please see the OGSA-DAI FAQ at <ulink url="http://www.ogsadai.org.uk/docs/current/doc/misc/FAQ.html#IllegalAccessError">http://www.ogsadai.org.uk/docs/current/doc/misc/FAQ.html#IllegalAccessError</ulink> for more information.
  </para>
        <para>
            Please check up the OGSA-DAI website (<ulink url="http://www.ogsadai.org.uk">www.ogsadai.org.uk</ulink>) for any updates. 
            In particular the OGSA-DAI FAQ although 
    note that this also caters for the non-WSRF distributions of OGSA-DAI. </para>
    </section>
</section>



