<?php
include_once( "http://www-unix.globus.org/toolkit/docs/development/4.0-drafts/draft.inc" );
?>

<h1>GT 4.0 WS MDS Aggregator : System Administrator's Guide</h1>
<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li> <a href="#installing">Building and Installing</a></li>
  <li><a href="#configuring">Configuring</a></li>
  <li><a href="#deploying">Deploying</a></li>
  <li><a href="#testing">Testing</a></li>
  <li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
<h2><a name="introduction"></a>Introduction</h2>

<p>The aggregator is a framework for services which collect information
from or about services or resources in a virtual organisation.</p>

<p>Two such services in the GT4 release are the 
<a href="../../index/">Index Service</a> and the 
<a href="../../trigger/">Trigger Service</a>.</p>


<h2><a name="installing"></a>Building and Installing</h2>

<p>The aggregator 


<h2><a name="configuring"></a>Configuring</h2>
<p>Information on configuration settings and environment variables can be found
  in the <a href="../WS_MDS_Aggregator_Public_Interfaces.html">public interface
  guide</a>.</p>

<p>The aggregator framework does not have its own service side 
configuration, although services which are based on the framework 
have their own service side configuration options, documented in the
per-service documentation.</p>

<p>Registrations to a working aggregator are configured for the
<code>mds-servicegroup-add</code> tool. This tool takes an 
XML configuration file listing registrations, and causes thoses
registrations to be made. The tool should be run as a daemon.</p>

<p>The tool can be deployed at the aggregating service, at resource
services, or at any other location. This allows registrations to be
configured by the administrator of the aggregating service, or by
the administrator of resources, by a third party, or by some combination
of those.</p>


<p>Usage:
<pre>mds-servicegroup-add /path/to/reg.xml</pre>
<p>An example registration file can be found in 
<code>$GLOBUS_LOCATION/etc/globus_wsrf_mds_aggregator/example-aggregator-registration.xml</code>.</p>

<p>The registration file has fields to specify the default servicegroup EPR,
the default registration EPR, and then details of individual registrations.
</p>

<p>The Content block of each registration in the configuration file can 
contain configuration elements that affect both the aggregator source
(i.e. determines how information is collected) and the aggregator sink
(i.e. what is done with the information once it has been collected).
</p>

<p>Sink-specific configuration information is documented per-service. See
the admin guide for the <a href="../../trigger/admin/index.html">trigger</a> 
service. The index service does not have sink-specific configuration.</p>

<p>Each aggregator source has its own set of configuration options.
There follows a list of the aggregator sources supplied with GT3.9.3.</p>

<h3>QueryAggregatorSource</h3>

<p>The <code>QueryAggregatorSource</code> gathers resource property values from 
the registered resource using one of the three WS-Resource Properties
poll operations.

The method used depends on the configuration element supplied in 
the registration content.

Note that it is considered a configuration error to specify more than
one of these configuration blocks, whether of the same type or 
different.</p>

<ul>
<li><code>GetResourcePropertyPollType</code>; requests a single 
Resource Property from the remote resource. Parameters are a 
refresh period (in milliseconds) and a single QName specifying the 
name of the Resource Property to be queried.
</li>

<li><code>GetMultipleResourcePropertiesPollType</code>; requests multiple
Resource Properties from the remote resource. Parameters are a 
refresh period (in milliseconds) and a list of QNames specifying the
names of the Resource Properties to be queried.
</li>

<li><code>QueryResourcePropertiesPollType</code>; requests a query be
executed against the Resource Property Set of the remote resource. In the
GT3.9.3 implementation of core, the only query language that is supported is
   XPath. Parameters are a refresh period (specified in milliseconds) and a 
query to be evaluated against the remote Resource Property Set.
</li>
</ul>
</p>

<h3>SubscriptionAggregatorSource</h3>

<p>The <code>SubscriptionAggregatorSource</code> gathers 
resource property values from
the registered resource using WS-Notification subscriptions.</p>

<p>There is 
a single configuration type, <code>AggregatorSubscriptionType</code>, 
which specifies the name of the 
remote Resource Property (actually Topic) to subscribe to as well as 
WS-Notification preconditions, selectors, policy and termination time. 
Details of these can be found in TODO: ref WS-Notif link
(TODO: are these all implemented?)</p>


<h3>ExecutionAggregatorSource</h3>

<p>The <code>ExecutionAggregatorSource</code> gathers arbitrary
XML information about a registered resource by executing an
external script and passing registration as parameters. See the 
developers guide for details of this API. (TODO crosslink)</p>

<p>There is a single configuration type, <code>ExecutionPollType</code>,
which specifies the period between script executions, and the choice 
of script. The period parameter is specified in milliseconds. The
script parameter is specified as an alphabetic string which names
a probe script stored in 
<code>$GLOBUS_LOCATION/libexec/aggrexec/</code>.</p>

<p>Specific probe scripts can extract additional configuration information
from the configuration block.</p>

<h2><a name="deploying"></a>Deploying</h2>
<p><font color="purple">[information about deploying the component into various
    containers/environments] </font></p>


<h2><a name="testing"></a>Testing</h2>
<p><font color="purple">[procedures for how to test the configuration. must include
    examples of the tests ]</font></p>



<h2><a name="troubleshooting"></a>Troubleshooting</h2>
<p><font color="purple">[help for common problems sysadmins may experience] </font></p>
<ul>
</ul>


