<!--NOT FINISHED-->

<refentry id="globusrun-ws">
<refmeta>
<refentrytitle>globusrun-ws</refentrytitle>
<manvolnum>1</manvolnum>
</refmeta>
<refnamediv>
<refname>globusrun-ws</refname>
<refpurpose>PURPOSE</refpurpose>
</refnamediv>
<refsynopsisdiv><cmdsynopsis>
<command>globusrun-ws</command>
</cmdsynopsis>
</refsynopsisdiv>


<refsect1 id="description"><title>Description</title>
<para>
globusrun-ws (WS_GRAM client) is a program for submitting and
managing jobs to a local or remote job host. WS_GRAM provides secure
job submission to many types of job scheduler for users who have the
right to access a job hosting resource in a Grid environment. All
WS_GRAM submission options are supported transparently through the
embedded request document input. <tt>globusrun-ws</tt> offers
additional features to fetch job output files incrementally during the
run as well as to automatically delegate credentials needed for
certain optional WS_GRAM features. Online and batch submission modes
are supported with reattachment (recovery) for jobs whether they were
started with this client or another WS_GRAM client application.
</para>
</refsect1>


<refsect1 id="synopsis"section><title>Synopsis</title>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>globusrun-ws <emphasis>-submit</emphasis><br/>
[-batch] [-quiet] [-no-cleanup]<br/>
[-streaming [-streaming-out <u>filename</u>]
  [-streaming-err <u>filename</u>]]<br/>
[-host-authz | -self-authz | -subject-authz
  <u>subject name</u>]<br/>
[-private] [-http-timeout <u>milliseconds</u>]
  [-debug]<br/>
[-allow-ipv6] [-passive] [-nodcau]<br/>
[-factory-epr-file <u>filename</u> |<br/>
[-factory <u>contact</u>]
  [-factory-type <u>type</u>]]<br/>
[-submission-id <u>uuid</u> | -submission-id-file
  <u>filename</u>]<br/>
[-submission-id-output-file <u>filename</u>]
  [-job-epr-output-file <u>filename</u>]<br/>
[-job-delegate] [-staging-delegate]<br/>
[-job-credential-file <u>filename</u>]
  [-staging-credential-file <u>filename</u>]<br/>
[-transfer-credential-file <u>filename</u>]<br/>
[-termination +<u>HH:MM</u>|<u>mm/dd/yyyy HH:MM</u>]
  <br/>
-job-description-file <u>filename</u> | -job-command
  [--] <u>program</u> [arg ...]<br/>
</entry>
<entry>
<para>
The -submit command submits (or <emphasis>resubmits</emphasis>) a job to a
job host in one of three output modes: batch, interactive, or
interactive-streaming.
</para>
</entry>
</row>
<row><entry>globusrun-ws <emphasis>-validate</emphasis><br/>
-job-description-file <u>filename</u></entry>
<entry>
<para>
The -validate command checks the job description for syntax errors and a
subset of semantic errors without making any service requests.
</para>
</entry>
</row>

<row><entry>
globusrun-ws <emphasis>-monitor</emphasis><br/>
-job-epr-file <u>filename</u><br/>
[-quiet] [-no-cleanup]<br/>
[-streaming [-streaming-out <u>filename</u>] [-streaming-err <u>filename</u>]]<br/>
[-host-authz | -self-authz | -subject-authz <u>subject name</u>]<br/>
[-private] [-http-timeout <u>milliseconds</u>] [-debug]<br/>
[-allow-ipv6] [-passive] [-nodcau]<br/>
</entry>
<entry>
<para>
The -monitor command attaches to an existing job in interactive or
interactive-streaming output modes.
</para>
</entry>
</row>

<row><entry>
globusrun-ws <emphasis>-status</emphasis><br/>
-job-epr-file <u>filename</u><br/>
[-host-authz | -self-authz | -subject-authz <u>subject name</u>]<br/>
[-private] [-http-timeout <u>milliseconds</u>] [-debug]<br/>
</entry>
<entry>
<para>
The -status command reports the current state of the job and exits.
</para>
</entry>
</row>

<row><entry>
globusrun-ws <emphasis>-kill</emphasis><br/>
-job-epr-file <u>filename</u><br/>
[-host-authz | -self-authz | -subject-authz <u>subject name</u>]<br/>
[-private] [-http-timeout <u>milliseconds</u>] [-debug]<br/>
</entry>
<entry>
<para>
The -kill command requests the immediate cancellation of the job and exits.
</para>
</entry>
</row>

<row><entry>globusrun-ws <emphasis>-help</emphasis></entry>
<entry>
<para>
Outputs an overview of the commands and features of the command.
</para>
</entry>
</row>

<row><entry>globusrun-ws <emphasis>-usage</emphasis>
  [-validate | -submit | -monitor | -status | -kill]</entry>
<entry>
<para>
Outputs brief usage information for the command.
</para>
</entry>
</row>

<row><entry>globusrun-ws <emphasis>-version(s)</emphasis></entry>
<entry>
<para>
Outputs version information for the command.
</para>
</entry>
</row>


</tbody></tgroup>
</table>

</section>
<section><title>Command options</title>

<h3>Quiet mode</h3>

<para>
A variety of protocol status messages, warning messages, and output
data may be printed to standard output and error under multiple
command modes. The <emphasis>quiet mode</emphasis> suppresses all but fatal standard
error messages in order to have clean outputs for use in scripting or
with the <emphasis>streaming output mode</emphasis> where application output is
retrieved and output.
</para>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-q, -quiet</entry>
<entry>
<para>
If supplied, all non-fatal status and protocol-related messages are
suppressed.
</para>
</entry>
</row>

</tbody></tgroup>
</table>

<h3>Debug mode</h3>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>
<row><entry>-dbg, -debug</entry>
<entry>
<para>
If supplied, all soap messages and ftp control messages will be displayed on stderr.
</para>
</entry>
</row>

</tbody></tgroup>
</table>

<h3>Protocol Options</h3>

</refsect1><refsect1><title>Service authorization</title>

<para>
Usually, secure communication includes mutual authentication. In
addition to the service authorizing the client for the requested
operation(s), an authorization decision is made by the client to
determine whether the remote service is the one intended.
</para>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-host, -host-authz</entry>
<entry>
<para>
The GSI "host authorization" rule is used to verify that the service
is using a host credential appropriate for the underlying service
address information. This is the default.
</para>
</entry>
</row>

<row><entry>-self, -self-authz</entry>
<entry>
<para>
The GSI "self authorization" rule is used to verify that the service
is using a (proxy) credential derived from the same identity as the
client's.
</para>
</entry>
</row>

<row><entry>-subject, -subject-authz <u>subject name</u></entry>
<entry>
<para>
The service must be using a credential with the exact subject name
provided by this option.
</para>
</entry>
</row>

</tbody></tgroup>
</table>

</refsect1><refsect1><title>Security Protocol</title>

<para>
The client uses secure transport for all https enpoints and secure message
for http.  Secure conversation is currently unsupported.
</para>

<row><entry>-p, -private</entry>
<entry>
<para>
If supplied, privacy-protection is enabled between globusrun-ws and
WS_GRAM or GridFTP services. It is a fatal error to select privacy
protection if it is not available due to build options or other
security settings.

<emphasis>Note:</emphasis> Currently only supported with https endpoints.
</para>
</entry>
</row>

</tbody></tgroup>
</table>

</refsect1><refsect1><title>Timeouts</title>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-T, -http-timeout <u>milliseconds</u></entry>
<entry>
<para>
Set timeout for HTTP socket, in milliseconds, for all Web services
interactions. The default value is 120000 (2 minutes).
</para>
</entry>
</row>

</tbody></tgroup>
</table>

<h3>Signal handling</h3>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-n, -no-cleanup</entry>
<entry>
<para>
If supplied, the default behavior of trapping interrupts (SIG_INTR)
and cancelling the job is disabled. Instead, the interrupt simply
causes the tool to exit without affecting the ManagedJob resource.
</para>
</entry>
</row>

</tbody></tgroup>
</table>



<h3>Submit options</h3>

</refsect1><refsect1><title>Output Mode</title>

<para>
The user can select several tool behaviors following submission. In
<emphasis>batch mode</emphasis>, the tool prints the resulting ManagedJob EPR as the
sole standard output (unless in <emphasis>quiet mode</emphasis>) and exits. In
<emphasis>interactive mode</emphasis>, the tool keeps running in order to monitor
job status. Interactive mode is qualitatively equivalent to a
batch-mode submission immediately followed a second invocation of
globusrun-ws using the -monitor command. In interactive mode, an
optional <emphasis>streaming mode</emphasis> where job output files are fetched and
output from globusrun-ws.
</para>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-b, -batch</entry>
<entry>
<para>
If supplied, the batch mode is enabled. The default is interactive mode.
The tool prints the resulting ManagedJob EPR as
the sole standard output (unless in quiet mode) and exits.
</para>
</entry>
</row>

<row><entry>-s, -streaming</entry>
<entry>
<para>
The standard output and standard error files of the job are monitored
and data is written to the corresponding output of globusrun-ws. The
standard output will contain ONLY job output data, while the standard
error may be a mixture of job error output as well as globusrun-ws
messages, unless the <emphasis>quiet mode</emphasis> is also enabled.
</para>

<para>
Streaming output depends on the ability to access job outputs via
GridFTP. If -streaming mode is selected and the job description does not
already specify output file redirection for the job host, then
globusrun-ws adds unique output file name redirections and automatic
cleanup directives to the job description.
</para>

<para>
If you are using -batch mode, but intend to use -streaming with -monitor,
you may want to still include -streaming.  -streaming always introduces
a 'CleanUp Hold' state which ensures that all the data is streamed before the
files are destroyed.  If you do use -streaming with -batch, you <emphasis>must</emphasis>
come back with -monitor so the hold can be released.
</para>
<para>
This option implies -staging-delegate if the stdout and stderr entries are not specified in the job description.
</para>
</entry>
</row>

<row><entry>-so, -stdout-file <u>filename</u></entry>
<entry>
<para>
append stdout out stream to the specified file instead of to stdout.
</para>
</entry>
</row>

<row><entry>-se, -stderr-file <u>filename</u></entry>
<entry>
<para>
append stderr out stream to the specified file instead of to stderr.
</para>
</entry>
</row>
</tbody></tgroup>
</table>

</refsect1><refsect1><title>Streaming Options</title>

<para>Streaming makes use of GridFTP client calls to retrieve user data.  The
following options apply to such transfers.
</para>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>
<row><entry>-ipv6, -allow-ipv6</entry>
<entry>
<para>
Allow streaming transfers to use IPV6.
</para>
</entry>
</row>

<row><entry>-passive</entry>
<entry>
<para>
Force streaming transfers to use MODE S to allow for passive mode
       transfers. (Useful if you're behind a firewall, but expensive
       because there is no connection caching).
</para>
</entry>
</row>

<row><entry>-nodcau</entry>
<entry>
<para>
Disable data channel authentication on streaming transfers
</para>
</entry>
</row>

</tbody></tgroup>
</table>


</refsect1><refsect1><title>Factory information</title>

<para>
Addressing information for the ManagedJobFactory target of this
submission must be provided. If neither option is specified, and no
EPR is supplied in the job description, then "-factory localhost
-factory-type fork" is assumed.
</para>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-Ff, -factory-epr-file <u>filename</u></entry>
<entry>
<para>
If supplied, this option causes the EPR for the ManagedJobFactory to
be read from the given file. This EPR is used as the service endpoint
for submission of the job.
</para>
</entry>
</row>

<row><entry>-F, -factory <u>contact</u></entry>
<entry>
<para>
If supplied, this option causes an EPR to be constructed using ad-hoc
methods that depend on GT implementation details.  For
interoperability to other implementations of WS_GRAM, the
-factory-epr-file option should be used instead.
</para>

<screen>
[<u>protocol</u>://]{<u>hostname</u>|<u>hostaddr</u>}[:<u>port</u>][/<u>service</u>]
</screen>

<para>
Default values form the following contact information if not overridden:
</para>

<screen>https://localhost:8443/wsrf/services/ManagedJobFactoryService</screen>

</entry>
</row>

<row><entry>-Ft, -factory-type <u>type</u></entry>
<entry>
<para>
In the absence of -factory-epr-file, this option refines the behavior of the
-factory option to select a specific type of scheduler. The default is "Fork"
for single jobs and "Multi" for multijobs.
</para>
</entry>
</row>

</tbody></tgroup>
</table>

</refsect1><refsect1><title>Job description</title>

<para>
A description of the job to be submitted must be provided with the
-submit command, either using the WS_GRAM XML description syntax or a
simpler Unix command and argument list.
</para>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-f, -job-description-file <u>filename</u></entry>
<entry>
<para>
If supplied, this option causes the job description to be read from
the given file.  This description is modified according to the other
options and passed in the WS_GRAM submission messages.  The root element of
this file must be 'job' for a single job or 'multiJob' for a multijob.
</para>
</entry>
</row>

<row><entry>-c, -job-command [--] <u>prog</u> [<u>arg</u> ...]</entry>
<entry>
<para>
If supplied, this option take all remaining globusrun-ws arguments as
its arguments; therefore it must appear last among globusrun-ws
options. This option causes globusrun-ws to generate a simple job
description with the named program and arguments.
</para>

</tbody></tgroup>
</table>

</refsect1><refsect1><title>Submission ID</title>

<para>
A submission ID may be used in the WS_GRAM protocol for robust
reliability in the face of message faults or other transient errors to
ensure that at most one instance of a job is executed, i.e. to prevent
accidental duplication of jobs under rare circumstances with client
retry on failure. The globusrun-ws tool always uses this feature,
requiring either a submission ID to be passed in as input or a new
unique ID to be created by the tool itself. If a new ID is created, it
should be captured by the user who wishes to exploit this reliability
interface. The ID in use, whether created or passed as input, will be
written to the optional output file when provided, as well as to the
standard error output unless the <emphasis>quiet mode</emphasis> is in
effect.
</para>

<para>
If a user is unsure whether a job was submitted successfully, he
should resubmit using the same ID as was used for the previous
attempt.
</para>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-I, -submission-id <u>ID</u></entry>
<entry>
<para>
If supplied, this option causes the job to be submitted using the
given ID in the reliability protocol.
</para>
</entry>
</row>

<row><entry>-If, -submission-id-file <u>filename</u></entry>
<entry>
<para>
If supplied, this option causes the ID to be read from the given
file. It is an error to use both mechanisms to provide an input ID.
</para>
</entry>
</row>

<row><entry>-Io, -submission-id-output-file <u>filename</u></entry>
<entry>
<para>
If supplied, the ID in use is written to the given file, whether this
ID was provided by the user or given by one of the above input
options.
</para>
</entry>
</row>

</tbody></tgroup>
</table>

</refsect1><refsect1><title>Job EPR output</title>

<para>
A successful submission will create a new ManagedJob resource with its
own unique EPR for messaging. The globusrun-ws tool will output this
EPR to a file when requested and as the sole standard output when
running in batch mode. When running in streaming output mode, it is
possible that the EPR will not be output and the user's only recourse
is to submit again with the same submission ID and job request in
order to reattach to the existing job.
</para>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-o, -job-epr-output-file <u>filename</u></entry>
<entry>
<para>
If supplied, the created ManagedJob EPR will be written to the given
file following successful submission. The file will not be written if
the submission fails.
</para>
</entry>
</row>

</tbody></tgroup>
</table>

</refsect1><refsect1><title>Delegation</title>

<para>
The job description supports the optional identification of delegated
credentials for use by the WS_GRAM services.  These features are
passed through globusrun-ws without modification. However,
globusrun-ws can also perform delegation and construct these optional
request elements before submitting it to the service. The only delegation
performed by default (if an endpoint does not already exist) is the multijob
level jobCredential.
</para>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-J, -job-delegate</entry>
<entry>
<para>
If supplied AND the job description does not already provide a <font
color="red">jobCredential element, globusrun-ws will delegate
the client credential to WS_GRAM and introduce the corresponding
element to the submission input.
</para>
</entry>
</row>

<row><entry>-S, -staging-delegate</entry>
<entry>
<para>
If supplied AND the job description does include staging or cleanup
directives AND the job description does not already provide the
necessary stagingCredential or 
transferCredential element(s),
globusrun-ws will delegate the client credential to WS_GRAM and RFT, and
introduce the corresponding elements to the submission input.
</para>

<para>This option is implied by -streaming</para>
</entry>
</row>

<row><entry>-Jf, -job-credential-file <u>filename</u>:</entry>
<entry>
<para>
If supplied AND the job description does not already provide a
jobCredential element, globusrun-ws will copy the supplied epr into
the job description.  This should be an epr returned from the
DelegationFactoryService intended for use by the job (or, in the
case of a multijob, for authenticating to the subjobs).
</para>
<para>
<emphasis>note</emphasis>: for multijob descriptions, only the top level jobCredential
will be copied into.
</para>
</entry>
</row>

<row><entry>-Sf, -staging-credential-file <u>filename</u>:</entry>
<entry>
<para>
If supplied AND the job description does not already provide a
stagingCredential element, globusrun-ws will copy the supplied epr
into the job description.  This should be an epr returned from the
DelegationFactoryService intended for use with the RFT service
associated with the ManagedJobService.
</para>
<para>
<emphasis>note</emphasis>: this option is ignored for multijobs.
</para>
</entry>
</row>

<row><entry>-Tf, -transfer-credential-file <u>filename</u>:</entry>
<entry>
<para>
If supplied, globusrun-ws will copy the epr into each of the
stage in, stage out, and cleanup elements that do not already
contain a transferCredential element.  This should be an epr
returned from the DelegationFactoryService intended for use by
RFT to authenticate with the target gridftp server.
</para>
<para>
<emphasis>note</emphasis>: this option is ignored for multijobs.
</para>
</entry>
</row>

</tbody></tgroup>
</table>

</refsect1><refsect1><title>Lifetime</title>

<para>
The ManagedJob resource supports lifetime management in the form of a
scheduled destruction. The default lifetime requested by the client is
infinite, subject to server policies.
</para>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-term, -termination <u>mm/dd/yyyy HH:MM</u></entry>
<entry>
<para>
Set an absolute termination time.
</para>
</entry>
</row>

<row><entry>-term, -termination +<u>HH:MM</u></entry>
<entry>
<para>
Set a termination time relative to the successful creation of the
job. The default is +24:00
</para>
</entry>
</row>

</tbody></tgroup>
</table>

<h3>Validate options</h3>

</refsect1><refsect1><title>Job description</title>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-f, -job-description-file <u>filename</u></entry>
<entry>
<para>
This option causes the job description to be read from the given file.
This description is checked for validity.
</para>
</entry>
</row>

</tbody></tgroup>
</table>

<h3>Monitor options</h3>

</refsect1><refsect1><title>Job</title>

<para>
Addressing information for the ManagedJob target of this command
must be provided.
</para>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-j, -job-epr-file <u>filename</u></entry>
<entry>
<para>
If supplied, this option causes the EPR for the ManagedJob to be read
from the given file. This EPR is used as the endpoint for service
requests.
</para>
</entry>
</row>

</tbody></tgroup>
</table>

</refsect1><refsect1><title>Output mode</title>

<para>
In the default <emphasis>interactive mode</emphasis>, the tool keeps running in
order to monitor job status.  In the optional <emphasis>interactive-streaming
mode</emphasis>, the job output files are fetched and output from
globusrun-ws as well.
</para>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>-s, -streaming</entry>
<entry>
<para>
See Output mode under Submit Options above for details on streaming.
</para>
</entry>
</row>
</tbody></tgroup>
</table>

<h3>Status options</h3>

<para>
See the Job options for the -monitor command.
</para>

<h3>Kill options</h3>

<para>
See the Job options of the -monitor command.
</para>

</section>
<section><title>Job Handling</title>

<para>
For every job that globusrun-ws delegates a credential, globusrun will augment
the user's job description, adding annotations that will later tell
globusrun-ws to destroy the credential after the job has been destroyed.
Below are 2 job annotation examples.

globusrun-ws only delegated the job cred...
<screen>
   &lt;extensions&gt;
      &lt;globusrunAnnotation&gt;
         &lt;automaticJobDelegation&gt;true&lt;/automaticJobDelegation&gt;
         &lt;automaticStagingDelegation&gt;false&lt;/automaticStagingDelegation&gt;
         &lt;automaticStageInDelegation&gt;false&lt;/automaticStageInDelegation&gt;
         &lt;automaticStageOutDelegation&gt;false&lt;/automaticStageOutDelegation&gt;
         &lt;automaticCleanUpDelegation&gt;false&lt;/automaticCleanUpDelegation&gt;
      &lt;/globusrunAnnotation&gt;
   &lt;/extensions&gt;
</screen>

globusrun-ws delegated the job, staging and stage in cred...
<screen>
   &lt;extensions&gt;
      &lt;globusrunAnnotation&gt;
         &lt;automaticJobDelegation&gt;true&lt;/automaticJobDelegation&gt;
         &lt;automaticStagingDelegation&gt;true&lt;/automaticStagingDelegation&gt;
         &lt;automaticStageInDelegation&gt;true&lt;/automaticStageInDelegation&gt;
         &lt;automaticStageOutDelegation&gt;false&lt;/automaticStageOutDelegation&gt;
         &lt;automaticCleanUpDelegation&gt;false&lt;/automaticCleanUpDelegation&gt;
      &lt;/globusrunAnnotation&gt;
   &lt;/extensions&gt;
</screen>

</section>
<section><title>Environment</title>

<table><title>TITLE</title>
<tgroup cols="2"><tbody>

<row><entry>X509_USER_PROXY</entry>
<entry>
<para>
Overrides the default selection of user credentials when using GSI security.
</para>
</entry>
</row>

</tbody></tgroup>
</table>


</section>
<section><title>Exit Codes</title>

<para>
The client returns negative error codes for client errors, 0 for success,
and postive error codes from the submitted job (where possible)
</para>

