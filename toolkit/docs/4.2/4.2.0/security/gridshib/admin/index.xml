<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd"
[

<!ENTITY % xinclude SYSTEM "../../../xinclude.mod" >
%xinclude;

]>
<book id="gridshibAdmin">
  <title>GT <replaceable role="entity">version</replaceable> GridShib : System Administrator's Guide</title>
  <titleabbrev> System Administrator's Guide</titleabbrev>
  <bookinfo>
    <abstract>
      <title>Introduction</title>
      <para>This guide contains advanced configuration information for system administrators working
        with GridShib. It provides references to information on procedures typically performed by
        system administrators, including installation, configuring, deploying, and testing the
        installation. </para>
      <para><important>
        <simpara> The information in this GridShib Admin Guide is in addition to the basic Globus
          Toolkit prerequisite, overview, installation, security configuration instructions in the
            <olink targetdoc="gtadmin"/>. Read through this guide before continuing!</simpara>
      </important></para>
    </abstract>
  </bookinfo>

  <chapter id="gridshib-admin-installing">
    <title>Building and Installing</title>
    <para>GridShib is build and installed with the Globus Toolkit by default, nothing more need be done.</para>
  </chapter>

    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="../GridShib_Interface_Config_Frag.xml"
      />

  <chapter id="gridshib-admin-deploying">
    <title>Deploying</title>
    <section id="gridshib-container-deployment">
      <title>Deploying at the Container Level</title>
      <para>To deploy GridShib for a GT4 container:
      <orderedlist>
	<listitem><para>Edit the file <filename>$GLOBUS_LOCATION/etc/globus_wsrf_core/global_security_descriptor.xml</filename>. If the file <filename>$GLOBUS_LOCATION/etc/globus_wsrf_core/global_security_descriptor.xml</filename> does not exist, create it in its entirety as shown in the example below.</para></listitem>
	<listitem><para>Add an authz element inside the <literal>securityConfig</literal> element with an attribute of <literal>value=org.globus.gridshib.GridShibPDP</literal></para></listitem>
      </orderedlist></para>
      <example>
	<title>example global security descriptor file</title>
	<screen>
	  <![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<securityConfig xmlns="http://www.globus.org">
    <credential>
        <key-file value="/etc/grid-security/containerkey.pem"/>
        <cert-file value="/etc/grid-security/containercert.pem"/>
    </credential>
    <authz value="global:org.globus.gridshib.GridShibPDP"/>
    <gridmap value="/etc/grid-security/grid-mapfile"/>
</securityConfig>
	  ]]>
	</screen>
      </example>
    </section>
    <section id="gridshib-service-deployment">
      <title>Deploying at the Service Level</title>
      <para>To deploy GridShib for a particular service:
      <orderedlist>
	<listitem><para>Edit the security configuration file for the service. For example, for GRAM the file is <filename>$GLOBUS_LOCATIONetc/gram-service/managed-job-factory-security-config.xml</filename></para></listitem>
	<listitem><para>Comment out the existing <literal>authz</literal> element if it exists.</para></listitem>
	<listitem><para>Add an authz element inside the <literal>securityConfig</literal> element with an attribute of <literal>value=org.globus.gridshib.GridShibPDP</literal></para></listitem>
      </orderedlist></para>
      <para>Note that if you are adding GridShib to GRAM you need to modify /etc/sudoers as outlined in the GT4 GRAM Admin Guide. (XXX Add link to admin guide)(??? modified how exactly ???)</para>
      <example>
	<title>example GRAM security configuration with GridShib deployment</title>
	<screen>
<![CDATA[
<securityConfig xmlns="http://www.globus.org">
    <method name="createManagedJob">
        <auth-method>
            <GSITransport/>
            <GSISecureMessage/>
            <GSISecureConversation/>
        </auth-method>
    </method>
    <!--<authz value="gridmap"/>-->
    <authz value="gram:org.globus.gridshib.GridShibPDP"/>
    <reject-limited-proxy value="true"/>
</securityConfig>
]]>
	</screen>
      </example>
    </section>
  </chapter>

  <chapter id="gridshib-admin-testing">
    <title>Testing</title>
    <para>
      <example>
	<title>Testing</title>
	<screen>
  As a simple test, request the SecurityContextEchoService:

$ $GLOBUS_LOCATION/bin/gridshibecho -d -z none \
    -s https://localhost:8443/wsrf/services/SecurityContextEchoService
---------
Response:
---------

Principal {
   name='/C=US/O=National Center for Supercomputing Applications/CN=Tom Scavo'
}
	</screen>
      </example>
    </para>
  </chapter>
  <chapter id="gridshib-admin-security_considerations">
    <title>Security Considerations </title>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../GridShib_Security_Considerations_Frag.xml" />
  </chapter>
  <chapter id="gridshib-admin-troubleshooting">
    <title>Troubleshooting</title>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../GridShib_Troubleshooting_Frag.xml" />
  </chapter>
</book>


