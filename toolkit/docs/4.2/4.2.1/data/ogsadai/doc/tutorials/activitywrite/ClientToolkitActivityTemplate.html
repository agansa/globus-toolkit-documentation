
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!-- &copy; International Business Machines Corporation, 2004 -->
<!-- &copy; The University of Edinburgh, 2004 -->
<head>
<title>Client Toolkit Activity Template</title>
<link rel="stylesheet" type="text/css" href="../../style.css"/>
</head>
<body>
<h2>Client Toolkit Activity Template</h2>
<p>
The Java code below can be copied and pasted into a new file and used
as a template for utilising an activity from within the OGSA-DAI
Client Toolkit.
</p>

<pre class="java">
package uk.org.ogsadai.client.toolkit.activity;

import org.apache.log4j.Logger;
import org.w3c.dom.Element;

import uk.org.ogsadai.client.toolkit.Activity;
import uk.org.ogsadai.client.toolkit.ActivityOutput;
import uk.org.ogsadai.client.toolkit.ActivityOutputException;
import uk.org.ogsadai.client.toolkit.DataFormatException;
import uk.org.ogsadai.common.XMLUtilities;
import uk.org.ogsadai.common.exception.common.CommonUserException;

<span class="comment">
/**
 * This is a template class that can be used for writing new client toolkit
 * activity.
 *
 * @author The OGSA-DAI Project Team
 */
</span>public class ActivityTemplate extends Activity
{
    <span class="comment">// Logger object for logging in this class</span>
    private static final Logger LOG = Logger.getLogger(ActivityTemplate.class);

    <span class="comment">// 1. Define instance fields for storing any configuration information
    //    that will be passed to the constructor and set methods.</span>

    <span class="comment">/** A required setting. */</span>
    private String mSettingA;

    <span class="comment">/** Another required setting. */</span>
    private int mSettingB;

    <span class="comment">/** An optional setting. */</span>
    private String mSettingC;

    <span class="comment">// 2. Modify this constructor to register any inputs and/or outputs with the
    //    superclass. The constructor should also have parameters to allow
    //    any required configuration information to be specified. Multiple
    //    constructors may be defined if necessary.</span>

    <span class="comment">/**
     * Constructs the activity.
     */</span>
    public ActivityTemplate(String settingA, int settingB)
    {
        addInput("DisplayNameForInput");
        addOutput("DisplayNameForOutput");
        mSettingA = settingA;
        mSettingB = settingB;
    }

    <span class="comment">// 3. Define set methods for any optional configuration settings</span>

    public void setSettingC(String setting)
    {
        if (setting == null)
        {
            throw new IllegalArgumentException("Argument must not be null");
        }
        mSettingC = setting;
    }

    <span class="comment">// 4. Define set methods for any inputs to the activity.
    //    An example is provided suitable for an single input activity.
    //    This should be removed if the activity does not have any inputs.</span>

    <span class="comment">/**
     * Connected the input of this activity to output of another activity. By
     * this mechanism, activities can be chained to one another.
     *
     * @param  input                     output from another activity
     * @throws IllegalArgumentException  if the argument is null
     */</span>
    public final void setInput(final ActivityOutput input)
    {
        if (input == null)
        {
            throw new IllegalArgumentException("Argument must not be null");
        }
        super.setInput(0, input.getName());
    }

    <span class="comment">// 5. Define get methods for accessing any outputs of the activity. These
    //    outputs can be connected to the inputs of other activities to form
    //    activity chains.</span>

    <span class="comment">/**
     * Gets the activity output.
     *
     * @return the activity output
     */</span>
    public ActivityOutput getOutput()
    {
        return getOutputs()[0];
    }

    <span class="comment">// 6. Define get methods for accessing any outputs generated by the activity
    //    in a usable fasion. For example, the SQLQuery activity has a
    //    getResultSet method that gets the output of the activity as a
    //    java.sql.ResultSet rather than an XML string.</span>

    <span class="comment">/**
     *
     *
     * @return
     */</span>
    public int getSomething() throws DataFormatException, ActivityOutputException
    {
        int something = 0;

        ActivityOutput output = getOutputs()[0];
        String outputData = output.getData();

        try
        {
            Element element = XMLUtilities.xmlStringToDOM(
                outputData, false).getDocumentElement();
            something = Integer.parseInt(element.getAttribute("someAttribute"));
        }
        catch (CommonUserException e)
        {
            throw new DataFormatException(
                "The output data was not in the expected format.");
        }

        return something;
    }

    <span class="comment">// 7. Modify the generateXML method to construct the XML that will be
    //    embedded into a perform document for this activity. This usually
    //    consists of appending element and attribute XML to a StringBuffer
    //    and depends on the configuration information passed to the constructor
    //    and set methods.</span>

    <span class="comment">/* (non-Javadoc)
     * @see uk.org.ogsadai.client.toolkit.Activity#generateXML()
     */</span>
    protected String generateXML()
    {
        final StringBuffer xml = new StringBuffer();

        xml.append("&lt;activityElement&gt;\n");

        <span class="comment">// append activity input sub-element</span>

        xml.append("&lt;input from=\"");
        xml.append(getInputParameters()[0].getOutputName());
        xml.append("\"/&gt;\n");

        <span class="comment">// append activity configuration element(s)</span>

        xml.append("  &lt;settings a=\"");
        xml.append(mSettingA);
        xml.append("\" b=\"");
        xml.append(mSettingB);
        xml.append("\"/&gt;\n");

        <span class="comment">// append optional activity configuration element</span>

        if (mSettingC != null)
        {
            xml.append("  &lt;optionalSetting&gt;");
            xml.append(mSettingC);
            xml.append("&lt;/optionalSetting&gt;");
        }

        <span class="comment">// append activity output sub-element</span>

        xml.append("  &lt;output name=\"");
        xml.append(getOutputs()[0].getName());
        xml.append("\"/&gt;\n");

        xml.append("&lt;/activityElement&gt;");

        return xml.toString();
    }
}</pre>

<hr/>
<table width="100%" summary="Navigation" class="footer">
<tr>
<td class="footer">Back: <a href="index.html">How to Write an Activity</a></td>
<td/>
<td/>
</tr>
<tr>
<td>
&copy; International Business Machines Corporation, 2004.
</td>
<td>
&copy; The University of Edinburgh, 2004.
</td>
<td/>
</tr>
</table>
</body>
</html>

