<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- (c) International Business Machines Corporation, 2005 -->
<!-- (c) The University of Edinburgh,                 2005 -->
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"/>
  <link rel="stylesheet" type="text/css" href="../style.css"/>
<title>OGSA-DAI WSRF Distribution</title>
</head>

<body>

<h1>OGSA-DAI WSRF Distribution (DAI-WSRF-0.9.5)</h1>

<h2>Contents</h2>
<ul>
<li>
<a href="#Prerequisites">Prerequisites</a>
</li>
<ul>
<li>
<a href="#Drivers">Data Resource Drivers</a>
</li>
</ul>
<li>
<a href="#Overview">Overview</a>
</li>
<li>
<a href="#Caveats">Caveats</a>
</li>
<li>
<a href="#InstallDeploy">Installation and Deployment</a>
</li>
<ul>
<li>
<a href="#InitialInstall">Initial Installation</a>
</li>
<li>
<a href="#CreateServiceDeploy">Create Service Deployment Descriptors</a>
</li>
<li>
<a href="#AddDataResource">Add Data Resources</a>
</li>
<li>
<a href="#Deploy">Deploy Data Service Under Globus Toolkit</a>
</li>
</ul>
<li>
<a href="#UsageQuery">Usage - Querying Meta Data</a>
</li>
<li>
<a href="#UsageSubmitPerform">Usage - Submitting Perform Documents</a>
</li>
<li>
<a href="#UsageConvertPerform">Usage - Converting OGSA-DAI Perform Documents
</a>
</li>
</ul>

<h2 id="Prerequisites">Prerequisites</h2>

<p>
The deployment and use of the OGSA-DAI WSRF distribution will be
easier if you are already familiar with:
</p> 
<ul>
<li>
OGSA-DAI concepts and terms. 
<br/>
Reading the user's guide should provide you with this information.
</li>
<li>
WS-Addressing concepts and terms.<br/>
An introduction to WS-Addressing is available at
<a href="http://www-106.ibm.com/developerworks/library/specification/ws-add">
http://www-106.ibm.com/developerworks/library/specification/ws-add</a>.
</li>
<li>
Web Services Resource Framework (WSRF) concepts and terms.<br/> 
The WSRF specifications can be found at <a href="http://www.globus.org/wsrf">
http://www.globus.org/wsrf</a>.
</li>
</ul>

<h3 id="Software">Prerequisite Software</h3>

<p>
To use OGSA-DAI WSRF you will need the following software:
</p>

<ul>
<li>
Java 1.4.0.
<br/>
OGSA-DAI WSRF has been tested on this version of Java
though may work with other Java 1.4.x flavours. 
</li>
<li>
Jakarta ANT 1.5.
<br/>
See <a href="http://ant.apache.org/">http://ant.apache.org</a>.
</li>
<li>
Globus Toolkit 3.9.5 Java WS Core. 
<br/>
This provides a Java-based implementation of WSRF and is available at:
<br/>
<a href="http://www-unix.globus.org/toolkit/downloads/development">
http://www-unix.globus.org/toolkit/downloads/development</a>.
<br/>
Information on Globus Toolkit 4.0 can also be found at:
<br/>
<a href="http://www-unix.globus.org/toolkit/docs/development/4.0-drafts/GT4Facts">
http://www-unix.globus.org/toolkit/docs/development/4.0-drafts/GT4Facts</a>.
</li>
</ul>

<h3 id="Jars">Prerequisite Jars</h3>

To use OGSA-DAI WSRF you will need the following Jars:

<ul>
<li>XML:DB JARs.</li>
<ul>
<li>
Available with Xindice from 
<a href="http://xml.apache.org/xindice">http://xml.apache.org/xindice</a>.
</li>
<li>
Required JAR: <span class="commandline">xmldb.jar</span>.
</li>
</ul>

<li>JUnit 3.8.1 JARs.</li>
<ul>
<li>
Available from <a href="http://www.junit.org/">http://www.junit.org</a>.
</li>
<li>
Required JAR: <span class="commandline">junit.jar</span>.
</li>
</ul>
</ul>

<h3 id="Drivers">Data Resource Drivers</h3>
<p>
You will need to download database drivers for any data resources you
wish to expose using the OGSA-DAI WSRF distribution. Data resources
and drivers that have been tested against OGSA-DAI are:
</p>
<ul>
<li>MySQL</li>
<ul>
<li>
MySQL Connector J/2. Available from: <a href="http://www.mysql.com/">
http://www.mysql.com</a>.
</li>
<li>
Required JAR: <span class="commandline">mysql-connector-java-XXX.jar</span> 
where XXX is the version of the driver.
</li>
</ul>

<li>DB2</li>
<ul>
<li>DB2 JDBC Driver. Available from 
<a href="http://www.ibm.com/software/data/db2/">
http://www.ibm.com/software/data/db2</a>.
</li>
<li>
Required JARs: <span class="commandline">db2jcc.jar</span>, 
<span class="commandline">db2jcc_licence_cu.jar</span>.
</li>
</ul>

<li>Oracle</li>
<ul>
<li>
Oracle JDBC Drivers for Java 1.2+. Available from 
<a href="http://www.oracle.com/">http://www.oracle.com</a>.
</li>
<li>
Required JAR:<span class="commandline">classes12.zip</span> - rename as
<span class="commandline">classes12.jar</span>.
</li>
</ul>

<li>Xindice 1.0</li>
<ul>
<li>
Xindice 1.0. Available from <a href="http://xml.apache.org/xindice">
http://xml.apache.org/xindice</a>.
</li>
<li>Required JARs: <span class="commandline">xindice.jar</span>,
<span class="commandline">xmldb-xupdate.jar</span>, <span class="commandline">
openorb-1.2.0.jar</span>.
</li>
</ul>

<li>Microsoft SQL Server</li>
<ul>
<li>
MS SQL Server JDBC driver. Available from <a href="http://www.microsoft.com/">
http://www.microsoft.com</a>.
</li>
<li>
Required JARs: <span class="commandline">mssqlserver.jar</span>, 
<span class="commandline">msbase.jar</span>,
<span class="commandline">msutil.jar</span>.
</li>
</ul>
<li>Postgres</li>
<ul>

<li>
Postgres JDBC driver. Available from <a href="http://www.postgresql.org/"> 
http://www.postgresql.org</a>.
</li>
<li>
Required JAR: <span class="commandline">pgXXXX.jar</span> where XXXX is 
the version of the driver.
</li>
</ul>
</ul>

<h2 id="Overview">Overview</h2>

<p>
This OGSA-DAI distribution provides a WSRF based service interface,
using the <a href="http://www-unix.globus.org/toolkit/downloads/development">
Globus Toolkit</a> WSRF implementation. Features include:
</p>

<ul>
<li>
Access to data is provided via an <span class="commandline">OGSA-DAI
data service</span>. For those already familiar with the OGSI version
of OGSA-DAI this service amalgamates the capabilities of the GDSF and
GDS services (the metadata and configuration roles of the GDSF and the
metadata and perform document processing aspects of the GDS).
</li>
<li>
Allows multiple data resources to be accessed through a single
service. Data resource identifiers, available from the data service's
WS-Addressing endpoint reference, allows a client to target a specific
data resource.
</li>
<li>
A <span class="commandline">listResources()</span> operation is
provided at a data service to list all the data resource identifiers
available to that data service.
</li>
<li>
The data resource identifiers returned by a data service can
subsequently be used by a client to obtain metadata, etc, about the
data resources corresponding to that identifier.
</li>
<li>
Access to service metadata (such as database schemas, request status,
etc) is provided by an implementation of the
<span class="commandline">WS-ResourceProperties</span> specification. 
In particular support for using the <span class="commandline">
QueryResourceProperties</span>, 
<span class="commandline">GetResourceProperties</span>,
and <span class="commandline">GetMultipleResourceProperties</span> 
portTypes is provided.
</li>
<li>
Access to version information about the OGSA-DAI Data Service is
available through the <span class="commandline">getVersion()</span> operation.
</li>
<li>
A WSRF version of the OGSA-DAI <span
class="commandline">GridDataTransport</span> portType supports
asynchronous data delivery between data services.
</li>
</ul>

<h2 id="Caveats">Caveats</h2>

<ul>
<li>Use of GT3.9.5 security has not been tested on the OGSA-DAI WSRF distribution.</li>
<li>A WS-RF version of the client toolkit is not provided with this release.</li>
<li>This documentation has been generated from the OGSI version of the OGSA-DAI 
    documentation. There may still be some OGSI material lurking in here or mention 
    features that are not yet supported by the WS-RF release. If you find any such 
    discrepencies please do let us know.
</li>
</ul>     
<p>
We would welcome any feedback you might have about this release of the
OGSA-DAI WSRF distribution. If you have any comments please send these
to <a href="mailto:support@ogsadai.org.uk">support@ogsadai.org.uk</a>.
</p>

<h2 id="InstallDeploy">Installation and Deployment</h2>
<p>
This section describes how to set up an OGSA-DAI WSRF data service to
expose a number of data resources and how to then deploy DAI WSRF onto
Globus Toolkit.
</p>
<h3 id="InitialInstall">Initial Installation</h3>
<ul>
<li>
Download and compile Globus Toolkit.
</li>
<li>
Unzip <span class="commandline">ogsadai-wsrf.zip</span>. You should
now have the following directory structure: 
</li>

<pre class="commandline">
build.xml               - ANT build script.
build-tools-cli.xml     - ANT build script for installation tools.
client-config.wsdd      - Globus Toolkit client configuration file.
deploy-jndi-config.xml  - Resource configuration file.
deploy-server.wsdd      - Data resource deployment descriptor.
doc                     - Documentation.
etc                     - Location for configuration files.
lib                     - Directory for jar files and other libraries.
NStoPkg.properties      - Mappings from namespaces to Java packages.
schema                  - DAI XML Schema and WSDL.
skeletons               - Skeleton data resource and data service 
                          configuration files. 
src                     - Java source code.
</pre>

<li>
Set a <span class="commandline">GLOBUS_LOCATION</span> environment variable to
point to the location of your Globus Toolkit distribution:
</li>
<pre class="commandline">$ export GLOBUS_LOCATION=path/to/Globus/directory
</pre>

<li>
Place the <a href="#Jars">prerequisite JAR files</a> (
<span class="commandline">xindice.jar</span>, 
<span class="commandline">xmldb.jar</span> and 
<span class="commandline">junit.jar</span>) into the 
<span class="commandline">lib</span> directory.  
</li>

<li>
Set a <span class="commandline">DAI_WSRF</span> environment variable
to point to the location of your OGSA-DAI WSRF distribution directory.
For the bash or bourne shell use:

<pre class="commandline">
$ export DAI_WSRF=/path/to/DAI/WSRF/directory
</pre>

for cshell use:

<pre class="commandline">
% setenv DAI_WSRF /path/to/DAI/WSRF/directory
</pre>

and for a windows system:

<pre class="commandline">
$ set DAI_WSRF=C:\path\to\DAI\WSRF\directory
</pre>

From this point onwards only examples for the bash/bourne shell are
shown. Be sure to use the correct alternative for your platform.
</li>
</ul>

<h3 id="CreateServiceDeploy">Create Service Deployment Descriptors</h3>
<p>
To prepare a new data service.
</p>
<ul>
<li>
Enter the following command:
<pre class="commandline">
$ cd $DAI_WSRF
$ ant -buildfile build-tools-cli.xml createDataServiceDeployment
</pre>
</li>
<li>
You will be prompted for a name for your service. This will determine
the URL of your service. 
<pre class="commandline">
     [echo] Create a new Data Service deployment.
     [echo] Enter the relative service path e.g. sample/DataService:
    [input] (Press RETURN to select 'DataService')
</pre>
For example, entering <span class="commandline">my/DataService</span>
means that your service will have URL <span
class="commandline">http://localhost:8080/wsrf/services/my/DataService</span>.
<p>
Accepting the default means your service will have a URL of <span
class="commandline">http://localhost:8080/wsrf/services/DataService</span>.
</p>
</li>
<li>
Two deployment descriptors will then be created for your service
within <span class="commandline">deploy-server.wsdd</span>
and <span class="commandline">deploy-jndi-config.xml</span>.
</li>
</ul>

<h3 id="AddDataResource">Add Data Resources</h3>
<p>
You can now configure the service deployment descriptors so that your
service exposes data resources. For each data resource you want your
service to expose, do the following:
</p>
<ul>
<li>
Enter the following command:
<pre class="commandline">
$ cd $DAI_WSRF
$ ant -buildfile build-tools-cli.xml addDataResource
</pre>
</li>
<li>
You will now be asked to select the type of data resource you want to
expose. In the following example the user selects a MySQL data
resource: 
<pre class="commandline">
     [echo] Add a data resource to the current Data Service.
    [input] Enter data resource name (this will determine the names of the data resource configuration files also):
DataResourceSQL

     [echo] The following types of data resource are compatible with OGSA-DAI. Select the one you wish to deploy.
     [echo] 1-Relational - MySQL
     [echo] 2-Relational - IBM DB2
     [echo] 3-Relational - Microsoft SQL Server
     [echo] 4-Relational - PostgreSQL
     [echo] 5-XML        - Apache Xindice
     [echo] 6-Files      - Files and directories
    [input] Enter data resource type (1,2,3,4,5,6)
1
</pre>
</li>
<li>
You will then be asked to enter information about the data
resource. You can press RETURN if you are happy with any default
selections that are offered. 
<pre class="commandline">
     [echo] Enter data resource product vendor:
    [input] (Press RETURN to select 'MySQL')

     [echo] Enter data resource product version:
    [input] (Press RETURN to select '1.0')

    [input] Enter data resource URL:
jdbc:mysql://host.epcc.ed.ac.uk:3306/ogsadai

     [echo] Enter data resource driver class name:
    [input] (Press RETURN to select 'org.gjt.mm.mysql.Driver')

    [input] Enter database user ID:
ogsadai

    [input] Enter database password:
ogsadai
</pre>
</li><li>
Data resource configuration files will then be created within the
<span class="commandline">etc</span> directory, using a directory
named after the name you used for your data resource, for example 
<span class="commandline">DataResourceSQL</span>.
</li>
<li>
The service deployment descriptor you <a
href="#CreateServiceDeploy">created</a> will be updated to point to
these configuration files.
</li>
<li>
You should now copy any JAR files containing your data resource <a
href="#Drivers">drivers</a> to the <span
class="commandline">lib</span> directory.
</li>
</ul>
<p>
As another example, here the user selects a Xindice data resource:
</p>
<pre class="commandline">
$ cd $DAI_WSRF
$ ant -buildfile build-tools-cli.xml addDataResource

. . .

     [echo] Add a data resource to the current Data Service.
    [input] Enter data resource name (this will determine the names of the data resource configuration files also):
DataResourceXML

     [echo] The following types of data resource are compatible with OGSA-DAI. Select the one you wish to deploy.
     [echo] 1-Relational - MySQL
     [echo] 2-Relational - IBM DB2
     [echo] 3-Relational - Microsoft SQL Server
     [echo] 4-Relational - PostgreSQL
     [echo] 5-XML        - Apache Xindice
     [echo] 6-Files      - Files and directories
    [input] Enter data resource type (1,2,3,4,5,6)
5

     [echo] Enter data resource product vendor:
    [input] (Press RETURN to select '1.0')

     [echo] Enter data resource product version:
    [input] (Press RETURN to select '1.0')

    [input] Enter data resource URL:
xmldb:xindice://host.epcc.ed.ac.uk:4080/db/littleblackbook

     [echo] Enter data resource driver class name:
    [input] (Press RETURN to select 'org.apache.xindice.client.xmldb.DatabaseImpl')

    [input] Enter database user ID:
       
    [input] Enter database password:

...
</pre>

<h3 id="Deploy">Deploy Data Service Under Globus Toolkit</h3>
<p>
To compile and deploy OGSA-DAI WSRF distribution and your data service
under Globus Toolkit enter:
</p>

<pre class="commandline">
$ cd $DAI_WSRF
$ ant deploy
</pre>

<p>
The data resource configuration files <a
href="#AddDataResource">created</a> for each of the data resources
exposed by your service and the service deployment descriptor you <a
href="#CreateServiceDeploy">created</a> will be copied into the Globus
Toolkit directory structure and all pathnames rewritten appropriately.
</p>

<h3 id="DeployTomcat">Deploy Data Service Under Tomcat</h3>
<p>
To deploy the Globus Toolkit WS core and OGSA-DAI services under Tomcat enter:
</p>
<pre class="commandline">
$ cd $GLOBUS_LOCATION
$ ant -f share/globus_wsrf_common/tomcat/tomcat.xml deployTomcat -Dtomcat.dir=$CATALINA_HOME
</pre>

<h2 id="UsageQuery">Usage - Querying Meta Data</h2>
<p>
To query a data service:
</p>
<ul>
<li>
Create a new console window and start your WSRF service container (Globus
toolkit container or Tomcat). 
</li>
<li>
Now, in another window, invoke the Globus GetProperty Client:
<pre class="commandline">
$ cd $GLOBUS_LOCATION
$ ./bin/wsrf-get-property -s DATA-SERVICE-URI 
    -k {http://ogsadai.org.uk}DataResourceKey DATA-RESOURCE-NAME 
    PROPERTY-NAME
</pre>
For example:
<pre class="commandline">
$ cd $GLOBUS_LOCATION
$ ./bin/wsrf-get-property -s http://localhost:8080/wsrf/services/DataService 
    -k {http://ogsadai.org.uk}DataResourceKey DataResourceSQL 
    {http://ogsadai.org.uk/namespaces/2004/06}databaseSchema
</pre>
</li>
<li>
The value of the property will then be displayed.
</li>
<li>
Properties can include:
<ul>
<li>
<span class="commandline">
{http://ogsadai.org.uk/namespaces/2004/06}productInformation</span>
</li>
<li>
<span class="commandline">
{http://ogsadai.org.uk/namespaces/2004/06}requestStatus</span>
</li>
<li>For relational data resources: 
<span class="commandline">
{http://ogsadai.org.uk/namespaces/2004/06}databaseSchema</span>.
</li>
<li>For XML data resources:
<span class="commandline">
{http://ogsadai.org.uk/namespaces/2004/06}collectionSchema</span>.
</li>
</ul>
</li>
</ul>

<h2 id="UsageSubmitPerform">Usage - Submitting Perform Documents</h2>
<p>
To use OGSA-DAI WSRF to run Perform documents on a data resource:
</p>
<ul>
<li>
Create a new console window and start your WSRF service container (Globus
toolkit container or Tomcat). 
</li>
<li>
Now, in another window, invoke the DAI WSRF Client:
<pre class="commandline">
$ cd $GLOBUS_LOCATION
$ ./bin/dai-wsrf-client [-u DATA-SERVICE-URI] [-k DATA-RESOURCE-NAME] 
                        PERFORM-DOCUMENT-FILE 
</pre>
For example:
<pre class="commandline">
$ cd $GLOBUS_LOCATION
$ ./bin/dai-wsrf-client -u
  http://localhost:8080/wsrf/services/DataService 
  -k DataResourceSQL etc/globus_wsrf_ogsadai/select1Row.xml
</pre>
</li>
<li>
If you omit a data resource name then a list of those will be shown and you
will be asked to select one. For example
<pre class="commandline">
Contacting ... http://localhost:8080/wsrf/services/DataService
Data service version: WSRF 4.0
Number of resources: 2
Resource: DataResourceSQL
Resource: DataResourceXML
Enter a data resource name:
DataResourceSQL
Data Resource: DataResourceSQL
</pre>
</li>
<li>
If you omit a service URL then a default of <span
class="commandline">http://localhost:8080/wsrf/services/DataService</span>
will be used.
</li>
</ul>
<p>
We provide example perform documents for a relational and XML data
resource in the <span class="commandline">etc</span> directory. 
</p>
<p>
If you <span class="important">have</span> a full <a
href="http://www.ogsadai.org.uk/">OGSA-DAI release</a> version 4.0 or
higher then the OGSA-DAI <a
href="http://www.ogsadai.org.uk/docs/R5/doc/dbs/index.html">test
database tables</a> are suitable for use with these example perform
documents.
</p>
<p>
If you <span class="important">do not</span> have OGSA-DAI 4.0 or 5.0 then
you can edit the perform documents in the 
<span class="commandline">etc</span> directory:
</p><ul>
<li>
If your service exposes a relational data resource then:
<ul>
<li>
Edit the 
<span class="commandline">etc/select1Row.xml</span> file.
</li>
<li>
Replace the SQL query within the
<span class="xml">expression</span> element:
<pre class="xml">
&lt;expression&gt;<span class="important">select * from littleblackbook where id=10</span>&lt;/expression&gt;
</pre>
with an SQL expression compatible with your relational database.
</li>
</ul>
</li>
<li>
If your service exposes an XML data resource then:
<ul>
<li>
Edit the 
<span class="commandline">etc/queryCollection1.xml</span> file.
</li>
<li>
Replace the XPath query within the
<span class="xml">expression</span> element:
<pre class="xml">
&lt;expression&gt;<span class="important">/entry[@id&lt;100]</span>&lt;/expression&gt;
</pre>
with an XPath expression compatible with your XML database.
</li>
</ul>
</li>
</ul>
<p>
To convert existing OGSA-DAI Perform documents to be compatible with
OGSA-DAI WSRF see the <a href="#UsageConvertPerform">next section</a>.
</p>

<h2 id="UsageConvertPerform">Usage - Converting OGSA-DAI Perform Documents</h2>
<p>
In OGSA-DAI, Perform documents are specified in a <span
class="xml">gds</span> related namespace. In OGSA-DAI WSRF we have
removed from Perform document namespaces information related to the
specification (OGSI, WSI, WSRF) implemented at the service level.
</p>
<p>
To convert Perform documents provided in the main OGSA-DAI
distribution (within <span class="commandline">examples</span>), or
your own existing Perform documents, into this generic format:
</p>
<ul>
<li>
Execute the <span class="xml">ConvertPerform</span> target within the
OGSA-DAI WSRF ANT script:
<pre class="commandline">
$ cd $DAI_WSRF
$ ant ConvertPerform -Dperform.dir=PATH-TO-PERFORM-DIRECTORY
</pre>
where <span class="commandline">PATH-TO-PERFORM-DIRECTORY</span>
contains files, all of which are assumed to be XML Perform
documents. For example:
<pre class="commandline">$ cd $DAI_WSRF
$ ant ConvertPerform -Dperform.dir=examples/GDSPerform/JDBC/query
</pre>
</li>
<li>
Do not worry if you make a mistake, the ANT target will make backups
(with extension <span class="commandline">.bak</span>) prior to
converting the documents.
</li>
</ul>

<hr/>
<table width="100%" summary="Navigation" class="footer">
<tr>
<td/>
<td class="footer">
Up: <a href="../index.html">OGSA-DAI User Guide</a>
</td>
<td/>
</tr>
<tr>
<td>
&copy; International Business Machines Corporation, 2005.
</td>
<td>
&copy; The University of Edinburgh, 2005.
</td>
<td/>
</tr>
</table>
</body>
</html>
