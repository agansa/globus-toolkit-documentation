<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>GridFTP Bandwidth Limiting</title><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /></head><body><div class="article" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id2747445"></a>GridFTP Bandwidth Limiting</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Tim</span> <span class="surname">Pinkawa</span></h3></div></div><div><div class="revhistory"><table border="1" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 1.0</td><td align="left">2009-02-03</td><td align="left">tim</td></tr><tr><td align="left" colspan="3">Initial document.</td></tr></table></div></div></div><hr /></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#introduction">Introduction</a></span></dt><dt><span class="section"><a href="#requirements">Requirements</a></span></dt><dt><span class="section"><a href="#usage">Usage</a></span></dt><dt><span class="section"><a href="#details">Details</a></span></dt><dt><span class="section"><a href="#customizing">Customizing</a></span></dt></dl></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="introduction"></a>Introduction</h2></div></div></div><p>
The <a href="bwlimit.sh" provided shell script</a> allows user-specified bandwidth limiting for outgoing traffic on a given port range using networking features of the Linux 2.6 kernel.
  </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="requirements"></a>Requirements</h2></div></div></div><p>
</p><div class="itemizedlist"><ul type="disc"><li><p>Super user (root) access</p></li><li><p>Linux 2.6 kernel with Netfilter support</p></li><li><p><span class="command"><strong>iptables</strong></span> (provided by the iptables package on most distributions, more information available <a class="ulink" href="http://www.netfilter.org" target="_top">here</a>.)</p></li><li><p><span class="command"><strong>tc</strong></span> (provided by the iproute package on most distributions, more information available <a class="ulink" href="http://www.linuxfoundation.org/en/Net:Iproute2" target="_top">here</a>.)</p></li></ul></div><p>
  </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="usage"></a>Usage</h2></div></div></div><p>
As root:
</p><p>
</p><div class="cmdsynopsis"><p><code class="command">bwlimit.sh</code>   <em class="replaceable"><code>rate</code></em> </p></div><p>
</p><p>
<span class="emphasis"><em>rate</em></span> is passed directly to <span class="command"><strong>tc</strong></span> which allows all valid <span class="command"><strong>tc</strong></span> rate units to be used, for example:
</p><div class="itemizedlist"><ul type="disc"><li><p>50kbps (50 kilobytes per second)</p></li><li><p>1mbps (1 megabyte per second)</p></li><li><p>512kbit (512 kilobits per second)</p></li><li><p>5mbit (5 megabits per second)</p></li></ul></div><p>
</p><p>
See the <span class="citerefentry"><span class="refentrytitle">tc</span>(8)</span> manual page, section <span class="emphasis"><em>UNITS</em></span> for complete information.
</p><p>
The <code class="envar">GLOBUS_TCP_SOURCE_RANGE</code> environment variable must be set to specify the TCP port range that will be affected. The variable should be set in the format "lowport,highport". See <a class="ulink" href="http://www.globus.org/toolkit/docs/4.2/4.2.1/admin/install/#gridftp-security-firewalls" target="_top">GridFTP Firewall requirements</a> for more information.
  </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="details"></a>Details</h2></div></div></div><p>
The bandwidth limiting process consists of three commands. First, a rule is created using <span class="command"><strong>iptables</strong></span> to classify all TCP traffic in the port range specified by the <code class="envar">GLOBUS_TCP_SOURCE_RANGE</code> environment variable with a class 1:1 which will be used by <span class="command"><strong>tc</strong></span>. <span class="command"><strong>tc</strong></span> adds a queuing discipline (qdisc) chained off the root queue with a handle of 1:0. Finally, a <span class="command"><strong>tc</strong></span> class is added off the qdisc created in the previous command with a class ID 1:1 and a rate specified by the user.
</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">If you already use tc...</h3><p>
If you have existing <span class="command"><strong>tc</strong></span> infrastructure set up, it is important that you verify that this script's use of the handle 1:0 and class ID 1:1 do not conflict with existing configurations.
</p></div><p>
  </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="customizing"></a>Customizing</h2></div></div></div><p>
By default, the script applies bandwidth limiting to the eth0 interface. If you are using another network interface, the <code class="envar">IFACE</code> variable should be updated in the script to reflect your desired network interface.
  </p></div></div></body></html>
